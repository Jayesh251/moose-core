<!DOCTYPE html>
<html class="writer-html5" lang="English" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rdesigneur: Building multiscale models &mdash; MOOSE Jhangri (4.1.0 rc) documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Rdesigneur Examples" href="multi_rdes.html" />
    <link rel="prev" title="Rdesignuer" href="index_rd.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> MOOSE
            <img src="../../../_static/moose_logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                4.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../beginner.html">Beginner Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../intermediate.html">Intermediate Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../introduction/index_introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/index_ckbk.html">Cook Book</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index_rd.html">Rdesignuer</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#"><strong>Rdesigneur: Building multiscale models</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#contents">Contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rdesigneur-examples">Rdesigneur examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rdesigneur-command-reference">Rdesigneur command reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="multi_rdes.html">Rdesigneur Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/index_tut.html">Teaching Tutorials</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../advanced.html">Advanced Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">MOOSE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../beginner.html">Beginner Guide</a> &raquo;</li>
          <li><a href="index_rd.html">Rdesignuer</a> &raquo;</li>
      <li><strong>Rdesigneur: Building multiscale models</strong></li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/user/py/rdesigneur/rdes.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rdesigneur-building-multiscale-models">
<h1><a class="toc-backref" href="#id45"><strong>Rdesigneur: Building multiscale models</strong></a><a class="headerlink" href="#rdesigneur-building-multiscale-models" title="Permalink to this heading">¶</a></h1>
<p>Author: Upi Bhalla</p>
<p>Date: Aug 26 2016,</p>
<p>Last-Updated: Nov 08 2018</p>
<p>By: Upi Bhalla</p>
<section id="contents">
<h2><a class="toc-backref" href="#id46">Contents</a><a class="headerlink" href="#contents" title="Permalink to this heading">¶</a></h2>
<div class="contents topic" id="id1">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#rdesigneur-building-multiscale-models" id="id45"><strong>Rdesigneur: Building multiscale models</strong></a></p>
<ul>
<li><p><a class="reference internal" href="#contents" id="id46">Contents</a></p></li>
<li><p><a class="reference internal" href="#introduction" id="id47">Introduction</a></p></li>
<li><p><a class="reference internal" href="#rdesigneur-examples" id="id48">Rdesigneur examples</a></p>
<ul>
<li><p><a class="reference internal" href="#bare-rdesigneur-single-passive-compartment" id="id49">Bare Rdesigneur: single passive compartment</a></p></li>
<li><p><a class="reference internal" href="#simulate-and-display-current-pulse-to-soma" id="id50">Simulate and display current pulse to soma</a></p></li>
<li><p><a class="reference internal" href="#simulate-and-display-voltage-clamp-stimulus-to-soma" id="id51">Simulate and display voltage clamp stimulus to soma</a></p></li>
<li><p><a class="reference internal" href="#hh-squid-model-in-a-single-compartment" id="id52">HH Squid model in a single compartment</a></p></li>
<li><p><a class="reference internal" href="#hh-squid-model-with-voltage-clamp" id="id53">HH Squid model with voltage clamp</a></p></li>
<li><p><a class="reference internal" href="#hh-squid-model-in-an-axon" id="id54">HH Squid model in an axon</a></p></li>
<li><p><a class="reference internal" href="#action-potential-collision-in-hh-squid-axon-model" id="id55">Action potential collision in HH Squid axon model</a></p></li>
<li><p><a class="reference internal" href="#hh-squid-model-in-a-myelinated-axon" id="id56">HH Squid model in a myelinated axon</a></p></li>
<li><p><a class="reference internal" href="#alternate-non-squid-way-to-define-soma" id="id57">Alternate (non-squid) way to define soma</a></p></li>
<li><p><a class="reference internal" href="#ball-and-stick-model-of-a-neuron" id="id58">Ball-and-stick model of a neuron</a></p></li>
<li><p><a class="reference internal" href="#benchmarking-simulation-speed" id="id59">Benchmarking simulation speed</a></p></li>
<li><p><a class="reference internal" href="#synaptic-stimulus-random-possion" id="id60">Synaptic stimulus: random (Possion)</a></p></li>
<li><p><a class="reference internal" href="#synaptic-stimulus-periodic" id="id61">Synaptic stimulus: periodic</a></p></li>
<li><p><a class="reference internal" href="#reaction-system-in-a-single-compartment" id="id62">Reaction system in a single compartment</a></p></li>
<li><p><a class="reference internal" href="#reaction-diffusion-system" id="id63">Reaction-diffusion system</a></p></li>
<li><p><a class="reference internal" href="#primer-on-using-the-3-d-moogli-display" id="id64">Primer on using the 3-D MOOGLI display</a></p></li>
<li><p><a class="reference internal" href="#diffusion-of-a-single-molecule" id="id65">Diffusion of a single molecule</a></p></li>
<li><p><a class="reference internal" href="#calcium-induced-calcium-release" id="id66">Calcium-induced calcium release</a></p></li>
<li><p><a class="reference internal" href="#intracellular-transport" id="id67">Intracellular transport</a></p></li>
<li><p><a class="reference internal" href="#travelling-oscillator" id="id68">Travelling oscillator</a></p></li>
<li><p><a class="reference internal" href="#bidirectional-transport" id="id69">Bidirectional transport</a></p></li>
<li><p><a class="reference internal" href="#controlling-a-reaction-by-a-function" id="id70">Controlling a reaction by a function</a></p></li>
<li><p><a class="reference internal" href="#multiscale-models-single-compartment" id="id71">Multiscale models: single compartment</a></p></li>
<li><p><a class="reference internal" href="#multiscale-model-of-cicr-in-dendrite-triggered-by-synaptic-input" id="id72">Multiscale model of CICR in dendrite triggered by synaptic input</a></p></li>
<li><p><a class="reference internal" href="#multiscale-model-spanning-psd-spine-head-and-dendrite" id="id73">Multiscale model spanning PSD, spine head and dendrite</a></p></li>
<li><p><a class="reference internal" href="#multiscale-model-in-which-spine-geometry-changes-due-to-signaling" id="id74">Multiscale model in which spine geometry changes due to signaling</a></p></li>
<li><p><a class="reference internal" href="#morphology-load-swc-morphology-file-and-view-it" id="id75">Morphology: Load .swc morphology file and view it</a></p></li>
<li><p><a class="reference internal" href="#build-an-active-neuron-model-by-putting-channels-into-a-morphology-file" id="id76">Build an active neuron model by putting channels into a morphology file</a></p></li>
<li><p><a class="reference internal" href="#build-a-spiny-neuron-from-a-morphology-file-and-put-active-channels-in-it" id="id77">Build a spiny neuron from a morphology file and put active channels in it.</a></p></li>
<li><p><a class="reference internal" href="#place-spines-in-a-spiral-along-a-dendrite" id="id78">Place spines in a spiral along a dendrite</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#rdesigneur-command-reference" id="id79">Rdesigneur command reference</a></p>
<ul>
<li><p><a class="reference internal" href="#turnoffelec" id="id80">turnOffElec</a></p></li>
<li><p><a class="reference internal" href="#usegssa" id="id81">useGssa</a></p></li>
<li><p><a class="reference internal" href="#combinesegments" id="id82">combineSegments</a></p></li>
<li><p><a class="reference internal" href="#stealcellfromlibrary" id="id83">stealCellFromLibrary</a></p></li>
<li><p><a class="reference internal" href="#verbose" id="id84">verbose</a></p></li>
<li><p><a class="reference internal" href="#addsomachemcompt" id="id85">addSomaChemCompt</a></p></li>
<li><p><a class="reference internal" href="#addendochemcompt" id="id86">addEndoChemCompt</a></p></li>
<li><p><a class="reference internal" href="#diffusionlength" id="id87">diffusionLength</a></p></li>
<li><p><a class="reference internal" href="#temperature" id="id88">temperature</a></p></li>
<li><p><a class="reference internal" href="#chemdt" id="id89">chemDt</a></p></li>
<li><p><a class="reference internal" href="#diffdt" id="id90">diffDt</a></p></li>
<li><p><a class="reference internal" href="#elecdt" id="id91">elecDt</a></p></li>
<li><p><a class="reference internal" href="#chemplotdt" id="id92">chemPlotDt</a></p></li>
<li><p><a class="reference internal" href="#elecplotdt" id="id93">elecPlotDt</a></p></li>
<li><p><a class="reference internal" href="#funcdt" id="id94">funcDt</a></p></li>
<li><p><a class="reference internal" href="#cellproto" id="id95">cellProto</a></p></li>
<li><p><a class="reference internal" href="#spineproto" id="id96">spineProto</a></p></li>
<li><p><a class="reference internal" href="#chanproto" id="id97">chanProto</a></p></li>
<li><p><a class="reference internal" href="#chemproto" id="id98">chemProto</a></p></li>
<li><p><a class="reference internal" href="#passivedistrib" id="id99">passiveDistrib</a></p></li>
<li><p><a class="reference internal" href="#spinedistrib" id="id100">spineDistrib</a></p></li>
<li><p><a class="reference internal" href="#chandistrib" id="id101">chanDistrib</a></p></li>
<li><p><a class="reference internal" href="#chemdistrib" id="id102">chemDistrib</a></p></li>
<li><p><a class="reference internal" href="#adaptorlist" id="id103">adaptorList</a></p></li>
<li><p><a class="reference internal" href="#stimlist" id="id104">stimList</a></p></li>
<li><p><a class="reference internal" href="#plotlist" id="id105">plotList</a></p></li>
<li><p><a class="reference internal" href="#mooglist" id="id106">moogList</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</section>
<section id="introduction">
<h2><a class="toc-backref" href="#id47">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p><strong>Rdesigneur</strong> (Reaction Diffusion and Electrical SIGnaling in NEURons)
is an interface to the multiscale modeling capabilities in MOOSE. It is
designed to build models incorporating biochemical signaling pathways in
dendrites and spines, coupled to electrical events in neurons.
Rdesigneur assembles models from predefined parts: it delegates the
details to specialized model definition formats. Rdesigneur combines one
or more of the following cell parts to build models:</p>
<ul class="simple">
<li><p>Neuronal morphology</p></li>
<li><p>Dendritic spines</p></li>
<li><p>Ion channels</p></li>
<li><p>Reaction systems</p></li>
<li><p>Adaptors that couple between these for multiscale models</p></li>
</ul>
<p>It also folds in simulation input and output</p>
<ul class="simple">
<li><p>Time-series stimuli for molecular concentration change and reaction rates</p></li>
<li><p>Current and voltage clamp</p></li>
<li><p>Synaptic input.</p></li>
<li><p>Time-series plots</p></li>
<li><p>File dumps</p></li>
<li><p>3-D neuronal graphics</p></li>
</ul>
<p>Rdesigneur's main role is to specify how these are put together,
including assigning parameters for the model. Using Rdesigneur one can compactly
and quickly put together quite complex multiscale models.</p>
</section>
<section id="rdesigneur-examples">
<h2><a class="toc-backref" href="#id48">Rdesigneur examples</a><a class="headerlink" href="#rdesigneur-examples" title="Permalink to this heading">¶</a></h2>
<p>Here we provide a few use cases, building up from a minimal model to a
reasonably complete multiscale model spanning chemical and electrical
signaling. The files for these examples are also available in
<code class="docutils literal notranslate"><span class="pre">moose-examples/tutorials/Rdesigneur</span></code>, and the file names are mentioned
as we go along.</p>
<section id="bare-rdesigneur-single-passive-compartment">
<span id="building-rdesigneur-without-arguments"></span><h3><a class="toc-backref" href="#id49">Bare Rdesigneur: single passive compartment</a><a class="headerlink" href="#bare-rdesigneur-single-passive-compartment" title="Permalink to this heading">¶</a></h3>
<p><em>ex1_minimalModel.py</em></p>
<p>If we don't provide any arguments at all to the Rdesigneur, it makes a
model with a single passive electrical compartment in the MOOSE path
<code class="docutils literal notranslate"><span class="pre">/model/elec/soma</span></code>. Here is how to do this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">()</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
</pre></div>
</div>
<p>To confirm that it has made a compartment with some default values we
can add a line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">moose</span><span class="o">.</span><span class="n">showfields</span><span class="p">(</span> <span class="n">rdes</span><span class="o">.</span><span class="n">soma</span> <span class="p">)</span>
</pre></div>
</div>
<p>This should produce the output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="o">/</span><span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">elec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">soma</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span>
<span class="n">diameter</span>         <span class="o">=</span> <span class="mf">0.0005</span>
<span class="n">fieldIndex</span>       <span class="o">=</span> <span class="mi">0</span>
<span class="n">Ra</span>               <span class="o">=</span> <span class="mf">7639437.26841</span>
<span class="n">y0</span>               <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">Rm</span>               <span class="o">=</span> <span class="mf">424413.177334</span>
<span class="n">index</span>            <span class="o">=</span> <span class="mi">0</span>
<span class="n">numData</span>          <span class="o">=</span> <span class="mi">1</span>
<span class="n">inject</span>           <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">initVm</span>           <span class="o">=</span> <span class="o">-</span><span class="mf">0.065</span>
<span class="n">Em</span>               <span class="o">=</span> <span class="o">-</span><span class="mf">0.0544</span>
<span class="n">y</span>                <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">numField</span>         <span class="o">=</span> <span class="mi">1</span>
<span class="n">path</span>             <span class="o">=</span> <span class="o">/</span><span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">elec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">soma</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dt</span>               <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">tick</span>             <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
<span class="n">z0</span>               <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">name</span>             <span class="o">=</span> <span class="n">soma</span>
<span class="n">Cm</span>               <span class="o">=</span> <span class="mf">7.85398163398e-09</span>
<span class="n">x0</span>               <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">Vm</span>               <span class="o">=</span> <span class="o">-</span><span class="mf">0.06</span>
<span class="n">className</span>        <span class="o">=</span> <span class="n">ZombieCompartment</span>
<span class="n">idValue</span>          <span class="o">=</span> <span class="mi">465</span>
<span class="n">length</span>           <span class="o">=</span> <span class="mf">0.0005</span>
<span class="n">Im</span>               <span class="o">=</span> <span class="mf">1.3194689277e-08</span>
<span class="n">x</span>                <span class="o">=</span> <span class="mf">0.0005</span>
<span class="n">z</span>                <span class="o">=</span> <span class="mf">0.0</span>
</pre></div>
</div>
</section>
<section id="simulate-and-display-current-pulse-to-soma">
<h3><a class="toc-backref" href="#id50">Simulate and display current pulse to soma</a><a class="headerlink" href="#simulate-and-display-current-pulse-to-soma" title="Permalink to this heading">¶</a></h3>
<p><em>ex2.0_currentPulse.py</em></p>
<p>A more useful script would run and display the model. Rdesigneur can
help with the stimulus and the plotting. This simulation has the same
passive compartment, and current is injected as the simulation runs.
This script displays the membrane potential of the soma as it charges
and discharges.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">stimList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;inject&#39;</span><span class="p">,</span> <span class="s1">&#39;(t&gt;0.1 &amp;&amp; t&lt;0.2) * 2e-8&#39;</span><span class="p">]],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Soma membrane potential&#39;</span><span class="p">]],</span>
<span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mf">0.3</span> <span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<p>The <em>stimList</em> defines a stimulus. Each entry has five arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`[region_in_cell, region_expression, moose_object, parameter, expression_string]`
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">region_in_cell</span></code> specifies the objects to stimulate. Here it is
just the soma.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">region_expression</span></code> specifies a geometry based calculation to
decide whether to apply the stimulus. The value must be &gt;0 for the
stimulus to be present. Here it is just 1. <code class="docutils literal notranslate"><span class="pre">moose_object</span></code> specifies
the simulation object to operate upon during the stimulus. Here the
<code class="docutils literal notranslate"><span class="pre">.</span></code> means that it is the soma itself. In other models it might be a
channel on the soma, or a synapse, and so on.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parameter</span></code> specifies the simulation parameter on the moose object
that the stimulus will modify. Here it is the injection current to
the soma compartment.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">expression_string</span></code> calculates the value of the parameter,
typically as a function of time. Here we use the function
<code class="docutils literal notranslate"><span class="pre">(t&gt;0.1</span> <span class="pre">&amp;&amp;</span> <span class="pre">t&lt;0.2)</span> <span class="pre">*</span> <span class="pre">2e-8</span></code> which evaluates as 2e-8 between the times
of 0.1 and 0.2 seconds.</p></li>
</ul>
<p>To summarise this, the <em>stimList</em> here means <em>inject a current of 20nA
to the soma between the times of 0.1 and 0.2 s</em>.</p>
<p>The <em>plotList</em> defines what to plot. It has a similar set of arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`[region_in_cell, region_expression, moose_object, parameter, title_of_plot]`
</pre></div>
</div>
<p>These mean the same thing as for the stimList except for the title of
the plot.</p>
<p>The <em>rdes.display()</em> function causes the plots to be displayed.</p>
<figure class="align-default" id="id5">
<img alt="Plot for current input to passive compartment" src="../../../_images/rdes2_passive_squid.png" />
<figcaption>
<p><span class="caption-text">Plot for current input to passive compartment</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>When we run this we see an initial depolarization as the soma settles
from its initial -65 mV to a resting Em = -54.4 mV. These are the
original HH values, see the example above. At t = 0.1 seconds there is
another depolarization due to the current injection, and at t = 0.2
seconds this goes back to the resting potential.</p>
</section>
<section id="simulate-and-display-voltage-clamp-stimulus-to-soma">
<h3><a class="toc-backref" href="#id51">Simulate and display voltage clamp stimulus to soma</a><a class="headerlink" href="#simulate-and-display-voltage-clamp-stimulus-to-soma" title="Permalink to this heading">¶</a></h3>
<p><em>ex2.1_vclamp.py</em></p>
<p>This model introduces the voltage clamp stimulus on a passive compartment.
As before, we add a few lines to define the stimulus and plot.
This script displays both the membrane potential, and the holding current
of the voltage clamp circuit as
it charges and discharges the passive compartment model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">stimList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;vclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;-0.065 + (t&gt;0.1 &amp;&amp; t&lt;0.2) * 0.02&#39;</span> <span class="p">]],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Soma membrane potential&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;vclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;current&#39;</span><span class="p">,</span> <span class="s1">&#39;Soma holding current&#39;</span><span class="p">],</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mf">0.3</span> <span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<p>Here the <em>stimList</em> line tells the system to deliver a voltage clamp (vclamp)
on the soma, starting at -65 mV and jumping up by 20 mV between 0.1 and 0.2
seconds. The <em>plotList</em> now includes two entries, and will generate two plots.
The first is for plotting the soma membrane potential, just to be sure that
the voltage clamp is doing its job.</p>
<figure class="align-default" id="id6">
<img alt="Plot for membrane potential in voltage clamp" src="../../../_images/ex2.1_vclamp_a.png" />
<figcaption>
<p><span class="caption-text">Plot for membrane potential in voltage clamp</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The second graph plots the holding current.  Note the capacitive transients.</p>
<figure class="align-default" id="id7">
<img alt="Plot for holding current for voltage clamp" src="../../../_images/ex2.1_vclamp_b.png" />
<figcaption>
<p><span class="caption-text">Plot for holding current for voltage clamp</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="hh-squid-model-in-a-single-compartment">
<h3><a class="toc-backref" href="#id52">HH Squid model in a single compartment</a><a class="headerlink" href="#hh-squid-model-in-a-single-compartment" title="Permalink to this heading">¶</a></h3>
<p><em>ex3.0_squid_currentPulse.py</em></p>
<p>Here we put the Hodgkin-Huxley squid model channels into a passive
compartment. The HH channels are predefined as prototype channels for
Rdesigneur,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">chanProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;make_HH_Na()&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;make_HH_K()&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">]],</span>
    <span class="n">chanDistrib</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;1200&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;360&#39;</span> <span class="p">]],</span>
    <span class="n">stimList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;inject&#39;</span><span class="p">,</span> <span class="s1">&#39;(t&gt;0.1 &amp;&amp; t&lt;0.2) * 1e-8&#39;</span> <span class="p">]],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Membrane potential&#39;</span><span class="p">]]</span>
<span class="p">)</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mf">0.3</span> <span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<p>Here we introduce two new model specification lines:</p>
<ul>
<li><p><strong>chanProto</strong>: This specifies which ion channels will be used in the
model. Each entry here has two fields: the source of the channel
definition, and (optionally) the name of the channel. In this example
we specify two channels, an Na and a K channel using the original
Hodgkin-Huxley parameters. As the source of the channel definition we
use the name of the Python function that builds the channel. The
<em>make_HH_Na()</em> and <em>make_HH_K()</em> functions are predefined but we
can also specify our own functions for making prototypes. We could
also have specified the channel prototype using the name of a channel
definition file in ChannelML (a subset of NeuroML) format.</p></li>
<li><p><strong>chanDistrib</strong>: This specifies <em>where</em> the channels should be placed
over the geometry of the cell. Each entry in the chanDistrib list
specifies the distribution of parameters for one channel using four
entries:</p>
<p><code class="docutils literal notranslate"><span class="pre">[object_name,</span> <span class="pre">region_in_cell,</span> <span class="pre">parameter,</span> <span class="pre">expression_string]</span></code></p>
<p>In this case the job is almost trivial, since we just have a single
compartment named <em>soma</em>. So the line</p>
<p><code class="docutils literal notranslate"><span class="pre">['Na',</span> <span class="pre">'soma',</span> <span class="pre">'Gbar',</span> <span class="pre">'1200'</span> <span class="pre">]</span></code></p>
<p>means <em>Put the Na channel in the soma, and set its maximal
conductance density (Gbar) to 1200 Siemens/m^2</em>.</p>
</li>
</ul>
<p>As before we apply a somatic current pulse. Since we now have HH
channels in the model, this generates action potentials.</p>
<figure class="align-default" id="id8">
<img alt="Plot for HH squid simulation" src="../../../_images/rdes3_squid.png" />
<figcaption>
<p><span class="caption-text">Plot for HH squid simulation</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>There are several interesting things to do with the model by varying stimulus
parameters:</p>
<blockquote>
<div><ul class="simple">
<li><p>Change injection current.</p></li>
<li><p>Put in a protocol to get rebound action potential.</p></li>
<li><p>Put in a current ramp, and run it for a different duration</p></li>
<li><p>Put in a frequency chirp, and see how the squid model is tuned
to a certain frequency range.</p></li>
<li><p>Modify channel or passive parameters. See if it still fires.</p></li>
<li><p>Try the frequency chirp on the cell with parameters changed. Does
the tuning change?</p></li>
</ul>
</div></blockquote>
</section>
<section id="hh-squid-model-with-voltage-clamp">
<h3><a class="toc-backref" href="#id53">HH Squid model with voltage clamp</a><a class="headerlink" href="#hh-squid-model-with-voltage-clamp" title="Permalink to this heading">¶</a></h3>
<p><em>ex3.1_squid_vclamp.py</em></p>
<p>This is the same squid model, but now we add a voltage clamp to the squid
and monitor the holding current. This stimulus line is identical to ex2.1.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">chanProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;make_HH_Na()&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;make_HH_K()&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">]],</span>
    <span class="n">chanDistrib</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;1200&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;360&#39;</span> <span class="p">]],</span>
    <span class="n">stimList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;vclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;-0.065 + (t&gt;0.1 &amp;&amp; t&lt;0.2) * 0.02&#39;</span> <span class="p">]],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Membrane potential&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;vclamp&#39;</span><span class="p">,</span> <span class="s1">&#39;current&#39;</span><span class="p">,</span> <span class="s1">&#39;Soma holding current&#39;</span><span class="p">]</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mf">0.3</span> <span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<p>Here we see the classic HH current response, a downward brief deflection due to
the Na channel, and a slower upward sustained current due to the K delayed
rectifier.</p>
<figure class="align-default" id="id9">
<img alt="Plot for HH squid voltage clamp pulse." src="../../../_images/ex3.1_squid_vclamp.png" />
<figcaption>
<p><span class="caption-text">Plot for HH squid voltage clamp pulse.</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Here are some suggestions for further exploration:</p>
<blockquote>
<div><ul class="simple">
<li><p>Monitor individual channel currents through additional plots.</p></li>
<li><p>Convert this into a voltage clamp series. Easiest way to do this is
to complete the rdes.BuildModel, then delete the Function object
on the <em>/model/elec/soma/vclamp</em>. Now you can simply set the 'command'
field of the vclamp in a for loop, going from -ve to +ve voltages.
Remember, SI units. You may wish to capture the plot vectors each
cycle. The plot vectors are accessed by something like</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">moose.element(</span> <span class="pre">'/model/graphs/plot1'</span> <span class="pre">).vector</span></code></p>
</div></blockquote>
</section>
<section id="hh-squid-model-in-an-axon">
<h3><a class="toc-backref" href="#id54">HH Squid model in an axon</a><a class="headerlink" href="#hh-squid-model-in-an-axon" title="Permalink to this heading">¶</a></h3>
<p><em>ex3.2_squid_axon_propgn.py</em></p>
<p>Here we put the Hodgkin-Huxley squid model into a long compartment that
is subdivided into many segments, so that we can watch action potentials
propagate. Most of this example is boilerplate code to build a spiral
axon. There is a short <em>rdesigneur</em> segment that takes the spiral axon
prototype and populates it with channels, and sets up the display. Later
examples will show you how to read morphology files to specify the
neuronal geometry.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>

<span class="n">numAxonSegments</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">comptLen</span> <span class="o">=</span> <span class="mf">10e-6</span>
<span class="n">comptDia</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="n">RM</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">RA</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">CM</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="k">def</span><span class="w"> </span><span class="nf">makeAxonProto</span><span class="p">():</span>
        <span class="n">axon</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Neuron</span><span class="p">(</span> <span class="s1">&#39;/library/axon&#39;</span> <span class="p">)</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">buildCompt</span><span class="p">(</span> <span class="n">axon</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="n">RM</span> <span class="o">=</span> <span class="n">RM</span><span class="p">,</span> <span class="n">RA</span> <span class="o">=</span> <span class="n">RA</span><span class="p">,</span> <span class="n">CM</span> <span class="o">=</span> <span class="n">CM</span><span class="p">,</span> <span class="n">dia</span> <span class="o">=</span> <span class="mf">10e-6</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="n">comptLen</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">comptLen</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">numAxonSegments</span> <span class="p">):</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">comptLen</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">theta</span> <span class="p">)</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">comptLen</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">theta</span> <span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span> <span class="p">)</span>
            <span class="n">theta</span> <span class="o">+=</span> <span class="n">comptLen</span> <span class="o">/</span> <span class="n">r</span>
            <span class="n">compt</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">buildCompt</span><span class="p">(</span> <span class="n">axon</span><span class="p">,</span> <span class="s1">&#39;axon&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">RM</span> <span class="o">=</span> <span class="n">RM</span><span class="p">,</span> <span class="n">RA</span> <span class="o">=</span> <span class="n">RA</span><span class="p">,</span> <span class="n">CM</span> <span class="o">=</span> <span class="n">CM</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dia</span> <span class="o">=</span> <span class="n">comptDia</span> <span class="p">)</span>
            <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">prev</span><span class="p">,</span> <span class="s1">&#39;axial&#39;</span><span class="p">,</span> <span class="n">compt</span><span class="p">,</span> <span class="s1">&#39;raxial&#39;</span> <span class="p">)</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="n">compt</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="n">dx</span>
            <span class="n">y</span> <span class="o">+=</span> <span class="n">dy</span>

        <span class="k">return</span> <span class="n">axon</span>

<span class="n">moose</span><span class="o">.</span><span class="n">Neutral</span><span class="p">(</span> <span class="s1">&#39;/library&#39;</span> <span class="p">)</span>
<span class="n">makeAxonProto</span><span class="p">()</span>

<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
        <span class="n">chanProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;make_HH_Na()&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;make_HH_K()&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">]],</span>
        <span class="n">cellProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;elec&#39;</span><span class="p">,</span><span class="s1">&#39;axon&#39;</span><span class="p">]],</span>
        <span class="n">chanDistrib</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;1200&#39;</span> <span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;360&#39;</span> <span class="p">]],</span>
        <span class="n">stimList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;inject&#39;</span><span class="p">,</span> <span class="s1">&#39;(t&gt;0.01 &amp;&amp; t&lt;0.2) * 2e-11&#39;</span> <span class="p">]],</span>
        <span class="n">plotList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Membrane potential&#39;</span><span class="p">]],</span>
        <span class="n">moogList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm (mV)&#39;</span><span class="p">]]</span>
        <span class="p">)</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">displayMoogli</span><span class="p">(</span> <span class="mf">0.00005</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" id="id10">
<img alt="Axon with propagating action potential" src="../../../_images/ex3.2_axon_propagating_AP.png" />
<figcaption>
<p><span class="caption-text">Axon with propagating action potential</span><a class="headerlink" href="#id10" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Note how we explicitly create the prototype axon on '/library', and then
specify it using the <em>cellProto</em> line in the rdesigneur. The moogList
specifies the 3-D display. See below for how to set up and use these
displays.</p>
</section>
<section id="action-potential-collision-in-hh-squid-axon-model">
<h3><a class="toc-backref" href="#id55">Action potential collision in HH Squid axon model</a><a class="headerlink" href="#action-potential-collision-in-hh-squid-axon-model" title="Permalink to this heading">¶</a></h3>
<p><em>ex3.3_AP_collision.py</em></p>
<p>This is identical to the previous example, except that now we deliver current
injection at at two points, the soma and a point along the axon. The modified
stimulus line is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">stimList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;inject&#39;</span><span class="p">,</span> <span class="s1">&#39;(t&gt;0.01 &amp;&amp; t&lt;0.2) * 2e-11&#39;</span> <span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;axon100&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;inject&#39;</span><span class="p">,</span> <span class="s1">&#39;(t&gt;0.01 &amp;&amp; t&lt;0.2) * 3e-11&#39;</span> <span class="p">]],</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Watch how the AP is triggered bidirectionally from the stimulus point on the
100th segment of the axon, and observe what happens when two action potentials
bump into each other.</p>
<figure class="align-default" id="id11">
<img alt="Colliding action potentials" src="../../../_images/ex3.3_AP_collision.png" />
<figcaption>
<p><span class="caption-text">Colliding action potentials</span><a class="headerlink" href="#id11" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="hh-squid-model-in-a-myelinated-axon">
<h3><a class="toc-backref" href="#id56">HH Squid model in a myelinated axon</a><a class="headerlink" href="#hh-squid-model-in-a-myelinated-axon" title="Permalink to this heading">¶</a></h3>
<p><em>ex3.4_myelinated_axon.py</em></p>
<p>This is a curious cross-species chimera model, where we embed the HH
equations into a myelinated example model. As for the regular axon
above, most of the example is boilerplate setup code. Note how we
restrict the HH channels to the nodes of Ranvier using a conditional
test for the diameter of the axon segment.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>

<span class="n">numAxonSegments</span> <span class="o">=</span> <span class="mi">405</span>
<span class="n">nodeSpacing</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">comptLen</span> <span class="o">=</span> <span class="mf">10e-6</span>
<span class="n">comptDia</span> <span class="o">=</span> <span class="mf">2e-6</span> <span class="c1"># 2x usual</span>
<span class="n">RM</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="c1"># 10x usual</span>
<span class="n">RA</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="n">CM</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1"># 0.1x usual</span>

<span class="n">nodeDia</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="n">nodeRM</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">nodeCM</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="k">def</span><span class="w"> </span><span class="nf">makeAxonProto</span><span class="p">():</span>
    <span class="n">axon</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Neuron</span><span class="p">(</span> <span class="s1">&#39;/library/axon&#39;</span> <span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">prev</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">buildCompt</span><span class="p">(</span> <span class="n">axon</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="n">RM</span> <span class="o">=</span> <span class="n">RM</span><span class="p">,</span> <span class="n">RA</span> <span class="o">=</span> <span class="n">RA</span><span class="p">,</span> <span class="n">CM</span> <span class="o">=</span> <span class="n">CM</span><span class="p">,</span> <span class="n">dia</span> <span class="o">=</span> <span class="mf">10e-6</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="n">comptLen</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">comptLen</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">numAxonSegments</span> <span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">comptLen</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">comptLen</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">theta</span> <span class="p">)</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">comptLen</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="n">theta</span> <span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span> <span class="p">)</span>
        <span class="n">theta</span> <span class="o">+=</span> <span class="n">comptLen</span> <span class="o">/</span> <span class="n">r</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">nodeSpacing</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">compt</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">buildCompt</span><span class="p">(</span> <span class="n">axon</span><span class="p">,</span> <span class="s1">&#39;axon&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">RM</span> <span class="o">=</span> <span class="n">nodeRM</span><span class="p">,</span> <span class="n">RA</span> <span class="o">=</span> <span class="n">RA</span><span class="p">,</span> <span class="n">CM</span> <span class="o">=</span> <span class="n">nodeCM</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dia</span> <span class="o">=</span> <span class="n">nodeDia</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">compt</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">buildCompt</span><span class="p">(</span> <span class="n">axon</span><span class="p">,</span> <span class="s1">&#39;axon&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">RM</span> <span class="o">=</span> <span class="n">RM</span><span class="p">,</span> <span class="n">RA</span> <span class="o">=</span> <span class="n">RA</span><span class="p">,</span> <span class="n">CM</span> <span class="o">=</span> <span class="n">CM</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dia</span> <span class="o">=</span> <span class="n">comptDia</span> <span class="p">)</span>
        <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">prev</span><span class="p">,</span> <span class="s1">&#39;axial&#39;</span><span class="p">,</span> <span class="n">compt</span><span class="p">,</span> <span class="s1">&#39;raxial&#39;</span> <span class="p">)</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">compt</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="n">dx</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="n">dy</span>

    <span class="k">return</span> <span class="n">axon</span>

<span class="n">moose</span><span class="o">.</span><span class="n">Neutral</span><span class="p">(</span> <span class="s1">&#39;/library&#39;</span> <span class="p">)</span>
<span class="n">makeAxonProto</span><span class="p">()</span>

<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">chanProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;make_HH_Na()&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;make_HH_K()&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">]],</span>
    <span class="n">cellProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;elec&#39;</span><span class="p">,</span><span class="s1">&#39;axon&#39;</span><span class="p">]],</span>
    <span class="n">chanDistrib</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;12000 * (dia &lt; 1.5e-6)&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;3600 * (dia &lt; 1.5e-6)&#39;</span> <span class="p">]],</span>
    <span class="n">stimList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;inject&#39;</span><span class="p">,</span> <span class="s1">&#39;(t&gt;0.01 &amp;&amp; t&lt;0.2) * 1e-10&#39;</span> <span class="p">]],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma,axon100,axon200,axon300,axon400&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Membrane potential&#39;</span><span class="p">]],</span>
    <span class="n">moogList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm (mV)&#39;</span><span class="p">]]</span>
<span class="p">)</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">moose</span><span class="o">.</span><span class="n">wildcardFind</span><span class="p">(</span> <span class="s2">&quot;/model/elec/#/Na&quot;</span> <span class="p">):</span>
    <span class="nb">print</span> <span class="n">i</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">Gbar</span>

<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">displayMoogli</span><span class="p">(</span> <span class="mf">0.00005</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">)</span>
</pre></div>
</div>
<p>When you run the example, keep an eye out for a few things:</p>
<ul class="simple">
<li><p><strong>saltatory conduction:</strong> This is the way the action potential jumps
from one node of Ranvier to the next. Between the nodes it is just
passive propagation.</p></li>
<li><p><strong>Failure to propagate:</strong> Observe that the second and fourth action
potentials fails to trigger propagation along the axon. Here we have
specially tuned the model properties so that this happens. With a
larger RA of 10.0, the model will be more reliable.</p></li>
<li><p><strong>Speed:</strong> Compare the propagation speed with the previous,
unmyelinated axon. Note that the current model is larger!</p></li>
</ul>
<figure class="align-default" id="id12">
<img alt="Myelinated axon with propagating action potential" src="../../../_images/rdes3.2_myelinated_axon.png" />
<figcaption>
<p><span class="caption-text">Myelinated axon with propagating action potential</span><a class="headerlink" href="#id12" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="alternate-non-squid-way-to-define-soma">
<h3><a class="toc-backref" href="#id57">Alternate (non-squid) way to define soma</a><a class="headerlink" href="#alternate-non-squid-way-to-define-soma" title="Permalink to this heading">¶</a></h3>
<p><em>ex4.0_scaledSoma.py</em></p>
<p>The default HH-squid axon is not a very convincing soma. Rdesigneur offers a
somewhat more general way to define the soma in the  cell prototype line.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="c1"># cellProto syntax: [&#39;somaProto&#39;, &#39;name&#39;, dia, length]</span>
    <span class="n">cellProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;somaProto&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="mf">20e-6</span><span class="p">,</span> <span class="mf">200e-6</span><span class="p">]],</span>
    <span class="n">chanProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;make_HH_Na()&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;make_HH_K()&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">]],</span>
    <span class="n">chanDistrib</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;1200&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;360&#39;</span> <span class="p">]],</span>
    <span class="n">stimList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;inject&#39;</span><span class="p">,</span> <span class="s1">&#39;(t&gt;0.01 &amp;&amp; t&lt;0.05) * 1e-9&#39;</span> <span class="p">]],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Membrane potential&#39;</span><span class="p">]],</span>
    <span class="n">moogList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm (mV)&#39;</span><span class="p">]]</span>
<span class="p">)</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">soma</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/elec/soma&#39;</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;Soma dia = </span><span class="si">{}</span><span class="s1">, length = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">soma</span><span class="o">.</span><span class="n">diameter</span><span class="p">,</span> <span class="n">soma</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">displayMoogli</span><span class="p">(</span> <span class="mf">0.0005</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">)</span>
</pre></div>
</div>
<p>Here the crucial line is the <em>cellProto</em> line. There are four arguments here:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">['somaProto',</span> <span class="pre">'name',</span> <span class="pre">dia,</span> <span class="pre">length]</span></code></p>
<ul class="simple">
<li><p>The first argument tells the system to use a prototype soma, that is
a single cylindrical compartment.</p></li>
<li><p>The second argument is the name to give the cell.</p></li>
<li><p>The third argument is the diameter. Note that this is a double,
not a string.</p></li>
<li><p>The fourth argument is the length of the cylinder that makes up the
soma. This too is a double, not a string.
The cylinder is oriented along the x axis, with one end at (0,0,0)
and the other end at (length, 0, 0).</p></li>
</ul>
</div></blockquote>
<p>This is what the soma looks like:</p>
<figure class="align-default" id="id13">
<img alt="Image of soma." src="../../../_images/ex4.0_scaledSoma.png" />
<figcaption>
<p><span class="caption-text">Image of soma.</span><a class="headerlink" href="#id13" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>It a somewhat elongated soma, being a cylinder 10 times as long as it is wide.</p>
</section>
<section id="ball-and-stick-model-of-a-neuron">
<h3><a class="toc-backref" href="#id58">Ball-and-stick model of a neuron</a><a class="headerlink" href="#ball-and-stick-model-of-a-neuron" title="Permalink to this heading">¶</a></h3>
<p><em>ex4.1_ballAndStick.py</em></p>
<p>A somewhat more electrically reasonable model of a neuron has a soma and a
single dendrite, which can itself be subdivided into segments so that it
can exhibit voltage gradients, have channel and receptor distributions,
and so on. This is accomplished in <em>rdesigneur</em> using a variant of the
cellProto syntax.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="c1"># cellProto syntax: [&#39;ballAndStick&#39;, &#39;name&#39;, somaDia, somaLength, dendDia, dendLength, numDendSegments ]</span>
    <span class="c1"># The numerical arguments are all optional</span>
    <span class="n">cellProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;ballAndStick&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="mf">20e-6</span><span class="p">,</span> <span class="mf">20e-6</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">,</span> <span class="mf">500e-6</span><span class="p">,</span> <span class="mi">10</span><span class="p">]],</span>
    <span class="n">chanProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;make_HH_Na()&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;make_HH_K()&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">]],</span>
    <span class="n">chanDistrib</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;1200&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;360&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="s1">&#39;dend#&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;400&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;dend#&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;120&#39;</span> <span class="p">]</span>
        <span class="p">],</span>
    <span class="n">stimList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;inject&#39;</span><span class="p">,</span> <span class="s1">&#39;(t&gt;0.01 &amp;&amp; t&lt;0.05) * 1e-9&#39;</span> <span class="p">]],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Membrane potential&#39;</span><span class="p">]],</span>
    <span class="n">moogList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm (mV)&#39;</span><span class="p">]]</span>
<span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">soma</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/elec/soma&#39;</span> <span class="p">)</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">displayMoogli</span><span class="p">(</span> <span class="mf">0.0005</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">)</span>
</pre></div>
</div>
<p>As before, the <em>cellProto</em> line plays a key role. Here, because we have a long
dendrite, we have a few more numerical arguments. All of the numerical
arguments are optional.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">['ballAndStick',</span> <span class="pre">'name',</span> <span class="pre">somaDia,</span> <span class="pre">somaLength,</span> <span class="pre">dendDia,</span> <span class="pre">dendLength,</span> <span class="pre">numDendSegments</span> <span class="pre">]</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p>The first argument specifies a ballAndStick model: soma + dendrite.
The length of the dendrite is along the x axis. The soma is a single
segment, the dendrite can be more than one.</p></li>
<li><p>The second argument is the name to give the cell.</p></li>
<li><p>Arg 3 is the soma diameter, as a double.</p></li>
<li><p>Arg 4 is the length of the soma, as a double.</p></li>
<li><p>Arg 5 is the diameter of the dendrite, as a double.</p></li>
<li><p>Arg 6 is the length of the dendrite, as a double.</p></li>
<li><p>Arg 7 is the number of segments into which the dendrite should be
divided. This is a positive integer greater than 0.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<p>This is what the ball-and-stick cell looks like:</p>
<figure class="align-default" id="id14">
<img alt="Image of ball and stick cell." src="../../../_images/ex4.1_ballAndStick.png" />
<figcaption>
<p><span class="caption-text">Image of ball and stick cell.</span><a class="headerlink" href="#id14" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>In this version of the 3-D display, the soma is displayed as a bit blocky
rather than round.
Note that we have populated the dendrite with Na and K channels and it has
10 segments, so it supports action potential propagation. The snapshot
illustrates this.</p>
<p>Here are some things to try:</p>
<blockquote>
<div><ul class="simple">
<li><p>Change the length of the dendrite</p></li>
<li><p>Change the number of segments. Explore what it does to accuracy. How
will you know that you have an accurate model?</p></li>
</ul>
</div></blockquote>
</section>
<section id="benchmarking-simulation-speed">
<h3><a class="toc-backref" href="#id59">Benchmarking simulation speed</a><a class="headerlink" href="#benchmarking-simulation-speed" title="Permalink to this heading">¶</a></h3>
<p><em>ex4.2_ballAndStickSpeed.py</em></p>
<p>The ball-and-stick model gives us an opportunity to check out your system
and how computation scales with model size. While we're at it we'll deliver
a sine-wave stimulus just to see how it can be done. The test model is
very similar to the previous one, ex4.1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">cellProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;ballAndStick&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="mf">20e-6</span><span class="p">,</span> <span class="mf">20e-6</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">,</span> <span class="mf">500e-6</span><span class="p">,</span> <span class="mi">10</span><span class="p">]],</span>
    <span class="n">chanProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;make_HH_Na()&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;make_HH_K()&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">]],</span>
    <span class="n">chanDistrib</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;1200&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;360&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="s1">&#39;dend#&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;400&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;dend#&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;120&#39;</span> <span class="p">]</span>
    <span class="p">],</span>
    <span class="n">stimList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;inject&#39;</span><span class="p">,</span> <span class="s1">&#39;(1+cos(t/10))*(t&gt;31.4 &amp;&amp; t&lt;94) * 0</span>
<span class="mf">.2e-9</span><span class="s1">&#39; ]],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Membrane potential&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;inject&#39;</span><span class="p">,</span> <span class="s1">&#39;Stimulus current&#39;</span><span class="p">]</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">runtime</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">t0</span><span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="n">runtime</span> <span class="p">)</span>
<span class="nb">print</span> <span class="s2">&quot;Real time to run </span><span class="si">{}</span><span class="s2"> simulated seconds = </span><span class="si">{}</span><span class="s2"> seconds&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">runtime</span><span class="p">,</span> <span class="n">time</span>
<span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span> <span class="p">)</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<p>While the real point of this simulation is to check speed, it does illustrate
how to deliver a stimulus shaped like a sine wave:</p>
<figure class="align-default" id="id15">
<img alt="Sine-wave shaped stimulus." src="../../../_images/ex4.2_sine_stim.png" />
<figcaption>
<p><span class="caption-text">Sine-wave shaped stimulus.</span><a class="headerlink" href="#id15" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>We can see that the cell has a peculiar response to this. Not surprising, as
the cell uses HH channels which are not good at rate coding.</p>
<figure class="align-default" id="id16">
<img alt="Spiking response to sine-wave shaped stimulus." src="../../../_images/ex4.2_spiking.png" />
<figcaption>
<p><span class="caption-text">Spiking response to sine-wave shaped stimulus.</span><a class="headerlink" href="#id16" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>As a reference point, on a fast 2018 laptop this benchmark runs in 5.4 seconds.
Some more things to try for benchmarking:</p>
<blockquote>
<div><ul class="simple">
<li><p>How slow does it get if you turn on the 3-D moogli display?</p></li>
<li><p>Is it costlier to run 2 compartments for 1000 seconds, or
200 compartments for 10 seconds?</p></li>
</ul>
</div></blockquote>
</section>
<section id="synaptic-stimulus-random-possion">
<h3><a class="toc-backref" href="#id60">Synaptic stimulus: random (Possion)</a><a class="headerlink" href="#synaptic-stimulus-random-possion" title="Permalink to this heading">¶</a></h3>
<p><em>ex5.0_random_syn_input.py</em></p>
<p>In this example we introduce synaptic inputs: both the receptor channels
and a means for stimulating the channels. We do this in a passive model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">cellProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;somaProto&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="mf">20e-6</span><span class="p">,</span> <span class="mf">200e-6</span><span class="p">]],</span>
    <span class="n">chanProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;make_glu()&#39;</span><span class="p">,</span> <span class="s1">&#39;glu&#39;</span><span class="p">]],</span>
    <span class="n">chanDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;glu&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span> <span class="p">]],</span>
    <span class="n">stimList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="s1">&#39;glu&#39;</span><span class="p">,</span> <span class="s1">&#39;randsyn&#39;</span><span class="p">,</span> <span class="s1">&#39;50&#39;</span> <span class="p">]],</span>
    <span class="c1"># Deliver stimulus to glu synapse on soma, at mean 50 Hz Poisson.</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Soma membrane potential&#39;</span><span class="p">]]</span>
<span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mf">0.3</span> <span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<p>Most of the rdesigneur setup uses familiar syntax.</p>
<p>Novelty 1: we use the default built-in glutamate receptor model, in chanProto.
We just put it in the soma at a max conductance of 1 Siemen/sq metre.</p>
<p>Novelty 2: We specify a new kind of stimulus in the stimList:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">['soma',</span> <span class="pre">'0.5',</span> <span class="pre">'glu',</span> <span class="pre">'randsyn',</span> <span class="pre">'50'</span> <span class="pre">]</span></code></p>
</div></blockquote>
<p>Most of this is similar to previous stimLists.</p>
<blockquote>
<div><ul class="simple">
<li><p>arg0: 'soma': the named compartments in the cell to populate with
the <em>glu</em> receptor</p></li>
<li><p>arg1: '0.5': Tell the system to use a uniform synaptic weight of 0.5.
This argument could be a more complicated expression incorporating
spatial arguments. Here it is just uniform.</p></li>
<li><p>arg2: 'glu': Which receptor to stimulate</p></li>
<li><p>arg3: 'randsyn': Apply random (Poisson) synaptic input.</p></li>
<li><p>arg4: '50': Mean firing rate of the Poisson input. Note that this last
argument could be a function of time and hence is quite versatile.</p></li>
</ul>
</div></blockquote>
<p>As the model has no voltage-gated channels, we do not see spiking.</p>
<figure class="align-default" id="id17">
<img alt="Random synaptic input with a Poisson distribution." src="../../../_images/ex5.0_random_syn_input.png" />
<figcaption>
<p><span class="caption-text">Random synaptic input with a Poisson distribution.</span><a class="headerlink" href="#id17" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Things to try: Vary the rate and the weight of the synaptic input.</p>
</section>
<section id="synaptic-stimulus-periodic">
<h3><a class="toc-backref" href="#id61">Synaptic stimulus: periodic</a><a class="headerlink" href="#synaptic-stimulus-periodic" title="Permalink to this heading">¶</a></h3>
<p><em>ex5.1_periodic_syn_input.py</em></p>
<p>This is almost identical to 5.0, except that the input is now perfectly
periodic. The one change is of an argument in the stimList to say
<code class="docutils literal notranslate"><span class="pre">periodicsyn</span></code> rather than <code class="docutils literal notranslate"><span class="pre">randsyn</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">cellProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;somaProto&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="mf">20e-6</span><span class="p">,</span> <span class="mf">200e-6</span><span class="p">]],</span>
    <span class="n">chanProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;make_glu()&#39;</span><span class="p">,</span> <span class="s1">&#39;glu&#39;</span><span class="p">]],</span>
    <span class="n">chanDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;glu&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span> <span class="p">]],</span>

    <span class="c1"># Deliver stimulus to glu synapse on soma, periodically at 50 Hz.</span>
    <span class="n">stimList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="s1">&#39;glu&#39;</span><span class="p">,</span> <span class="s1">&#39;periodicsyn&#39;</span><span class="p">,</span> <span class="s1">&#39;50&#39;</span> <span class="p">]],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Soma membrane potential&#39;</span><span class="p">]]</span>
<span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mf">0.3</span> <span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<p>As designed, we get periodically firing synaptic input.</p>
<figure class="align-default" id="id18">
<img alt="Periodic synaptic input" src="../../../_images/ex5.1_periodic_syn_input.png" />
<figcaption>
<p><span class="caption-text">Periodic synaptic input</span><a class="headerlink" href="#id18" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="reaction-system-in-a-single-compartment">
<h3><a class="toc-backref" href="#id62">Reaction system in a single compartment</a><a class="headerlink" href="#reaction-system-in-a-single-compartment" title="Permalink to this heading">¶</a></h3>
<p><em>ex6_chem_osc.py</em></p>
<p>Here we use the compartment as a place in which to embed a chemical
model. The chemical oscillator model is predefined in the rdesigneur
prototypes. Its general form is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">---</span><span class="n">a</span><span class="o">---&gt;</span> <span class="n">a</span>  <span class="o">//</span> <span class="n">s</span> <span class="n">goes</span> <span class="n">to</span> <span class="n">a</span><span class="p">,</span> <span class="n">catalyzed</span> <span class="n">by</span> <span class="n">a</span><span class="o">.</span>
<span class="n">s</span> <span class="o">---</span><span class="n">a</span><span class="o">---&gt;</span> <span class="n">b</span>  <span class="o">//</span> <span class="n">s</span> <span class="n">goes</span> <span class="n">to</span> <span class="n">b</span><span class="p">,</span> <span class="n">catalyzed</span> <span class="n">by</span> <span class="n">a</span><span class="o">.</span>
<span class="n">a</span> <span class="o">---</span><span class="n">b</span><span class="o">---&gt;</span> <span class="n">s</span>  <span class="o">//</span> <span class="n">a</span> <span class="n">goes</span> <span class="n">to</span> <span class="n">s</span><span class="p">,</span> <span class="n">catalyzed</span> <span class="n">by</span> <span class="n">b</span><span class="o">.</span>
<span class="n">b</span> <span class="o">-------&gt;</span> <span class="n">s</span>  <span class="o">//</span> <span class="n">b</span> <span class="ow">is</span> <span class="n">degraded</span> <span class="n">irreversibly</span> <span class="n">to</span> <span class="n">s</span>
</pre></div>
</div>
<p>Here is the script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
        <span class="n">turnOffElec</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">diffusionLength</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="c1"># Default diffusion length is 2 microns</span>
        <span class="n">chemProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;makeChemOscillator()&#39;</span><span class="p">,</span> <span class="s1">&#39;osc&#39;</span><span class="p">]],</span>
        <span class="n">chemDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;osc&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span> <span class="p">]],</span>
        <span class="n">plotList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/a&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;a Conc&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/b&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;b Conc&#39;</span><span class="p">]]</span>
<span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/chem/dend/b&#39;</span> <span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">concInit</span> <span class="o">*=</span> <span class="mi">5</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mi">200</span> <span class="p">)</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<p>In this special case we set the turnOffElec flag to True, so that
Rdesigneur only sets up chemical and not electrical calculations. This
makes the calculations much faster, since we disable electrical
calculations and delink chemical calculations from them.</p>
<p>We also have a line which sets the <code class="docutils literal notranslate"><span class="pre">diffusionLength</span></code> to 1 mm, so that
it is bigger than the 0.5 mm squid axon segment in the default
compartment. If you don't do this the system will subdivide the
compartment into the default 2 micron voxels for the purposes of putting
in a reaction-diffusion system. We discuss this case below.</p>
<p>Note how the <em>plotList</em> is done here. To remind you, each entry has five
arguments</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">region_in_cell</span><span class="p">,</span> <span class="n">region_expression</span><span class="p">,</span> <span class="n">moose_object</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">title_of_plot</span><span class="p">]</span>
</pre></div>
</div>
<p>The change from the earlier usage is that the <code class="docutils literal notranslate"><span class="pre">moose_object</span></code> now
refers to a chemical entity, in this example the molecule <em>dend/a</em>. The
simulator builds a default chemical compartment named <em>dend</em> to hold the
reactions defined in the <em>chemProto</em>. What we do in this plot is to
select molecule <em>a</em> sitting in <em>dend</em>, and plot its concentration. Then
we do this again for molecule <em>b</em>.</p>
<p>After the model is built, we add a couple of lines to change the initial
concentration of the molecular pool <em>b</em>. Note its full path within
MOOSE: <em>/model/chem/dend/b</em>. It is scaled up 5x to give rise to slowly
decaying oscillations.</p>
<figure class="align-default" id="id19">
<img alt="Plot for single-compartment reaction simulation" src="../../../_images/rdes4_osc.png" />
<figcaption>
<p><span class="caption-text">Plot for single-compartment reaction simulation</span><a class="headerlink" href="#id19" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="reaction-diffusion-system">
<h3><a class="toc-backref" href="#id63">Reaction-diffusion system</a><a class="headerlink" href="#reaction-diffusion-system" title="Permalink to this heading">¶</a></h3>
<p><em>ex7.0_spatial_chem_osc.py</em></p>
<p>In order to see what a reaction-diffusion system looks like, we assign the
<code class="docutils literal notranslate"><span class="pre">diffusionLength</span></code> expression in the previous example to a much shorter
length, and add a couple of lines to set up 3-D graphics for the
reaction-diffusion product:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
        <span class="n">turnOffElec</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="c1">#This subdivides the length of the soma into 2 micron voxels</span>
        <span class="n">diffusionLength</span> <span class="o">=</span> <span class="mf">2e-6</span><span class="p">,</span>
        <span class="n">chemProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;makeChemOscillator()&#39;</span><span class="p">,</span> <span class="s1">&#39;osc&#39;</span><span class="p">]],</span>
        <span class="n">chemDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;osc&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span> <span class="p">]],</span>
        <span class="n">plotList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/a&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Concentration of a&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/b&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Concentration of b&#39;</span><span class="p">]],</span>
        <span class="n">moogList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/a&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;a Conc&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span> <span class="p">]]</span>
<span class="p">)</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">bv</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">vec</span><span class="p">(</span> <span class="s1">&#39;/model/chem/dend/b&#39;</span> <span class="p">)</span>
<span class="n">bv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">concInit</span> <span class="o">*=</span> <span class="mi">2</span>
<span class="n">bv</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">concInit</span> <span class="o">*=</span> <span class="mi">2</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">displayMoogli</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">azim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="p">)</span>
</pre></div>
</div>
<p>This is the new value for diffusion length.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">diffusionLength</span> <span class="o">=</span> <span class="mf">2e-3</span><span class="p">,</span>
</pre></div>
</div>
<p>With this change we tell <em>rdesigneur</em> to use the diffusion length of 2 microns.
This happens to be the default too. The 500-micron axon segment is now
subdivided into 250 voxels, each of which has a reaction system and
diffusing molecules.
To make it more picturesque, we have added a line after the plotList, to
display the outcome in 3-D:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">moogList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/a&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;a Conc&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span> <span class="p">]]</span>
</pre></div>
</div>
<p>This line says: take the model compartments defined by <code class="docutils literal notranslate"><span class="pre">soma</span></code> as the
region to display, do so throughout the the geometry (the <code class="docutils literal notranslate"><span class="pre">1</span></code>
signifies this), and over this range find the chemical entity defined by
<code class="docutils literal notranslate"><span class="pre">dend/a</span></code>. For each <code class="docutils literal notranslate"><span class="pre">a</span></code> molecule, find the <code class="docutils literal notranslate"><span class="pre">conc</span></code> and dsiplay it.
There are two optional arguments, <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">360</span></code>, which specify the
low and high value of the displayed variable.</p>
<p>In order to initially break the symmetry of the system, we change the
initial concentration of molecule b at each end of the cylinder:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">concInit</span> <span class="o">*=</span> <span class="mi">2</span>
<span class="n">bv</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">concInit</span> <span class="o">*=</span> <span class="mi">2</span>
</pre></div>
</div>
<p>If we didn't do this the entire system would go through a few cycles of
decaying oscillation and then reach a boring, spatially uniform, steady
state. Try putting an initial symmetry break elsewhere to see what
happens.</p>
<p>To display the concenctration changes in the 3-D soma as the simulation
runs, we use the line</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rdes</span><span class="o">.</span><span class="n">displayMoogli</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">azim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="p">)</span>
</pre></div>
</div>
<p>The arguments mean: <em>displayMoogli( frametime, runtime, rotation, azimuth, elevation )</em>
Here,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">frametime</span> <span class="o">=</span> <span class="n">time</span> <span class="n">by</span> <span class="n">which</span> <span class="n">simulation</span> <span class="n">advances</span> <span class="n">between</span> <span class="n">display</span> <span class="n">updates</span>
<span class="n">runtime</span> <span class="o">=</span> <span class="n">Total</span> <span class="n">simulated</span> <span class="n">time</span>
<span class="n">rotation</span> <span class="o">=</span> <span class="n">angle</span> <span class="n">by</span> <span class="n">which</span> <span class="n">display</span> <span class="n">rotates</span> <span class="ow">in</span> <span class="n">each</span> <span class="n">frame</span><span class="p">,</span> <span class="ow">in</span> <span class="n">radians</span><span class="o">.</span>
<span class="n">azimuth</span> <span class="o">=</span> <span class="n">Azimuth</span> <span class="n">angle</span> <span class="n">of</span> <span class="n">view</span> <span class="n">point</span><span class="p">,</span> <span class="ow">in</span> <span class="n">radians</span>
<span class="n">elevation</span> <span class="o">=</span> <span class="n">elevation</span> <span class="n">angle</span> <span class="n">of</span> <span class="n">view</span> <span class="n">point</span><span class="p">,</span> <span class="ow">in</span> <span class="n">radians</span>
</pre></div>
</div>
<p>When we run this, we first get a 3-D display with the oscillating
reaction-diffusion system making its way inward from the two ends. After
the simulation ends the plots for all compartments for the whole run
come up.</p>
<figure class="align-default" id="id20">
<img alt="Display for oscillatory reaction-diffusion simulation" src="../../../_images/rdes5_reacdiff.png" />
<figcaption>
<p><span class="caption-text">Display for oscillatory reaction-diffusion simulation</span><a class="headerlink" href="#id20" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>For those who would rather use the much simpler matplotlib 3-D display option,
this is what the same simulation looks like:</p>
<figure class="align-default" id="id21">
<img alt="Display for oscillatory reac-diff simulation using matplotlib" src="../../../_images/ex7.0_spatial_chem_osc.png" />
<figcaption>
<p><span class="caption-text">Display for oscillatory reac-diff simulation using matplotlib</span><a class="headerlink" href="#id21" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="primer-on-using-the-3-d-moogli-display">
<span id="moogli-primer"></span><h3><a class="toc-backref" href="#id64">Primer on using the 3-D MOOGLI display</a><a class="headerlink" href="#primer-on-using-the-3-d-moogli-display" title="Permalink to this heading">¶</a></h3>
<p>There are two variants of the MOOGLI display. The first, named Moogli,
uses OpenGL and OpenSceneGraph. It is fast to display, slow to load, and
difficult to compile. It produces much better looking 3-D graphics.
The second is a fallback interface using mplot3d, which is a library of
Matplotlib and so should be generally available. It is slower to display,
faster to load, but needs no special compilation. It uses stick graphics
and though it conveys much the same information, isn't as nice to look at
as the original Moogli. Its controls are more or less the same but less
smooth than the original Moogli.</p>
<p>Here is a short primer on the 3-D display controls.</p>
<ul>
<li><p><em>Roll, pitch, and yaw</em>: Use the letters <em>r</em>, <em>p</em>, and <em>y</em>. To rotate
backwards, use capitals.</p></li>
<li><p><em>Zoom out and in</em>: Use the <em>,</em> and <em>.</em> keys, or their upper-case
equivalents, <em>&lt;</em> and <em>&gt;</em>. Easier to remember if you think in terms of
the upper-case.</p></li>
<li><p><em>Left/right/up/down</em>: Arrow keys.</p></li>
<li><p><em>Quit</em>: control-q or control-w.</p></li>
<li><p>You can also use the mouse or trackpad to control most of the above.</p></li>
<li><p>By default rdesigneur gives Moogli a small rotation each frame. It is
the <em>rotation</em> argument in the line:</p>
<p><code class="docutils literal notranslate"><span class="pre">displayMoogli(</span> <span class="pre">frametime,</span> <span class="pre">runtime,</span> <span class="pre">rotation</span> <span class="pre">)</span></code></p>
</li>
</ul>
<p>These controls operate over and above this rotation, but the rotation
continues. If you set the rotation to zero you can, with a suitable
flick of the mouse, get the image to rotate in any direction you choose
as long as the window is updating.</p>
</section>
<section id="diffusion-of-a-single-molecule">
<h3><a class="toc-backref" href="#id65">Diffusion of a single molecule</a><a class="headerlink" href="#diffusion-of-a-single-molecule" title="Permalink to this heading">¶</a></h3>
<p><em>ex7.1_diffusive_gradient.py</em></p>
<p>This is simply a test model to confirm that simple diffusion happens as
expected. While the model is just that of a single pool, we spend a few lines
taking snapshots of the spatial profile of this pool.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">moose</span><span class="o">.</span><span class="n">Neutral</span><span class="p">(</span> <span class="s1">&#39;/library&#39;</span> <span class="p">)</span>
<span class="n">moose</span><span class="o">.</span><span class="n">Neutral</span><span class="p">(</span> <span class="s1">&#39;/library/diffn&#39;</span> <span class="p">)</span>
<span class="n">moose</span><span class="o">.</span><span class="n">CubeMesh</span><span class="p">(</span> <span class="s1">&#39;/library/diffn/dend&#39;</span> <span class="p">)</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/library/diffn/dend/A&#39;</span> <span class="p">)</span>
<span class="n">A</span><span class="o">.</span><span class="n">diffConst</span> <span class="o">=</span> <span class="mf">1e-10</span>

<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">turnOffElec</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">diffusionLength</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
    <span class="n">chemProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;diffn&#39;</span><span class="p">,</span> <span class="s1">&#39;diffn&#39;</span><span class="p">]],</span>
    <span class="n">chemDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;diffn&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span> <span class="p">]],</span>
    <span class="n">moogList</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/A&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;A Conc&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span> <span class="p">]</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">displayMoogli</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">azim</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">block</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span>
<span class="n">av</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">vec</span><span class="p">(</span> <span class="s1">&#39;/model/chem/dend/A&#39;</span> <span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">av</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">plist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">20</span> <span class="p">):</span>
    <span class="n">plist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">av</span><span class="o">.</span><span class="n">conc</span><span class="p">[:</span><span class="mi">200</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mi">2</span> <span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">plist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">plist</span> <span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200</span> <span class="p">),</span> <span class="n">plist</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span> <span class="s2">&quot;position ( microns )&quot;</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span> <span class="s2">&quot;concentration ( mM )&quot;</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span> <span class="n">block</span> <span class="o">=</span> <span class="kc">True</span> <span class="p">)</span>
</pre></div>
</div>
<p>Here are the snapshots, overlaid in a single plot:</p>
<figure class="align-default" id="id22">
<img alt="Display of how a molecule A spreads through the inter" src="../../../_images/ex7.1_diffusive_gradient.png" />
<figcaption>
<p><span class="caption-text">Display for simple time-series of spread of a diffusing molecule
using matplotlib</span><a class="headerlink" href="#id22" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="calcium-induced-calcium-release">
<h3><a class="toc-backref" href="#id66">Calcium-induced calcium release</a><a class="headerlink" href="#calcium-induced-calcium-release" title="Permalink to this heading">¶</a></h3>
<p id="models-of-calcium-induced-calcium-release"><em>ex7.2_CICR.py</em></p>
<p>This is a somewhat more complex reaction-diffusion system, involving calcium
release from intracellular stores that propagates in a wave of activity along
a dendrite. This example demonstrates the use of endo compartments.</p>
<p>Endo-compartments, as the name suggests, represent compartments that sit
within other cellular compartments. If the surround compartment is subdivided
into N voxels, so is the endo- compartment. The rdesigneur system looks at the
provided model, and if there are 2 compartments and the <em>addEndoChemCompt</em> flag
is True, then the chemistry contained in the smaller of the two compartments is
positioned in an endo compartment surrounded by the first compartment.
Here we use the endo-compartment to represent the endoplasmic reticulum sitting
inside the dendrite.</p>
<p>In the chemical model, we also introduce a new MOOSE class,
ConcChan. These act as membrane pores whose permeability scales with
number of channels in the open state. The IP3 receptor in this model is
implemented as a ConcChan which opens due to binding to IP3 and Calcium.
This leads to the release of more calcium from the ER, and this feedback
loop develops into a propagating-wave oscillation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">turnOffElec</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">chemDt</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">,</span>
    <span class="n">chemPlotDt</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">,</span>
    <span class="n">diffusionLength</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
    <span class="n">useGssa</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">addSomaChemCompt</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">addEndoChemCompt</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="c1"># cellProto syntax: [&#39;somaProto&#39;, &#39;name&#39;, dia, length]</span>
    <span class="n">cellProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;somaProto&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">,</span> <span class="mf">10e-6</span><span class="p">]],</span>
    <span class="n">chemProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;./chem/CICRwithConcChan.g&#39;</span><span class="p">,</span> <span class="s1">&#39;chem&#39;</span><span class="p">]],</span>
    <span class="n">chemDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;chem&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span> <span class="p">]],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/CaCyt&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Dendritic Ca&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/CaCyt&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Dendritic Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;wave&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend_endo/CaER&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;ER Ca&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/ActIP3R&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;active IP3R&#39;</span><span class="p">],</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">IP3</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/chem/dend/IP3&#39;</span> <span class="p">)</span>
<span class="n">IP3</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mf">0.004</span>
<span class="n">IP3</span><span class="o">.</span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mf">0.02</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mi">40</span> <span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<p>Note how the dendritic calcium is displayed both as a time-series plot and
as a wave plot, which presents the time-evolution of the calcium as a function
of position in successive image frames.</p>
<figure class="align-default" id="id23">
<img alt="Time-series plot of dendritic calcium. Different colors represent different voxels in the dendrite." src="../../../_images/ex7.2_CICR_static.png" />
<figcaption>
<p><span class="caption-text">Time-series plot of dendritic calcium. Different colors represent
different voxels in the dendrite.</span><a class="headerlink" href="#id23" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id24">
<img alt="../../../_images/ex7.2_CICR_wave_lastFrame.png" src="../../../_images/ex7.2_CICR_wave_lastFrame.png" />
<figcaption>
<p><span class="caption-text">Place holder for time-evolving movie of dendritic calcium as a function of
position along the dendrite.</span><a class="headerlink" href="#id24" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="intracellular-transport">
<h3><a class="toc-backref" href="#id67">Intracellular transport</a><a class="headerlink" href="#intracellular-transport" title="Permalink to this heading">¶</a></h3>
<p><em>ex7.3_simple_transport.py</em></p>
<p>This illustrates how intracellular transport works in MOOSE. We have a
an elongated soma in which molecules start out at the left and are transported
to the right. Note that they spread out as they go along,
This is because the transport is implemented as drift-diffusion, in which a
fraction of the molecules move to the next location each timestep. The
equation is</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">flux</span> <span class="pre">=</span> <span class="pre">motorConst</span> <span class="pre">*</span> <span class="pre">conc</span> <span class="pre">/</span> <span class="pre">spacing</span></code></p>
</div></blockquote>
<p>for a uniform cylinder. MOOSE applies suitable scaling terms if the neuronal
geometry is non-uniform.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>

<span class="n">moose</span><span class="o">.</span><span class="n">Neutral</span><span class="p">(</span> <span class="s1">&#39;/library&#39;</span> <span class="p">)</span>
<span class="n">moose</span><span class="o">.</span><span class="n">Neutral</span><span class="p">(</span> <span class="s1">&#39;/library/transp&#39;</span> <span class="p">)</span>
<span class="n">moose</span><span class="o">.</span><span class="n">CubeMesh</span><span class="p">(</span> <span class="s1">&#39;/library/transp/dend&#39;</span> <span class="p">)</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/library/transp/dend/A&#39;</span> <span class="p">)</span>
<span class="n">A</span><span class="o">.</span><span class="n">diffConst</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">A</span><span class="o">.</span><span class="n">motorConst</span> <span class="o">=</span> <span class="mf">1e-6</span>     <span class="c1"># Metres/sec</span>

<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">turnOffElec</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="c1">#This subdivides the length of the soma into 0.5 micron voxels</span>
    <span class="n">diffusionLength</span> <span class="o">=</span> <span class="mf">0.5e-6</span><span class="p">,</span>
    <span class="n">cellProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;somaProto&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">,</span> <span class="mf">50e-6</span><span class="p">]],</span>
    <span class="n">chemProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;transp&#39;</span><span class="p">,</span> <span class="s1">&#39;transp&#39;</span><span class="p">]],</span>
    <span class="n">chemDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;transp&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span> <span class="p">]],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/A&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Concentration of A&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/A&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Concentration of A&#39;</span><span class="p">,</span> <span class="s1">&#39;wave&#39;</span><span class="p">],</span>
    <span class="p">],</span>
    <span class="n">moogList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/A&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;A Conc&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span> <span class="p">]]</span>
<span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/chem/dend/A[0]&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">displayMoogli</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">azim</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="p">)</span>
</pre></div>
</div>
<p>In this example we explicitly create the single-molecule reaction system,
and assign a motorConst of 1 micron/sec to the molecule A. We start off with
all the molecules in a single voxel on the left of the cylinder, and then
watch the molecules move.
Once the molecules reach the end of the cylindrical soma, they have nowhere
further to go so they pile up.</p>
<figure class="align-default">
<img alt="Transport frame 1." src="../../../_images/ex7.3_1.png" />
</figure>
<figure class="align-default">
<img alt="Transport frame 2." src="../../../_images/ex7.3_2.png" />
</figure>
<figure class="align-default">
<img alt="Transport frame 3." src="../../../_images/ex7.3_3.png" />
</figure>
<figure class="align-default">
<img alt="Transport frame 4." src="../../../_images/ex7.3_4.png" />
</figure>
<figure class="align-default">
<img alt="Transport frame 5." src="../../../_images/ex7.3_5.png" />
</figure>
<figure class="align-default" id="id25">
<img alt="Transport frame 6." src="../../../_images/ex7.3_6.png" />
<figcaption>
<p><span class="caption-text">Frames at increasing intervals from the transport simulation showing
spreading and piling up of the molecule at the right end of the cylinder.</span><a class="headerlink" href="#id25" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Suggestions:</p>
<blockquote>
<div><ul class="simple">
<li><p>Play with different motor rates.</p></li>
<li><p>The motor constant sign detemines the direction of transport. See
what happens if you get it going in the opposite direction.</p></li>
<li><p>Consider how you could avoid the buildup in the last voxel.</p></li>
<li><p>Consider how to achieve a nice exponential falloff over a
much longer range than possible with diffusion.</p></li>
</ul>
</div></blockquote>
</section>
<section id="travelling-oscillator">
<h3><a class="toc-backref" href="#id68">Travelling oscillator</a><a class="headerlink" href="#travelling-oscillator" title="Permalink to this heading">¶</a></h3>
<p><em>ex7.4_travelling_osc.py</em></p>
<p>Here we put a chemical oscillator into a cylinder, and activate motor transport
in one of the molecules. The oscillatory zone slowly moves to the right, with
an amplification in the last compartment due to end-effects.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">turnOffElec</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">diffusionLength</span> <span class="o">=</span> <span class="mf">2e-6</span><span class="p">,</span>
    <span class="n">chemProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;makeChemOscillator()&#39;</span><span class="p">,</span> <span class="s1">&#39;osc&#39;</span><span class="p">]],</span>
    <span class="n">chemDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;osc&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span> <span class="p">]],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/a&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Concentration of a&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/b&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Concentration of b&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/a&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Concentration of a&#39;</span><span class="p">,</span> <span class="s1">&#39;wave&#39;</span><span class="p">],</span>
    <span class="p">],</span>
    <span class="n">moogList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/a&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;a Conc&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span> <span class="p">]]</span>
<span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/library/osc/kinetics/a&#39;</span> <span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/library/osc/kinetics/b&#39;</span> <span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/library/osc/kinetics/s&#39;</span> <span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">diffConst</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">b</span><span class="o">.</span><span class="n">diffConst</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">a</span><span class="o">.</span><span class="n">motorConst</span> <span class="o">=</span> <span class="mf">1e-6</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">displayMoogli</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">azim</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" id="id26">
<img alt="Travelling Oscillator" src="../../../_images/ex7.4_travelling_osc.png" />
<figcaption>
<p><span class="caption-text">Snapshot of travelling oscillator waveform at t = 198.</span><a class="headerlink" href="#id26" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Suggestions:</p>
<blockquote>
<div><ul class="simple">
<li><p>What happens if all molecules undergo transport?</p></li>
<li><p>What happens if b is transported opposite to a?</p></li>
<li><p>What happens if there is also diffusion?</p></li>
</ul>
</div></blockquote>
</section>
<section id="bidirectional-transport">
<h3><a class="toc-backref" href="#id69">Bidirectional transport</a><a class="headerlink" href="#bidirectional-transport" title="Permalink to this heading">¶</a></h3>
<p><em>ex7.5_bidirectional_transport.py</em></p>
<p>This is almost identical to ex7.4, except that we implement bidirectional
transport. Molecule a goes from left to right, and b and s go from
right to left. Here we see that the system builds up with large oscillations
in the middle as the molecules converge, then the peaks collapse when
the molecules go away.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">turnOffElec</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">diffusionLength</span> <span class="o">=</span> <span class="mf">2e-6</span><span class="p">,</span>
    <span class="n">numWaveFrames</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">chemProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;makeChemOscillator()&#39;</span><span class="p">,</span> <span class="s1">&#39;osc&#39;</span><span class="p">]],</span>
    <span class="n">chemDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;osc&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span> <span class="p">]],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/a&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Concentration of a&#39;</span><span class="p">,</span> <span class="s1">&#39;wave&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1800</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/b&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Concentration of b&#39;</span><span class="p">,</span> <span class="s1">&#39;wave&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/s&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Concentration of s&#39;</span><span class="p">,</span> <span class="s1">&#39;wave&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1200</span><span class="p">],</span>
    <span class="p">],</span>
    <span class="n">moogList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/a&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;a Conc&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">600</span> <span class="p">]]</span>
<span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/library/osc/kinetics/a&#39;</span> <span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/library/osc/kinetics/b&#39;</span> <span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/library/osc/kinetics/s&#39;</span> <span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">diffConst</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">b</span><span class="o">.</span><span class="n">diffConst</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">a</span><span class="o">.</span><span class="n">motorConst</span> <span class="o">=</span> <span class="mf">2e-6</span>
<span class="n">b</span><span class="o">.</span><span class="n">motorConst</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2e-6</span>
<span class="n">s</span><span class="o">.</span><span class="n">motorConst</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2e-6</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">displayMoogli</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">azim</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">elev</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="p">)</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="Travelling Oscillator molecule a" src="../../../_images/ex7.5_a.png" />
</figure>
<figure class="align-default">
<img alt="Travelling Oscillator molecule b" src="../../../_images/ex7.5_b.png" />
</figure>
<figure class="align-default">
<img alt="Travelling Oscillator molecule" src="../../../_images/ex7.5_s.png" />
</figure>
<p>Above we see <em>a</em>, <em>b</em>, <em>s</em> at a point where the transport has collected the
molecules toward the middle of the cylinder, so the oscillations are large.
Below we see molecule <em>a</em> later, when it has gone past the <em>b</em> and <em>s</em> pools
and so the reaction system is depleted and does not oscillate.</p>
<figure class="align-default">
<img alt="Travelling Oscillator molecule a later." src="../../../_images/ex7.5_a_later.png" />
</figure>
</section>
<section id="controlling-a-reaction-by-a-function">
<h3><a class="toc-backref" href="#id70">Controlling a reaction by a function</a><a class="headerlink" href="#controlling-a-reaction-by-a-function" title="Permalink to this heading">¶</a></h3>
<p><em>ex7.6_func_controls_reac_rate.py</em></p>
<p>This example illustrates how a function can be used to control a reaction
rate. This kind of calculation is appropriate when we need to link
different kinds of physical processses with chemical reactions, for
example, membrane curvature with molecule accumulation. The use of
functions to modify reaction rates should be avoided in purely chemical
systems since they obscure the underlying chemistry, and do not map
cleanly to stochastic calculations.</p>
<p>In this example we simply have a molecule C that controls the forward
rate of a reaction that converts A to B. C is a function of location
on the cylinder, and is fixed. In more elaborate computations we could
have a function of multiple molecules, some of which could be changing and
others could be buffered.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>


<span class="k">def</span><span class="w"> </span><span class="nf">makeFuncRate</span><span class="p">():</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Neutral</span><span class="p">(</span> <span class="s1">&#39;/library&#39;</span> <span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Neutral</span><span class="p">(</span> <span class="s1">&#39;/library/chem&#39;</span> <span class="p">)</span>
    <span class="n">compt</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">CubeMesh</span><span class="p">(</span> <span class="s1">&#39;/library/chem/compt&#39;</span> <span class="p">)</span>
    <span class="n">compt</span><span class="o">.</span><span class="n">volume</span> <span class="o">=</span> <span class="mf">1e-15</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/library/chem/compt/A&#39;</span> <span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/library/chem/compt/B&#39;</span> <span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/library/chem/compt/C&#39;</span> <span class="p">)</span>
    <span class="n">reac</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Reac</span><span class="p">(</span> <span class="s1">&#39;/library/chem/compt/reac&#39;</span> <span class="p">)</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span> <span class="s1">&#39;/library/chem/compt/reac/func&#39;</span> <span class="p">)</span>
    <span class="n">func</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">func</span><span class="o">.</span><span class="n">expr</span> <span class="o">=</span> <span class="s2">&quot;(x0/1e8)^2&quot;</span>
    <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">C</span><span class="p">,</span> <span class="s1">&#39;nOut&#39;</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;input&#39;</span> <span class="p">)</span>
    <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">func</span><span class="p">,</span> <span class="s1">&#39;valueOut&#39;</span><span class="p">,</span> <span class="n">reac</span><span class="p">,</span> <span class="s1">&#39;setNumKf&#39;</span> <span class="p">)</span>
    <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">reac</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
    <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">reac</span><span class="p">,</span> <span class="s1">&#39;prd&#39;</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>

    <span class="n">A</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">B</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">C</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">reac</span><span class="o">.</span><span class="n">Kb</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">makeFuncRate</span><span class="p">()</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
        <span class="n">turnOffElec</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="c1">#This subdivides the 50-micron cylinder into 2 micron voxels</span>
        <span class="n">diffusionLength</span> <span class="o">=</span> <span class="mf">2e-6</span><span class="p">,</span>
        <span class="n">cellProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;somaProto&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="mf">5e-6</span><span class="p">,</span> <span class="mf">50e-6</span><span class="p">]],</span>
        <span class="n">chemProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;chem&#39;</span><span class="p">,</span> <span class="s1">&#39;chem&#39;</span><span class="p">]],</span>
        <span class="n">chemDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;chem&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span> <span class="p">]],</span>
        <span class="n">plotList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/A&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;A conc&#39;</span><span class="p">,</span> <span class="s1">&#39;wave&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/C&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;C conc&#39;</span><span class="p">,</span> <span class="s1">&#39;wave&#39;</span><span class="p">]],</span>
<span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/chem/dend/C&#39;</span> <span class="p">)</span>
<span class="n">C</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">5.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">vec</span><span class="p">)</span> <span class="p">)</span> <span class="p">]</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<p>We plot the controlling molecule C and the substrate molecule A as
functions of position, using a waveplot. C remains fixed, and A
decreases with time and space. A is smallest at about voxel 8, where the
reaction rate, as controlled by C, is highest.</p>
<figure class="align-default">
<img alt="Concentration of control molecule C" src="../../../_images/ex7.6_C.png" />
</figure>
<figure class="align-default">
<img alt="Concentration of substrate molecule A" src="../../../_images/ex7.6_A.png" />
</figure>
</section>
<section id="multiscale-models-single-compartment">
<h3><a class="toc-backref" href="#id71">Multiscale models: single compartment</a><a class="headerlink" href="#multiscale-models-single-compartment" title="Permalink to this heading">¶</a></h3>
<p><em>ex8.0_multiscale_KA_phosph.py</em></p>
<p>The next few examples are for the multiscale modeling that is the main purpose
of rdesigneur and MOOSE as a whole. These are 'toy' examples in that the
chemical and electrical signaling is simplified, but they exhibit dynamics
that are of real interest.</p>
<p>The first example is of a bistable system where the feedback loop comprises of</p>
<p><cite>calcium influx -&gt; chemical activity -&gt; channel modulation -&gt; electrical activity -&gt; calcium influx.</cite></p>
<p>Calcium enters through voltage gated calcium channels, leads to enzyme
activation and phosphorylation of a KA channel, which depolarizes the cell,
so it spikes more, so more calcium enters.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">elecDt</span> <span class="o">=</span> <span class="mf">50e-6</span><span class="p">,</span>
    <span class="n">chemDt</span> <span class="o">=</span> <span class="mf">0.002</span><span class="p">,</span>
    <span class="n">chemPlotDt</span> <span class="o">=</span> <span class="mf">0.002</span><span class="p">,</span>
    <span class="c1"># cellProto syntax: [&#39;somaProto&#39;, &#39;name&#39;, dia, length]</span>
    <span class="n">cellProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;somaProto&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="mf">12e-6</span><span class="p">,</span> <span class="mf">12e-6</span><span class="p">]],</span>
    <span class="n">chemProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;./chem/chanPhosphByCaMKII.g&#39;</span><span class="p">,</span> <span class="s1">&#39;chem&#39;</span><span class="p">]],</span>
    <span class="n">chanProto</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;make_Na()&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;make_K_DR()&#39;</span><span class="p">,</span> <span class="s1">&#39;K_DR&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;make_K_A()&#39;</span><span class="p">,</span> <span class="s1">&#39;K_A&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;make_Ca()&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;make_Ca_conc()&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca_conc&#39;</span> <span class="p">]</span>
    <span class="p">],</span>
    <span class="c1"># Some changes to the default passive properties of the cell.</span>
    <span class="n">passiveDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;CM&#39;</span><span class="p">,</span> <span class="s1">&#39;0.03&#39;</span><span class="p">,</span> <span class="s1">&#39;Em&#39;</span><span class="p">,</span> <span class="s1">&#39;-0.06&#39;</span><span class="p">]],</span>
    <span class="n">chemDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;chem&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span> <span class="p">]],</span>
    <span class="n">chanDistrib</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;300&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;K_DR&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;250&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;K_A&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;200&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;Ca_conc&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;tau&#39;</span><span class="p">,</span> <span class="s1">&#39;0.0333&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;40&#39;</span> <span class="p">]</span>
    <span class="p">],</span>
    <span class="n">adaptorList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span> <span class="s1">&#39;dend/chan&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;K_A&#39;</span><span class="p">,</span> <span class="s1">&#39;modulation&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">70</span> <span class="p">],</span>
        <span class="p">[</span> <span class="s1">&#39;Ca_conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="mf">0.00008</span><span class="p">,</span> <span class="mi">2</span> <span class="p">]</span>
    <span class="p">],</span>
    <span class="c1"># Give a + pulse from 5 to 7s, and a - pulse from 20 to 21.</span>
    <span class="n">stimList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;inject&#39;</span><span class="p">,</span> <span class="s1">&#39;((t&gt;5 &amp;&amp; t&lt;7) - (t&gt;20 &amp;&amp; t&lt;21)) * 1.0e-12&#39;</span> <span class="p">]],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Membrane potential&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;inject&#39;</span><span class="p">,</span> <span class="s1">&#39;current inj&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;K_A&#39;</span><span class="p">,</span> <span class="s1">&#39;Ik&#39;</span><span class="p">,</span> <span class="s1">&#39;K_A current&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/chan&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Unphosph K_A conc&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Chem Ca&#39;</span><span class="p">],</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mi">30</span> <span class="p">)</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<p>There is only one fundamentally new element in this script:</p>
<p><strong>adaptor List:</strong> <cite>[source, sourceField, dest, destField, offset, scale]</cite>
The adaptor list maps between molecular, electrical or even structural
quantities in the simulation. At present it is linear mapping, in due course
it may evolve to an arbitrary function.</p>
<p>The two adaptorLists in the above script do the following:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">'dend/chan',</span> <span class="pre">'conc',</span> <span class="pre">'K_A',</span> <span class="pre">'modulation',</span> <span class="pre">0.0,</span> <span class="pre">70</span> <span class="pre">]</span></code>:</p>
</div></blockquote>
<p>Use the concentration of the 'chan' molecule in the 'dend' compartment,
to modulate the conductance of the 'K_A' channel such that the basal
conductance is zero and 1 millimolar of 'chan' results in a conductance that is
70 times greater than the baseline conductance of the channel, <em>Gbar</em>.</p>
<p>It is advisable to use the field <em>'modulation'</em> on channels undergoing scaling,
rather than to directly assign the conductance <em>'Gbar'</em>. This is because
<em>Gbar</em> is an absolute conductance, and therefore it is scaled to the area of
the electrical segment. This makes it difficult to keep track of. <em>Modulation</em>
is a simple multiplier term onto <em>Gbar</em>, and is therefore easier to work with.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">'Ca_conc',</span> <span class="pre">'Ca',</span> <span class="pre">'dend/Ca',</span> <span class="pre">'conc',</span> <span class="pre">0.00008,</span> <span class="pre">2</span> <span class="pre">]</span></code>:</p>
</div></blockquote>
<p>Use the concentration of <em>Ca</em> as computed in the electrical model, to assign
the concentration of molecule <em>Ca</em> on the dendrite compartment. There is a
basal level of 80 nanomolar, and every unit of electrical <em>Ca</em> maps to 2
millimolar of chemical <em>Ca</em>.</p>
<p>The arguments in the adaptorList are:</p>
<blockquote>
<div><ul>
<li><p><strong>Source and Dest</strong>: Strings. These can be either a molecular or an
electrical object. To identify a molecular object, it should be
prefixed with the name of the chemical compartment, which is one
of <em>dend, spine, psd</em>. Thus <em>dend/chan</em> specifies a molecule
named <em>'chan'</em> sitting in the <em>'dend'</em> compartment.</p>
<p>To identify an electrical object, just pass in its path,
such as '.' or <em>'Ca_conc'</em>.</p>
<p>Note that the adaptors do <strong>not</strong> need to know anything about the
location.  It is assumed that the adaptors do their job wherever
the specified source and dest coexist. There is a subtlety here
due to the different length and time scales. The rule of thumb
is that the adaptor averages whichever one is subdivided more finely.</p>
<blockquote>
<div><ul class="simple">
<li><p>Example 1: Molecules are typically spatially partitioned into
short voxels (micron-scale) compared to typical 100-micron
electrical
segments. So an adaptor going from molecules to, say, channel
conductance, would average all the molecular voxels that fit
in the electrical segment.</p></li>
<li><p>Example 2: Electrical activity is typically much faster than
chemical.
So an adaptor going from an electrical entity (Ca computed from
channel opening) to molecules (Chemical Ca concentration) would
average all the time-steps between updates to the molecule.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Fields</strong>: Strings. These are simply the field names on the
objects coupled by the adaptors.</p></li>
<li><p><strong>offset and scale</strong>: Doubles. At present the adaptor is just a
straight-line conversion, obeying <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">mx</span> <span class="pre">+</span> <span class="pre">c</span></code>. The computed
output is <em>y</em>, averaged input is <em>x</em>, offset is <em>c</em> and scale is <em>m</em>.</p></li>
</ul>
</div></blockquote>
<p>There is a handy new line to specify cellular passive properties:</p>
<p><strong>passiveDistrib:</strong> <cite>[path, field, value, field, value, ... ]</cite>,</p>
<blockquote>
<div><ul class="simple">
<li><p>path: String. Specifies the object whose parameters are to be changed.</p></li>
<li><p>field: String. Name of the field on the object.</p></li>
<li><p>value: String, that is the value has to be enclosed in quotes. The
value to be assigned to the object.</p></li>
</ul>
</div></blockquote>
<p>With these in place, the model behavior is rather neat. It starts out silent,
then we apply 2 seconds of +ve current injection.</p>
<figure class="align-default" id="id27">
<img alt="Current injection stimuli for multiscale model." src="../../../_images/ex8.0_multiscale_currInj.png" />
<figcaption>
<p><span class="caption-text">Current injection stimuli for multiscale model.</span><a class="headerlink" href="#id27" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The cell fires briskly, and keeps firing even when the current injection
drops to zero.</p>
<figure class="align-default" id="id28">
<img alt="Firing responses of cell with multiscale signaling." src="../../../_images/ex8.0_multiscale_cell_spiking.png" />
<figcaption>
<p><span class="caption-text">Firing responses of cell with multiscale signaling.</span><a class="headerlink" href="#id28" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The firing of the neuron leads to Ca influx.</p>
<figure class="align-default" id="id29">
<img alt="Calcium buildup in cell due to firing." src="../../../_images/ex8.0_multiscale_Ca.png" />
<figcaption>
<p><span class="caption-text">Calcium buildup in cell due to firing.</span><a class="headerlink" href="#id29" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The chemical reactions downstream of Ca lead to phosphorylation of the K_A
channel. Only the unphosphorylated K_A channel is active, so the net effect
is to reduce K_A conductance while the Ca influx persists.</p>
<figure class="align-default" id="id30">
<img alt="Removal of KA channel due to phosphorylation." src="../../../_images/ex8.0_multiscale_KA_conc.png" />
<figcaption>
<p><span class="caption-text">Removal of KA channel due to phosphorylation.</span><a class="headerlink" href="#id30" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Since the phosphorylated form has low conductance, the cell becomes more
excitable and keeps firing even when the current injection is stopped. It takes
a later, -ve current injection to turn the firing off again.</p>
<p>Suggestions for things to do with the model:</p>
<blockquote>
<div><ul class="simple">
<li><p>Vary the adaptor settings, which couple electrical to chemical
signaling and vice versa.</p></li>
<li><p>Play with the channel densities</p></li>
<li><p>Open the chem model in moosegui and vary its parameters too.</p></li>
</ul>
</div></blockquote>
</section>
<section id="multiscale-model-of-cicr-in-dendrite-triggered-by-synaptic-input">
<h3><a class="toc-backref" href="#id72">Multiscale model of CICR in dendrite triggered by synaptic input</a><a class="headerlink" href="#multiscale-model-of-cicr-in-dendrite-triggered-by-synaptic-input" title="Permalink to this heading">¶</a></h3>
<p><em>ex8.1_synTrigCICR.py</em></p>
<p>In this model synaptic input arrives at a dendritic spine, leading to calcium
influx through the NMDA receptor. An adaptor converts this influx to the
concentration of a chemical species, and this then diffuses into the dendrite
and sets off the CICR.</p>
<p>This example models Calcium events in three compartments: dendrite, ER
inside dendrite, and spine. The signaling is a slight change from the
toy model used
in <em>ex7.2_CICR.py</em>. Note how the range of CICR wave propagation
is limited by a domain of the dendrite in which the level of IP3 is elevated.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">turnOffElec</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">chemDt</span> <span class="o">=</span> <span class="mf">0.002</span><span class="p">,</span>
    <span class="n">chemPlotDt</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">,</span>
    <span class="n">diffusionLength</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
    <span class="n">numWaveFrames</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">useGssa</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">addSomaChemCompt</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">addEndoChemCompt</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="c1"># cellProto syntax: [&#39;ballAndStick&#39;, &#39;name&#39;, somaDia, somaLength, dendDia, dendLength, numDendSeg]</span>
    <span class="n">cellProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;ballAndStick&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="mf">10e-6</span><span class="p">,</span> <span class="mf">10e-6</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">,</span> <span class="mf">40e-6</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span>
    <span class="n">spineProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;makeActiveSpine()&#39;</span><span class="p">,</span> <span class="s1">&#39;spine&#39;</span><span class="p">]],</span>
    <span class="n">chemProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;./chem/CICRspineDend.g&#39;</span><span class="p">,</span> <span class="s1">&#39;chem&#39;</span><span class="p">]],</span>
    <span class="n">spineDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;spine&#39;</span><span class="p">,</span> <span class="s1">&#39;#dend#&#39;</span><span class="p">,</span> <span class="s1">&#39;10e-6&#39;</span><span class="p">,</span> <span class="s1">&#39;0.1e-6&#39;</span><span class="p">]],</span>
    <span class="n">chemDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;chem&#39;</span><span class="p">,</span> <span class="s1">&#39;dend#,spine#,head#&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span> <span class="p">]],</span>
    <span class="n">adaptorList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span> <span class="s1">&#39;Ca_conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;spine/Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="mf">0.00008</span><span class="p">,</span> <span class="mi">8</span> <span class="p">]</span>
    <span class="p">],</span>
    <span class="n">stimList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;head0&#39;</span><span class="p">,</span> <span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="s1">&#39;glu&#39;</span><span class="p">,</span> <span class="s1">&#39;periodicsyn&#39;</span><span class="p">,</span> <span class="s1">&#39;1 + 40*(t&gt;5 &amp;&amp; t&lt;6)&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;head0&#39;</span><span class="p">,</span> <span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="s1">&#39;NMDA&#39;</span><span class="p">,</span> <span class="s1">&#39;periodicsyn&#39;</span><span class="p">,</span> <span class="s1">&#39;1 + 40*(t&gt;5 &amp;&amp; t&lt;6)&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;dend#&#39;</span><span class="p">,</span>  <span class="s1">&#39;g&gt;10e-6 &amp;&amp; g&lt;=31e-6&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/IP3&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;0.0006&#39;</span> <span class="p">],</span>
        <span class="p">],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;head#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;spine/Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Spine Ca conc&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;dend#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Dend Ca conc&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;dend#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Dend Ca conc&#39;</span><span class="p">,</span> <span class="s1">&#39;wave&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;dend#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend_endo/CaER&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;ER Ca conc&#39;</span><span class="p">,</span> <span class="s1">&#39;wave&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Memb potl&#39;</span><span class="p">],</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">moose</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span> <span class="mi">1234</span> <span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mi">16</span> <span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<p>The demo illustrates how to specify the range of elevated IP3 in the <em>stimList</em>
using the second argument, which selects a geometric range of electrical
compartments.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;dend#&#39;</span><span class="p">,</span>  <span class="s1">&#39;g&gt;10e-6 &amp;&amp; g&lt;=31e-6&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/IP3&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;0.0006&#39;</span> <span class="p">]</span>
</pre></div>
</div>
<p>This means to look at all dendrite compartments (first argument), and select
those which are between a geometrical distance <em>g</em> of 10 to 31 microns
from the soma (second argument). The system then
sets the IP3 concentration (third and fourth arguments) to 0.6 uM
(last argument) for all the chemical voxels embedded in these dendrite
compartments.</p>
<p>A note on defining the endo compartments: In cases like this, where the
compartment identity isn't built into the chemical model definition, we need
a heuristic to decide which compartment is which. The heuristic used in
rdesigneur goes like this:</p>
<blockquote>
<div><ul class="simple">
<li><p>Sort chemical compartments in decreasing order by volume</p></li>
<li><p>If the addSomaChemCompt flag is <strong>true</strong>, they are assigned to
<em>soma, dendrite, spine-head, spine-psd</em>, depending on how many
compartments are specified. If the flag is <strong>false</strong>, the soma is
omitted.</p></li>
<li><p>If the addEndoChemCompt is <strong>true</strong>, then alternate compartments are
assigned to the endo_compartment. Here it is
<em>dend, dend_endo, spine-head</em>.
If we had six compartments defined (no soma) it would have been:
<em>dend, dend_endo, spine-head, spine-endo, psd, psd-endo</em>.
The psd-endo doesn't make a lot of biological sense, though.</p></li>
</ul>
</div></blockquote>
<p>When we run this model, we trigger a propagating Ca wave from about voxel
number 16 of 40. It spreads in both directions, and comes to a halt at voxels
10 and 30, which mark the limits of the IP3 elevation zone.</p>
<figure class="align-default" id="id31">
<img alt="Calcium wave propagation along the dendrite" src="../../../_images/ex8.1_dend_Ca.png" />
<figcaption>
<p><span class="caption-text">Calcium wave propagation along the dendrite</span><a class="headerlink" href="#id31" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Note two subtle effects on the ER Ca concentration: first, there is a
periodic small influx of calcium at voxel 16 due to synaptic input. Second,
there is a slow restoration of the ER Ca level toward baseline due to
diffusion in the dendrite and the action of pumps to within the ER, and
out of the cell. Note also that the gradient within the ER is actually quite
small, being about a 12% deviation from the resting calcium.</p>
<figure class="align-default" id="id32">
<img alt="Calcium depletion and buildup in the ER due to CICR wave." src="../../../_images/ex8.1_ER_Ca.png" />
<figcaption>
<p><span class="caption-text">Calcium depletion and buildup in the ER due to CICR wave.</span><a class="headerlink" href="#id32" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="multiscale-model-spanning-psd-spine-head-and-dendrite">
<h3><a class="toc-backref" href="#id73">Multiscale model spanning PSD, spine head and dendrite</a><a class="headerlink" href="#multiscale-model-spanning-psd-spine-head-and-dendrite" title="Permalink to this heading">¶</a></h3>
<p><em>ex8.2_multiscale_glurR_phosph_3compt.py</em></p>
<p>This is another multiscale model on similar lines to 8.0. It is structurally
and computationally more complicated, because the action is distributed between
spines and dendrites, but formally it does the same thing: it turns on and
stays on after a strong stimulus, due to phosphorylation of a (receptor)
channel leading to greater excitability.</p>
<p><cite>calcium influx -&gt; chemical activity -&gt; channel modulation -&gt; electrical activity -&gt; calcium influx.</cite></p>
<p>The model is bistable as long as synaptic input keeps coming along at a basal
rate, in this case 1 Hz.</p>
<p>Here we have two new lines, to do with addition of spines. These are discussed
in detail in a later example. For now it is enough to know that the
<strong>spineProto</strong> line defines one of the prototype spines to be used to put into
the model, and the <strong>spineDistrib</strong> line tells the system where to put them,
and how widely to space them.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">elecDt</span> <span class="o">=</span> <span class="mf">50e-6</span><span class="p">,</span>
    <span class="n">chemDt</span> <span class="o">=</span> <span class="mf">0.002</span><span class="p">,</span>
    <span class="n">diffDt</span> <span class="o">=</span> <span class="mf">0.002</span><span class="p">,</span>
    <span class="n">chemPlotDt</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">,</span>
    <span class="n">useGssa</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="c1"># cellProto syntax: [&#39;ballAndStick&#39;, &#39;name&#39;, somaDia, somaLength, dendDia, d</span>
<span class="n">endLength</span><span class="p">,</span> <span class="n">numDendSegments</span> <span class="p">]</span>
    <span class="n">cellProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;ballAndStick&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="mf">12e-6</span><span class="p">,</span> <span class="mf">12e-6</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">,</span> <span class="mf">100e-6</span><span class="p">,</span> <span class="mi">2</span> <span class="p">]],</span>
    <span class="n">chemProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;./chem/chanPhosph3compt.g&#39;</span><span class="p">,</span> <span class="s1">&#39;chem&#39;</span><span class="p">]],</span>
    <span class="n">spineProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;makeActiveSpine()&#39;</span><span class="p">,</span> <span class="s1">&#39;spine&#39;</span><span class="p">]],</span>
    <span class="n">chanProto</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;make_Na()&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;make_K_DR()&#39;</span><span class="p">,</span> <span class="s1">&#39;K_DR&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;make_K_A()&#39;</span><span class="p">,</span> <span class="s1">&#39;K_A&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;make_Ca()&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;make_Ca_conc()&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca_conc&#39;</span> <span class="p">]</span>
    <span class="p">],</span>
    <span class="n">passiveDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;CM&#39;</span><span class="p">,</span> <span class="s1">&#39;0.01&#39;</span><span class="p">,</span> <span class="s1">&#39;Em&#39;</span><span class="p">,</span> <span class="s1">&#39;-0.06&#39;</span><span class="p">]],</span>
    <span class="n">spineDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;spine&#39;</span><span class="p">,</span> <span class="s1">&#39;#dend#&#39;</span><span class="p">,</span> <span class="s1">&#39;50e-6&#39;</span><span class="p">,</span> <span class="s1">&#39;1e-6&#39;</span><span class="p">]],</span>
    <span class="n">chemDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;chem&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span> <span class="p">]],</span>
    <span class="n">chanDistrib</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;300&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;K_DR&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;250&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;K_A&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;200&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;Ca_conc&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;tau&#39;</span><span class="p">,</span> <span class="s1">&#39;0.0333&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;40&#39;</span> <span class="p">]</span>
    <span class="p">],</span>
    <span class="n">adaptorList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span> <span class="s1">&#39;psd/chan_p&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;glu&#39;</span><span class="p">,</span> <span class="s1">&#39;modulation&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">],</span>
        <span class="p">[</span> <span class="s1">&#39;Ca_conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;spine/Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="mf">0.00008</span><span class="p">,</span> <span class="mi">8</span> <span class="p">]</span>
    <span class="p">],</span>
    <span class="c1"># Syn input basline 1 Hz, and 40Hz burst for 1 sec at t=20. Syn weight</span>
    <span class="c1"># is 0.5, specified in 2nd argument as a special case stimLists.</span>
    <span class="n">stimList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;head#&#39;</span><span class="p">,</span> <span class="s1">&#39;0.5&#39;</span><span class="p">,</span><span class="s1">&#39;glu&#39;</span><span class="p">,</span> <span class="s1">&#39;periodicsyn&#39;</span><span class="p">,</span> <span class="s1">&#39;1 + 40*(t&gt;10 &amp;&amp; t&lt;11)&#39;</span><span class="p">]],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Membrane potential&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;spine/Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca in Spine&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/DEND/Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca in Dend&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;spine/Ca_CaM&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca_CaM&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;head#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;psd/chan_p&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Phosph gluR&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;head#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;psd/Ca_CaM_CaMKII&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Active CaMKII&#39;</span><span class="p">],</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">moose</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mi">25</span> <span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<p>This is how it works:</p>
<p>This is a ball-and-stick model with a couple of spines sitting on the dendrite.
The spines get synaptic input onto NMDARs and gluRs. There is a baseline
input rate of 1 Hz thoughout, and there is a burst at 40 Hz for 1 second at
t = 10s.</p>
<figure class="align-default" id="id33">
<img alt="Membrane potential responses of cell with synaptic input and multiscale signaling" src="../../../_images/ex8.2_Vm.png" />
<figcaption>
<p><span class="caption-text">Membrane potential responses of cell with synaptic input and multiscale signaling</span><a class="headerlink" href="#id33" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>At baseline, we just have small EPSPs and little Ca influx. A burst of
strong synaptic input causes Ca entry into the spine via NMDAR.</p>
<figure class="align-default" id="id34">
<img alt="Calcium influx into spine." src="../../../_images/ex8.2_Ca_spine.png" />
<figcaption>
<p><span class="caption-text">Calcium influx into spine.</span><a class="headerlink" href="#id34" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Ca diffuses from the spine into the dendrite and spreads. In the graph below
we see how Calcium goes into the 50-odd voxels of the dendrite.</p>
<figure class="align-default" id="id35">
<img alt="Calcium influx and diffusion in dendrite." src="../../../_images/ex8.2_Ca_dend.png" />
<figcaption>
<p><span class="caption-text">Calcium influx and diffusion in dendrite.</span><a class="headerlink" href="#id35" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The Ca influx into the spine
triggers activation of CaMKII and its translocation to the PSD, where
it phosphorylates and increases the conductance of gluR. We have two spines
with slightly different geometry, so the CaMKII activity differs slightly.</p>
<figure class="align-default" id="id36">
<img alt="Activation of CaMKII and translocation to PSD" src="../../../_images/ex8.2_active_CaMKII.png" />
<figcaption>
<p><span class="caption-text">Activation of CaMKII and translocation to PSD</span><a class="headerlink" href="#id36" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Now that gluR has a greater weight, the baseline synaptic input keeps
Ca trickling in enough to keep the CaMKII active.</p>
<p>Here are the reactions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Ca</span><span class="o">+</span><span class="n">CaM</span> <span class="o">&lt;===&gt;</span> <span class="n">Ca_CaM</span><span class="p">;</span>    <span class="n">Ca_CaM</span> <span class="o">+</span> <span class="n">CaMKII</span> <span class="o">&lt;===&gt;</span> <span class="n">Ca_CaM_CaMKII</span> <span class="p">(</span><span class="nb">all</span> <span class="ow">in</span>
<span class="n">spine</span> <span class="n">head</span><span class="p">,</span> <span class="k">except</span> <span class="n">that</span> <span class="n">the</span> <span class="n">Ca_CaM_CaMKII</span> <span class="n">translocates</span> <span class="n">to</span> <span class="n">the</span> <span class="n">PSD</span><span class="p">)</span>

<span class="n">chan</span> <span class="o">------</span><span class="n">Ca_CaM_CaMKII</span><span class="o">-----&gt;</span> <span class="n">chan_p</span><span class="p">;</span> <span class="n">chan_p</span> <span class="o">------&gt;</span> <span class="n">chan</span>  <span class="p">(</span><span class="nb">all</span> <span class="ow">in</span> <span class="n">PSD</span><span class="p">)</span>
</pre></div>
</div>
<p>Suggestions:</p>
<blockquote>
<div><ul class="simple">
<li><p>Add GABAR using make_GABA(), put it on soma or dendrite. Stimulate it
after 20 s to see if you can turn off the sustained activation</p></li>
<li><p>Replace the 'periodicsyn' in stimList with 'randsyn'. This gives
Poisson activity at the specified mean frequency. Does the switch
remain reliable?</p></li>
<li><p>What are the limits of various parameters for this switching? You
could try basal synaptic rate, burst rate, the various scaling factors
for the adaptors, the densities of various channels, synaptic weight,
and so on.</p></li>
<li><p>In real life an individual synaptic EPSP is tiny, under a millivolt.
How many synapses would you need to achieve this kind of switching?
You can play with # of synapses by altering the spacing between
spines as the third argument of spineDistrib.</p></li>
</ul>
</div></blockquote>
</section>
<section id="multiscale-model-in-which-spine-geometry-changes-due-to-signaling">
<h3><a class="toc-backref" href="#id74">Multiscale model in which spine geometry changes due to signaling</a><a class="headerlink" href="#multiscale-model-in-which-spine-geometry-changes-due-to-signaling" title="Permalink to this heading">¶</a></h3>
<p><em>ex8.3_spine_vol_change.py</em></p>
<p>This model is very similar to 8.2. The main design difference is that
<em>adaptor</em>, instead of just modulating the gluR conductance, scales the
entire spine cross-section area, with all sorts of electrical and chemical
ramifications. There are a lot of plots, to illustrate some of these outcomes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">elecDt</span> <span class="o">=</span> <span class="mf">50e-6</span><span class="p">,</span>
    <span class="n">chemDt</span> <span class="o">=</span> <span class="mf">0.002</span><span class="p">,</span>
    <span class="n">diffDt</span> <span class="o">=</span> <span class="mf">0.002</span><span class="p">,</span>
    <span class="n">chemPlotDt</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">,</span>
    <span class="n">useGssa</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">stealCellFromLibrary</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="c1"># Simply move library model to use for sim</span>
    <span class="n">cellProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;ballAndStick&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="mf">12e-6</span><span class="p">,</span> <span class="mf">12e-6</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">,</span> <span class="mf">100e-6</span><span class="p">,</span> <span class="mi">2</span> <span class="p">]],</span>
    <span class="n">chemProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;./chem/chanPhosph3compt.g&#39;</span><span class="p">,</span> <span class="s1">&#39;chem&#39;</span><span class="p">]],</span>
    <span class="n">spineProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;makeActiveSpine()&#39;</span><span class="p">,</span> <span class="s1">&#39;spine&#39;</span><span class="p">]],</span>
    <span class="n">chanProto</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;make_Na()&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;make_K_DR()&#39;</span><span class="p">,</span> <span class="s1">&#39;K_DR&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;make_K_A()&#39;</span><span class="p">,</span> <span class="s1">&#39;K_A&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;make_Ca()&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;make_Ca_conc()&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca_conc&#39;</span> <span class="p">]</span>
    <span class="p">],</span>
    <span class="n">passiveDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;CM&#39;</span><span class="p">,</span> <span class="s1">&#39;0.01&#39;</span><span class="p">,</span> <span class="s1">&#39;Em&#39;</span><span class="p">,</span> <span class="s1">&#39;-0.06&#39;</span><span class="p">]],</span>
    <span class="n">spineDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;spine&#39;</span><span class="p">,</span> <span class="s1">&#39;#dend#&#39;</span><span class="p">,</span> <span class="s1">&#39;50e-6&#39;</span><span class="p">,</span> <span class="s1">&#39;1e-6&#39;</span><span class="p">]],</span>
    <span class="n">chemDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;chem&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span> <span class="p">]],</span>
    <span class="n">chanDistrib</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;300&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;K_DR&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;250&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;K_A&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;200&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;Ca_conc&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;tau&#39;</span><span class="p">,</span> <span class="s1">&#39;0.0333&#39;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;40&#39;</span> <span class="p">]</span>
    <span class="p">],</span>
    <span class="n">adaptorList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># This scales the psdArea of the spine by # of chan_p. Note that</span>
        <span class="c1"># the cross-section area of the spine head is identical to psdArea.</span>
        <span class="p">[</span> <span class="s1">&#39;psd/chan_p&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;spine&#39;</span><span class="p">,</span> <span class="s1">&#39;psdArea&#39;</span><span class="p">,</span> <span class="mf">0.1e-12</span><span class="p">,</span> <span class="mf">0.01e-12</span> <span class="p">],</span>
        <span class="p">[</span> <span class="s1">&#39;Ca_conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;spine/Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="mf">0.00008</span><span class="p">,</span> <span class="mi">8</span> <span class="p">]</span>
    <span class="p">],</span>
    <span class="c1"># Syn input basline 1 Hz, and 40Hz burst for 1 sec at t=20. Syn wt=10</span>
    <span class="n">stimList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;head#&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span><span class="s1">&#39;glu&#39;</span><span class="p">,</span> <span class="s1">&#39;periodicsyn&#39;</span><span class="p">,</span> <span class="s1">&#39;1 + 40*(t&gt;10 &amp;&amp; t&lt;11)&#39;</span><span class="p">]],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Membrane potential&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;spine/Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca in Spine&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/DEND/Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca in Dend&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;head#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;psd/chan_p&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;Amount of Phospho-chan&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;head#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;spine/CaMKII&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Conc of CaMKII in spine&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;head#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Cm&#39;</span><span class="p">,</span> <span class="s1">&#39;Capacitance of spine head&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;head#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Rm&#39;</span><span class="p">,</span> <span class="s1">&#39;Membrane res of spine head&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;head#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Ra&#39;</span><span class="p">,</span> <span class="s1">&#39;Axial res of spine head&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;head#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;glu&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;Conductance of gluR&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;head#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;NMDA&#39;</span><span class="p">,</span> <span class="s1">&#39;Gbar&#39;</span><span class="p">,</span> <span class="s1">&#39;Conductance of NMDAR&#39;</span><span class="p">],</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">moose</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mi">25</span> <span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<p>The key <em>adaptor</em> line is as follows:</p>
<p><code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">'psd/chan_p',</span> <span class="pre">'n',</span> <span class="pre">'spine',</span> <span class="pre">'psdArea',</span> <span class="pre">0.1e-12,</span> <span class="pre">0.01e-12</span> <span class="pre">]</span></code></p>
<p>Here, we use the phosphorylated <em>chan_p</em> molecule in the PSD as a proxy for
processes that control spine size. We operate on a special object called
<em>spine</em> which manages many aspects of spines in the model (see below). Here
we control the <em>psdArea</em>, which defines the cross-section area of the spine
head and by extension of the PSD too. We keep a minimum spine area of 0.1 um^2,
and a scaling factor of 0.01um^2 per phosphorylated molecule.</p>
<p>The reaction system is identical to the one in <em>ex8.2</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Ca</span><span class="o">+</span><span class="n">CaM</span> <span class="o">&lt;===&gt;</span> <span class="n">Ca_CaM</span><span class="p">;</span>    <span class="n">Ca_CaM</span> <span class="o">+</span> <span class="n">CaMKII</span> <span class="o">&lt;===&gt;</span> <span class="n">Ca_CaM_CaMKII</span> <span class="p">(</span><span class="nb">all</span> <span class="ow">in</span>
<span class="n">spine</span> <span class="n">head</span><span class="p">,</span> <span class="k">except</span> <span class="n">that</span> <span class="n">the</span> <span class="n">Ca_CaM_CaMKII</span> <span class="n">translocates</span> <span class="n">to</span> <span class="n">the</span> <span class="n">PSD</span><span class="p">)</span>

<span class="n">chan</span> <span class="o">------</span><span class="n">Ca_CaM_CaMKII</span><span class="o">-----&gt;</span> <span class="n">chan_p</span><span class="p">;</span> <span class="n">chan_p</span> <span class="o">------&gt;</span> <span class="n">chan</span>  <span class="p">(</span><span class="nb">all</span> <span class="ow">in</span> <span class="n">PSD</span><span class="p">)</span>
</pre></div>
</div>
<p>Rather than list all the 10 plots, here are a few to show what is going on.</p>
<p>First, just the spiking activity of the cell. Here the burst of activity is
followed by a few seconds of enhanced synaptic weight, followed by subthreshold
EPSPs:</p>
<figure class="align-default" id="id37">
<img alt="Membrane potential and spiking." src="../../../_images/ex8.3_Vm.png" />
<figcaption>
<p><span class="caption-text">Membrane potential and spiking.</span><a class="headerlink" href="#id37" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Then, we fast-forward to the amount of <em>chan_p</em> which is the molecule that
controls spine size scaling:</p>
<figure class="align-default" id="id38">
<img alt="Molecule that controles spine size" src="../../../_images/ex8.3_chan_p.png" />
<figcaption>
<p><span class="caption-text">Molecule that controles spine size</span><a class="headerlink" href="#id38" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>This causes some obvious outcomes. One of them is to increase the synaptic
conductance of the glutamate receptor. The system assumes that the conductance
of all channels in the PSD scales linearly with the psdArea.</p>
<figure class="align-default" id="id39">
<img alt="Conductance of glutamate receptor" src="../../../_images/ex8.3_gluR.png" />
<figcaption>
<p><span class="caption-text">Conductance of glutamate receptor</span><a class="headerlink" href="#id39" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Here is one of several non-intuitive outcomes. Because the spine volume has
increased, the concentration of molecules in the spine is diluted out. So
the concentration of active CaMKII actually falls when the spine gets bigger.
In a more detailed model, this would be a race between the increase in spine
size and the time taken for diffusion and further reactions to replenish
CaMKII. In the current model we don't have a diffusive coupling of CaMKII to
the dendrite, so this replenishment doesn't happen.</p>
<figure class="align-default" id="id40">
<img alt="Concentration of CaMKII in the spine" src="../../../_images/ex8.3_CaMKII_spine.png" />
<figcaption>
<p><span class="caption-text">Concentration of CaMKII in the spine</span><a class="headerlink" href="#id40" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>In the simulation we display several other electrical and chemical properties
that change with spine size. The diffusion properties also change since the
cross-section areas are altered. This is harder to visualize but has large
effects on coupling to the dendrite,
especially if the <em>shaftDiameter</em> is the parameter scaled by the signaling.</p>
<p>Suggestions:</p>
<blockquote>
<div><ul class="simple">
<li><p>The Spine class (instance: spine) manages several possible scaling
targets on the spine geometry: shaftLength, shaftDiameter,
headLength, headDiameter, psdArea, headVolume, totalLength. Try them
out. Think about mechanisms by which molecular concentrations might
affect each.</p></li>
<li><p>When volume changes, we assume that the molecular numbers stay
fixed, so concentration changes. Except for buffered molecules, where
we assume concentration remains fixed. Use this to design a bistable
simply relying on molecules and spine geometry terms.</p></li>
<li><p>Even more interesting, use it to design an oscillator. You could look
at Bhalla, BiophysJ 2011 for some ideas.</p></li>
</ul>
</div></blockquote>
</section>
<section id="morphology-load-swc-morphology-file-and-view-it">
<h3><a class="toc-backref" href="#id75">Morphology: Load .swc morphology file and view it</a><a class="headerlink" href="#morphology-load-swc-morphology-file-and-view-it" title="Permalink to this heading">¶</a></h3>
<p><em>ex9.0_load_neuronal_morphology_file.py</em></p>
<p>Here we build a passive model using a morphology file in the .swc file
format (as used by NeuroMorpho.org). The morphology file is predefined
for Rdesigneur and resides in the directory <code class="docutils literal notranslate"><span class="pre">./cells</span></code>. We apply a
somatic current pulse, and view the somatic membrane potential in a
plot, as before. To make things interesting we display the morphology in
3-D upon which we represent the membrane potential as colors.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;./cells/h10.CNG.swc&#39;</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">cellProto</span> <span class="o">=</span> <span class="p">[[</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;elec&#39;</span><span class="p">]],</span>
    <span class="n">stimList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;inject&#39;</span><span class="p">,</span> <span class="s1">&#39;t * 25e-9&#39;</span> <span class="p">]],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Membrane potential&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca_conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca conc (uM)&#39;</span><span class="p">]],</span>
    <span class="n">moogList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Soma potential&#39;</span><span class="p">]]</span>
<span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">displayMoogli</span><span class="p">(</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mf">0.02</span> <span class="p">)</span>
</pre></div>
</div>
<p>Here the new concept is the cellProto line, which loads in the specified
cell model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`[ filename, cellname ]`
</pre></div>
</div>
<p>The system recognizes the filename extension and builds a model from the
swc file. It uses the cellname <strong>elec</strong> in this example.</p>
<p>We use a similar line as in the reaction-diffusion example, to build up
a Moogli display of the cell model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`moogList = [[&#39;#&#39;, &#39;1&#39;, &#39;.&#39;, &#39;Vm&#39;, &#39;Soma potential&#39;]]`
</pre></div>
</div>
<p>Here we have:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># : the path to use for selecting the compartments to display.
This wildcard means use all compartments.
1 : The expression to use for the compartments. Again, `1` means use
all of them.
. : Which object in the compartment to display. Here we are using the
compartment itself, so it is just a dot.
Vm : Field to display
Soma potential : Title for display.
</pre></div>
</div>
<figure class="align-default" id="id41">
<img alt="3-D display for passive neuron" src="../../../_images/ex9.0_passive_cell_morpho.png" />
<figcaption>
<p><span class="caption-text">3-D display for passive neuron</span><a class="headerlink" href="#id41" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Suggestions:</p>
<blockquote>
<div><ul>
<li><p>The tutorial directory already has a number of pre-loaded files from
NeuroMorpho. Pass them in to ex9.0 on the command line:</p>
<p><cite>python ex9.0_load_neuronal_morphology_file.py &lt;morpho.swc&gt;</cite></p>
</li>
<li><p>Grab other morphology files from NeuroMorpho.org,  try them out.</p></li>
</ul>
</div></blockquote>
</section>
<section id="build-an-active-neuron-model-by-putting-channels-into-a-morphology-file">
<h3><a class="toc-backref" href="#id76">Build an active neuron model by putting channels into a morphology file</a><a class="headerlink" href="#build-an-active-neuron-model-by-putting-channels-into-a-morphology-file" title="Permalink to this heading">¶</a></h3>
<p><em>ex9.1_chans_in_neuronal_morph.py</em></p>
<p>Here we load in a morphology file and distribute voltage-gated ion channels
over the neuron. The voltage-gated channels are obtained from a
number of channelML files, located in the <code class="docutils literal notranslate"><span class="pre">./channels</span></code> subdirectory.
Since we have a spatially extended neuron, we need to specify the
spatial distribution of channel densities too.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">chanProto</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;./chans/hd.xml&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;./chans/kap.xml&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;./chans/kad.xml&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;./chans/kdr.xml&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;./chans/na3.xml&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;./chans/nax.xml&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;./chans/CaConc.xml&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;./chans/Ca.xml&#39;</span><span class="p">]</span>
    <span class="p">],</span>
    <span class="n">cellProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;./cells/h10.CNG.swc&#39;</span><span class="p">,</span> <span class="s1">&#39;elec&#39;</span><span class="p">]],</span>
    <span class="n">chanDistrib</span> <span class="o">=</span> <span class="p">[</span> \
        <span class="p">[</span><span class="s2">&quot;hd&quot;</span><span class="p">,</span> <span class="s2">&quot;#dend#,#apical#&quot;</span><span class="p">,</span> <span class="s2">&quot;Gbar&quot;</span><span class="p">,</span> <span class="s2">&quot;50e-2*(1+(p*3e4))&quot;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;kdr&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;Gbar&quot;</span><span class="p">,</span> <span class="s2">&quot;p &lt; 50e-6 ? 500 : 100&quot;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;na3&quot;</span><span class="p">,</span> <span class="s2">&quot;#soma#,#dend#,#apical#&quot;</span><span class="p">,</span> <span class="s2">&quot;Gbar&quot;</span><span class="p">,</span> <span class="s2">&quot;850&quot;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;nax&quot;</span><span class="p">,</span> <span class="s2">&quot;#soma#,#axon#&quot;</span><span class="p">,</span> <span class="s2">&quot;Gbar&quot;</span><span class="p">,</span> <span class="s2">&quot;1250&quot;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;kap&quot;</span><span class="p">,</span> <span class="s2">&quot;#axon#,#soma#&quot;</span><span class="p">,</span> <span class="s2">&quot;Gbar&quot;</span><span class="p">,</span> <span class="s2">&quot;300&quot;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;kap&quot;</span><span class="p">,</span> <span class="s2">&quot;#dend#,#apical#&quot;</span><span class="p">,</span> <span class="s2">&quot;Gbar&quot;</span><span class="p">,</span>
            <span class="s2">&quot;300*(H(100-p*1e6)) * (1+(p*1e4))&quot;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;Ca_conc&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;tau&quot;</span><span class="p">,</span> <span class="s2">&quot;0.0133&quot;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;kad&quot;</span><span class="p">,</span> <span class="s2">&quot;#soma#,#dend#,#apical#&quot;</span><span class="p">,</span> <span class="s2">&quot;Gbar&quot;</span><span class="p">,</span> <span class="s2">&quot;50&quot;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;Ca&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;Gbar&quot;</span><span class="p">,</span> <span class="s2">&quot;50&quot;</span> <span class="p">]</span>
    <span class="p">],</span>
    <span class="n">stimList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;inject&#39;</span><span class="p">,</span> <span class="s1">&#39;(t&gt;0.02) * 1e-9&#39;</span> <span class="p">]],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Membrane potential&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca_conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca conc (uM)&#39;</span><span class="p">]],</span>
    <span class="n">moogList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca_conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;Calcium conc (uM)&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Soma potential&#39;</span><span class="p">]]</span>
<span class="p">)</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>

<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">displayMoogli</span><span class="p">(</span> <span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.052</span> <span class="p">)</span>
</pre></div>
</div>
<p>Here we make more extensive use of two concepts which we've already seen
from the single compartment squid model:</p>
<ol class="arabic">
<li><p><em>chanProto</em>: This defines numerous channels, each of which is of the
form:</p>
<p><code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">filename</span> <span class="pre">]</span></code></p>
<p>or</p>
<p><code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">filename,</span> <span class="pre">channelname</span> <span class="pre">]</span></code></p>
<p>or</p>
<p><code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">channelFunction(),</span> <span class="pre">channelname</span> <span class="pre">]</span></code></p>
</li>
</ol>
<p>If the <em>channelname</em> is not specified the system uses the last part of
the channel name, before the filetype suffix.</p>
<ol class="arabic" start="2">
<li><p><em>chanDistrib</em>: This defines the spatial distribution of each channel
type. Each line is of a form that should be familiar now:</p>
<p><code class="docutils literal notranslate"><span class="pre">[channelname,</span> <span class="pre">region_in_cell,</span> <span class="pre">parameter,</span> <span class="pre">expression_string]</span></code></p>
</li>
</ol>
<ul>
<li><p>The <em>channelname</em> is the name of the prototype from <em>chanproto</em>. This
is usually an ion channel, but in the example above you can also see
a calcium concentration pool defined.</p></li>
<li><p>The <em>region_in_cell</em> is typically defined using wildcards, so that
it generalizes to any cell morphology. For example, the plain
wildcard <code class="docutils literal notranslate"><span class="pre">#</span></code> means to consider all cell compartments. The wildcard
<code class="docutils literal notranslate"><span class="pre">#dend#</span></code> means to consider all compartments with the string
<code class="docutils literal notranslate"><span class="pre">dend</span></code> somewhere in the name. Wildcards can be comma-separated, so
<code class="docutils literal notranslate"><span class="pre">#soma#,#dend#</span></code> means consider all compartments with either soma or
dend in their name. The naming in MOOSE is defined by the model file.
Importantly, in <strong>.swc</strong> files MOOSE generates names that respect the
classification of compartments into axon, soma, dendrite, and apical
dendrite compartments respectively. SWC files generate compartment
names such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">soma_</span><span class="o">&lt;</span><span class="n">number</span><span class="o">&gt;</span>
<span class="n">dend_</span><span class="o">&lt;</span><span class="n">number</span><span class="o">&gt;</span>
<span class="n">apical_</span><span class="o">&lt;</span><span class="n">number</span><span class="o">&gt;</span>
<span class="n">axon_</span><span class="o">&lt;</span><span class="n">number</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ul>
<p>where the number is automatically assigned by the reader. In order to
select all dendritic compartments, for example, one would use <em>&quot;#dend#&quot;</em>
where the <em>&quot;#&quot;</em> acts as a wildcard to accept any string. - The
<em>parameter</em> is usually Gbar, the channel conductance density in <em>S/m^2</em>.
If <em>Gbar</em> is zero or less, then the system economizes by not
incorporating this channel mechanism in this part of the cell.
Similarly, for calcium pools, if the <em>tau</em> is below zero then the
calcium pool object is simply not inserted into this part of the cell. -
The <em>expression_string</em> defines the value of the parameter, such as
Gbar. This is typically a function of position in the cell. The
expression evaluator knows about several parameters of cell geometry.
All units are in metres:</p>
<ul class="simple">
<li><p><em>x</em>, <em>y</em> and <em>z</em> coordinates.</p></li>
<li><p><em>g</em>, the geometrical distance from the soma</p></li>
<li><p><em>p</em>, the path length from the soma, measured along the dendrites.</p></li>
<li><p><em>dia</em>, the diameter of the dendrite.</p></li>
<li><p><em>L</em>, The electrotonic length from the soma (no units).</p></li>
</ul>
<p>Along with these geometrical arguments, we make liberal use of the
ternary expressions like <em>p &lt; 50e-6 ? 500 : 100</em> or multiplying a channel
density with a logical function or Heaviside function H(x) to set up the
channel distributions. The
expression evaluator also knows about pretty much all common algebraic,
trignometric, and logarithmic functions, should you wish to use these.</p>
<p>Also note the two Moogli displays. The first is the calcium
concentration. The second is the membrane potential in each compartment.
Easy!</p>
<figure class="align-default" id="id42">
<img alt="3-D display for active neuron" src="../../../_images/rdes8_active.png" />
<figcaption>
<p><span class="caption-text">3-D display for active neuron</span><a class="headerlink" href="#id42" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Suggestions:</p>
<blockquote>
<div><ul>
<li><p>Try another morphology file.</p></li>
<li><p>Try different channel distributions by editing the chanDistrib lines.</p></li>
<li><p>There are numerous predefined channels available within Rdesigneur.
These can be defined using the following chanProto options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;make_HH_Na()&#39;</span><span class="p">,</span> <span class="s1">&#39;HH_Na&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;make_HH_K_DR()&#39;</span><span class="p">,</span> <span class="s1">&#39;HH_K&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;make_Na()&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;make_K_DR()&#39;</span><span class="p">,</span> <span class="s1">&#39;K_DR&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;make_K_A()&#39;</span><span class="p">,</span> <span class="s1">&#39;K_A&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;make_K_AHP()&#39;</span><span class="p">,</span> <span class="s1">&#39;K_AHP&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;make_K_C()&#39;</span><span class="p">,</span> <span class="s1">&#39;K_C&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;make_Ca()&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;make_Ca_conc()&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca_conc&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;make_glu()&#39;</span><span class="p">,</span> <span class="s1">&#39;glu&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;make_GABA()&#39;</span><span class="p">,</span> <span class="s1">&#39;GABA&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Then the chanDistrib can refer to these channels instead.</p>
</li>
<li><p>Deliver stimuli on the dendrites rather than the soma.</p></li>
</ul>
</div></blockquote>
</section>
<section id="build-a-spiny-neuron-from-a-morphology-file-and-put-active-channels-in-it">
<h3><a class="toc-backref" href="#id77">Build a spiny neuron from a morphology file and put active channels in it.</a><a class="headerlink" href="#build-a-spiny-neuron-from-a-morphology-file-and-put-active-channels-in-it" title="Permalink to this heading">¶</a></h3>
<p><em>ex9.2_spines_in_neuronal_morpho.py</em></p>
<p>This model is one step elaborated from the previous one, in that we now
also have dendritic spines. MOOSE lets one decorate a bare neuronal
morphology file with dendritic spines, specifying various geometric
parameters of their location. As before, we use an swc file for the
morphology, and the same ion channels and distribution.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">chanProto</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;./chans/hd.xml&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;./chans/kap.xml&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;./chans/kad.xml&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;./chans/kdr.xml&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;./chans/na3.xml&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;./chans/nax.xml&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;./chans/CaConc.xml&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;./chans/Ca.xml&#39;</span><span class="p">]</span>
    <span class="p">],</span>
    <span class="n">cellProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;./cells/h10.CNG.swc&#39;</span><span class="p">,</span> <span class="s1">&#39;elec&#39;</span><span class="p">]],</span>
    <span class="n">spineProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;makeActiveSpine()&#39;</span><span class="p">,</span> <span class="s1">&#39;spine&#39;</span><span class="p">]],</span>
    <span class="n">chanDistrib</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s2">&quot;hd&quot;</span><span class="p">,</span> <span class="s2">&quot;#dend#,#apical#&quot;</span><span class="p">,</span> <span class="s2">&quot;Gbar&quot;</span><span class="p">,</span> <span class="s2">&quot;50e-2*(1+(p*3e4))&quot;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;kdr&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;Gbar&quot;</span><span class="p">,</span> <span class="s2">&quot;p &lt; 50e-6 ? 500 : 100&quot;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;na3&quot;</span><span class="p">,</span> <span class="s2">&quot;#soma#,#dend#,#apical#&quot;</span><span class="p">,</span> <span class="s2">&quot;Gbar&quot;</span><span class="p">,</span> <span class="s2">&quot;850&quot;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;nax&quot;</span><span class="p">,</span> <span class="s2">&quot;#soma#,#axon#&quot;</span><span class="p">,</span> <span class="s2">&quot;Gbar&quot;</span><span class="p">,</span> <span class="s2">&quot;1250&quot;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;kap&quot;</span><span class="p">,</span> <span class="s2">&quot;#axon#,#soma#&quot;</span><span class="p">,</span> <span class="s2">&quot;Gbar&quot;</span><span class="p">,</span> <span class="s2">&quot;300&quot;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;kap&quot;</span><span class="p">,</span> <span class="s2">&quot;#dend#,#apical#&quot;</span><span class="p">,</span> <span class="s2">&quot;Gbar&quot;</span><span class="p">,</span>
            <span class="s2">&quot;300*(H(100-p*1e6)) * (1+(p*1e4))&quot;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;Ca_conc&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;tau&quot;</span><span class="p">,</span> <span class="s2">&quot;0.0133&quot;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;kad&quot;</span><span class="p">,</span> <span class="s2">&quot;#soma#,#dend#,#apical#&quot;</span><span class="p">,</span> <span class="s2">&quot;Gbar&quot;</span><span class="p">,</span> <span class="s2">&quot;50&quot;</span> <span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;Ca&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;Gbar&quot;</span><span class="p">,</span> <span class="s2">&quot;50&quot;</span> <span class="p">]</span>
    <span class="p">],</span>
    <span class="n">spineDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;spine&#39;</span><span class="p">,</span> <span class="s1">&#39;#dend#,#apical#&#39;</span><span class="p">,</span> <span class="s1">&#39;20e-6&#39;</span><span class="p">,</span> <span class="s1">&#39;1e-6&#39;</span><span class="p">]],</span>
    <span class="n">stimList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;inject&#39;</span><span class="p">,</span> <span class="s1">&#39;(t&gt;0.02) * 1e-9&#39;</span> <span class="p">]],</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Membrane potential&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca_conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca conc (uM)&#39;</span><span class="p">]],</span>
    <span class="n">moogList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca_conc&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;Calcium conc (uM)&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Soma potential&#39;</span><span class="p">]]</span>
<span class="p">)</span>

<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>

<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">displayMoogli</span><span class="p">(</span> <span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.023</span> <span class="p">)</span>
</pre></div>
</div>
<p>Spines are set up in a familiar way: we first define one (or more)
prototype spines, and then distribute these around the cell. Here is the
prototype string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">spine_proto</span><span class="p">,</span> <span class="n">spinename</span><span class="p">]</span>
</pre></div>
</div>
<p><em>spineProto</em>: This is typically a function. One can define one's own,
but there are several predefined ones in rdesigneur. All these define a
spine with the following parameters:</p>
<ul class="simple">
<li><p>head diameter 0.5 microns</p></li>
<li><p>head length 0.5 microns</p></li>
<li><p>shaft length 1 micron</p></li>
<li><p>shaft diameter of 0.2 microns</p></li>
<li><p>RM = 1.0 ohm-metre square</p></li>
<li><p>RA = 1.0 ohm-meter</p></li>
<li><p>CM = 0.01 Farads per square metre.</p></li>
</ul>
<p>Here are the predefined spine prototypes:</p>
<ul class="simple">
<li><p><em>makePassiveSpine()</em>: This just makes a passive spine with the
default parameters</p></li>
<li><p><em>makeExcSpine()</em>: This makes a spine with NMDA and glu receptors, and
also a calcium pool. The NMDA channel feeds the Ca pool.</p></li>
<li><p><em>makeActiveSpine()</em>: This adds a Ca channel to the exc_spine. and
also a calcium pool.</p></li>
</ul>
<p>The spine distributions are specified in a familiar way for the first
few arguments, and then there are multiple (optional) spine-specific
parameters:</p>
<p><em>[spinename, region_in_cell, spacing, spacing_distrib, size,
size_distrib, angle, angle_distrib ]</em></p>
<p>Only the first two arguments are mandatory.</p>
<ul class="simple">
<li><p><em>spinename</em>: The prototype name</p></li>
<li><p><em>region_in_cell</em>: Usual wildcard specification of names of
compartments in which to put the spines.</p></li>
<li><p><em>spacing</em>: Math expression to define spacing between spines. In the
current implementation this evaluates to
<code class="docutils literal notranslate"><span class="pre">1/probability_of_spine_per_unit_length</span></code>. Defaults to 10 microns.
Thus, there is a 10% probability of a spine insertion in every
micron. This evaluation method has the drawback that it is possible
to space spines rather too close to each other. If spacing is zero or
less, no spines are inserted.</p></li>
<li><p><em>spacing_distrib</em>: Math expression for distribution of spacing. In
the current implementation, this specifies the interval at which the
system samples from the spacing probability above. Defaults to 1
micron.</p></li>
<li><p><em>size</em>: Linear scale factor for size of spine. All dimensions are
scaled by this factor. The default spine head here is 0.5 microns in
diameter and length. If the scale factor were to be 2, the volume
would be 8 times as large. Defaults to 1.0.</p></li>
<li><p><em>size_distrib</em>: Range for size of spine. A random number R is
computed in the range 0 to 1, and the final size used is
<code class="docutils literal notranslate"><span class="pre">size</span> <span class="pre">+</span> <span class="pre">(R</span> <span class="pre">-</span> <span class="pre">0.5)</span> <span class="pre">*</span> <span class="pre">size_distrib</span></code>. Defaults to 0.5</p></li>
<li><p><em>angle</em>: This specifies the initial angle at which the spine sticks
out of the dendrite. If all angles were zero, they would all point
away from the soma. Defaults to 0 radians.</p></li>
<li><p><em>angle_distrib</em>: Specifies a random number to add to the initial
angle. Defaults to 2 PI radians, so the spines come out in any
direction.</p></li>
</ul>
<figure class="align-default" id="id43">
<img alt="3-D display for spiny active neuron" src="../../../_images/rdes9_spiny_active.png" />
<figcaption>
<p><span class="caption-text">3-D display for spiny active neuron</span><a class="headerlink" href="#id43" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Suggestions:</p>
<blockquote>
<div><ul class="simple">
<li><p>Try different spine settings. Warning: if you put in too many spines
it will take much longer to load and run!</p></li>
<li><p>Try different spine geometry layouts.</p></li>
<li><p>See if you can deliver the current injection to the spine. Hint: the
name of the spine compartments is 'head#' where # is the index of the
spine.</p></li>
</ul>
</div></blockquote>
</section>
<section id="place-spines-in-a-spiral-along-a-dendrite">
<h3><a class="toc-backref" href="#id78">Place spines in a spiral along a dendrite</a><a class="headerlink" href="#place-spines-in-a-spiral-along-a-dendrite" title="Permalink to this heading">¶</a></h3>
<p><em>ex9.3_spiral_spines.py</em></p>
<p>Just for fun. Illustrates how to place spines in a spiral around the dendrite.
For good measure the spines get bigger the further they are from the soma.</p>
<p>Note that the uniform spacing of spines is signified
by the negative minSpacing term, the fourth argument to spineDistrib.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">cellProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;ballAndStick&#39;</span><span class="p">,</span> <span class="s1">&#39;elec&#39;</span><span class="p">,</span> <span class="mf">10e-6</span><span class="p">,</span> <span class="mf">10e-6</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">,</span> <span class="mf">300e-6</span><span class="p">,</span> <span class="mi">50</span><span class="p">]],</span>
    <span class="n">spineProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;makePassiveSpine()&#39;</span><span class="p">,</span> <span class="s1">&#39;spine&#39;</span><span class="p">]],</span>
    <span class="n">spineDistrib</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;spine&#39;</span><span class="p">,</span> <span class="s1">&#39;#dend#&#39;</span><span class="p">,</span> <span class="s1">&#39;3e-6&#39;</span><span class="p">,</span> <span class="s1">&#39;-1e-6&#39;</span><span class="p">,</span> <span class="s1">&#39;1+p*2e4&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;p*6.28e7&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">]],</span>
    <span class="n">stimList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;inject&#39;</span><span class="p">,</span> <span class="s1">&#39;(t&gt;0.02) * 1e-9&#39;</span> <span class="p">]],</span>
    <span class="n">moogList</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Soma potential&#39;</span><span class="p">]]</span>
<span class="p">)</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">displayMoogli</span><span class="p">(</span> <span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.02</span> <span class="p">)</span>
</pre></div>
</div>
<p>Note that the uniform spacing of spines is signified
by the negative minSpacing term, the fourth argument to spineDistrib.</p>
<p>spineDistrib = [['spine', '#dend#', '3e-6', <strong>'-1e-6'</strong>, '1+p*2e4', '0', 'p*6.28e7', '0']]</p>
<figure class="align-default" id="id44">
<img alt="3-D display of spines in a spiral" src="../images/ex9.3_spiral_spines.png" />
<figcaption>
<p><span class="caption-text">3-D display of spines in a spiral</span><a class="headerlink" href="#id44" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Suggestions:</p>
<blockquote>
<div><ul class="simple">
<li><p>Play with expressions for spine size and angular placement.</p></li>
<li><p>See what happens if the segment size gets smaller than the
spine spacing.</p></li>
</ul>
</div></blockquote>
</section>
</section>
<section id="rdesigneur-command-reference">
<h2><a class="toc-backref" href="#id79">Rdesigneur command reference</a><a class="headerlink" href="#rdesigneur-command-reference" title="Permalink to this heading">¶</a></h2>
<p>Rdesigneur is a Python class used to build multiscale neuronal models
involving Reaction-Diffusion and Electrical SIGnaling in NEURons.
The stages in its use are illustrated in the following dummy code snippet:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Load in the libraries</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rdesigneur</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rd</span>

<span class="c1"># 2. Define the arguments. This does most of the model setup</span>
<span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span> <span class="n">args</span> <span class="p">)</span>

<span class="c1"># 3. Tweak parameters of model building-blocks, for example:</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/library/chem/kinetics/a&#39;</span> <span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">diffConst</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># 4. Build the model</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>

<span class="c1"># 5. Tweak values in the constructed model, for example</span>
<span class="n">bv</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">vec</span><span class="p">(</span> <span class="s1">&#39;/model/chem/dend/b&#39;</span> <span class="p">)</span>
<span class="n">bv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">concInit</span> <span class="o">*=</span> <span class="mi">2</span>

<span class="c1"># 6. Run the model</span>
<span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="n">runtime</span> <span class="p">)</span>

<span class="c1"># 7. Display and/or save model output</span>
<span class="n">rdes</span><span class="o">.</span><span class="n">dispay</span><span class="p">()</span>
</pre></div>
</div>
<p>The rdesigneur arguments are provided in the standard Python keyword-argument
format. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rdes</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">rdesigneur</span><span class="p">(</span>
    <span class="n">turnOffElec</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">chemDt</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="o">...</span>
    <span class="n">chemProto</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="s1">&#39;makeChemOscillator()&#39;</span><span class="p">,</span> <span class="s1">&#39;osc&#39;</span><span class="p">]</span> <span class="p">],</span>
    <span class="o">...</span>
    <span class="n">plotList</span> <span class="o">=</span> <span class="p">[</span> <span class="n">rd</span><span class="o">.</span><span class="n">rplot</span><span class="p">(</span> <span class="n">relpath</span> <span class="o">=</span> <span class="s1">&#39;dend/a&#39;</span><span class="p">,</span> <span class="n">field</span> <span class="o">=</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;[a] (uM)&#39;</span> <span class="p">)</span> <span class="p">],</span>
    <span class="o">...</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Each argument has a default, hence even
<a class="reference internal" href="#building-rdesigneur-without-arguments">building rdesigneur without arguments</a> will produce a correct, if not very
interesting model.</p>
<p><strong>Rdesigneur and Prototypes:</strong> Rdesigneur assembles models by taking prototype
objects and replicating them into the model. These prototypes can be chemical
reaction systems, ion channels, spines, or entire neurons. All the prototypes
are placed under the MOOSE object <em>/library</em>. When building the model, it looks
up prototypes by name and places them into the resulting model. The rdesigneur
constructor (step 2 above) builds all these prototypes. Once they are in place,
the <em>BuildModel()</em> method (step 4 above) performs the assembly.</p>
<p>Below we provide the usage of the argument list to rdesigneur, which
does most of the model specification.</p>
<section id="turnoffelec">
<h3><a class="toc-backref" href="#id80">turnOffElec</a><a class="headerlink" href="#turnoffelec" title="Permalink to this heading">¶</a></h3>
<p id="id2">Type: bool</p>
<p>Default: False</p>
<p>Use: Turns off electrical calculations. It is a good idea to set this flag
<strong>True</strong> if the model doesn't use electrical calculations, it can make the
calculations many times faster.</p>
</section>
<section id="usegssa">
<h3><a class="toc-backref" href="#id81">useGssa</a><a class="headerlink" href="#usegssa" title="Permalink to this heading">¶</a></h3>
<p>Type: bool</p>
<p>Default: True</p>
<p>Use: Turns on the use of the Gillespie Stochastic Simulation Algorithm (GSSA)
in dendritic spines. Advisable in models where you worry about stochasticity.
Also it typically makes the simulations run faster.</p>
</section>
<section id="combinesegments">
<h3><a class="toc-backref" href="#id82">combineSegments</a><a class="headerlink" href="#combinesegments" title="Permalink to this heading">¶</a></h3>
<p>Type: bool</p>
<p>Default: True</p>
<p>Use: Flag to pass on to the NeuroML loader to tell it to combine segments.</p>
</section>
<section id="stealcellfromlibrary">
<h3><a class="toc-backref" href="#id83">stealCellFromLibrary</a><a class="headerlink" href="#stealcellfromlibrary" title="Permalink to this heading">¶</a></h3>
<p>Type: bool</p>
<p>Default: False</p>
<p>Use: Use the prototype loaded-in neuron itself for the main simulation run,
removing it from the available prototypes.
It is advisable to set this to <em>True</em> if the model is large and complicated. It
saves memory and in some cases runs more reliably.</p>
</section>
<section id="verbose">
<h3><a class="toc-backref" href="#id84">verbose</a><a class="headerlink" href="#verbose" title="Permalink to this heading">¶</a></h3>
<p>Type: bool</p>
<p>Default: True</p>
<p>Use: Tell rdesigneur to be garrulous when loading and reporting status and
errors.</p>
</section>
<section id="addsomachemcompt">
<span id="id3"></span><h3><a class="toc-backref" href="#id85">addSomaChemCompt</a><a class="headerlink" href="#addsomachemcompt" title="Permalink to this heading">¶</a></h3>
<p>Type: bool</p>
<p>Default: False</p>
<p>Use: Specify that the largest chemical compartment (by volume) should be
assigned to the cell soma. Most multiscale models don't bother with a soma
chemical compartment, and are happy with dendrite and possibly spines, so this
defaults to False.</p>
</section>
<section id="addendochemcompt">
<span id="id4"></span><h3><a class="toc-backref" href="#id86">addEndoChemCompt</a><a class="headerlink" href="#addendochemcompt" title="Permalink to this heading">¶</a></h3>
<p>Type: bool</p>
<p>Default: False</p>
<p>Use: Specify that each of the chemical compartments should contain an internal
<em>endo</em>-compartment. This is typically used for the endoplasmic reticulum in
<a class="reference internal" href="#models-of-calcium-induced-calcium-release">models of calcium-induced calcium release</a> (CICR), however, the
EndoCompartments are quite general and can be used for defining chemistry and
transport involving any membrane-bound organelle. In MOOSE, when you create
an EndoCompartment it must be surrounded by a regular compartment, and a
voxel of the EndoCompartment appears within every voxel of the surrounding
compartment.</p>
</section>
<section id="diffusionlength">
<h3><a class="toc-backref" href="#id87">diffusionLength</a><a class="headerlink" href="#diffusionlength" title="Permalink to this heading">¶</a></h3>
<p>Type: double</p>
<p>Default: 2e-6 (2 microns)</p>
<p>Use: This sets the spatial discretization length of reaction-diffusion models.
If the diffusion constant is D (in micron^2/sec), then the <em>diffusionLength</em>
should be less than D microns for signaling events that take 1 second. If the
signaling is faster, <em>diffusionLength</em> should be smaller.</p>
</section>
<section id="temperature">
<h3><a class="toc-backref" href="#id88">temperature</a><a class="headerlink" href="#temperature" title="Permalink to this heading">¶</a></h3>
<p>Type: double</p>
<p>Default: 32 degrees Celsius</p>
<p>Use: ChannelML definitions of ion channels use this value to modulate
their kinetics.</p>
</section>
<section id="chemdt">
<h3><a class="toc-backref" href="#id89">chemDt</a><a class="headerlink" href="#chemdt" title="Permalink to this heading">¶</a></h3>
<p>Type: double</p>
<p>Default: 0.1 s</p>
<p>Use: Specify timestep for chemical computations. Note that internally the MOOSE
solver will probably use finer or adaptive timesteps. The <em>chemDt</em> just ensures
that all the chemical values in different solvers will be synchronized at
this interval. You will want to make this somewhat smaller (0.01 to 0.001 s)
in the case of multiscale simulations with tight coupling between electrical
and signaling events.</p>
</section>
<section id="diffdt">
<h3><a class="toc-backref" href="#id90">diffDt</a><a class="headerlink" href="#diffdt" title="Permalink to this heading">¶</a></h3>
<p>Type: double</p>
<p>Default: 0.01 s</p>
<p>Use: Specify timestep for diffusion computations, as well as cross-compartment
reactions and molecular transport across membrane pores. This timestep
does not apply to voltage-gated and synaptic channels handled by the electrical
solver, for that use <em>elecDt</em>.
You will want to make this somewhat smaller (0.01 to 0.001 s)
in the case of multiscale simulations with tight coupling between electrical
and signaling events.</p>
</section>
<section id="elecdt">
<h3><a class="toc-backref" href="#id91">elecDt</a><a class="headerlink" href="#elecdt" title="Permalink to this heading">¶</a></h3>
<p>Type: double</p>
<p>Default: 50e-6 s</p>
<p>Use: Specify timestep for electrical calculations, used by the HSolver in
MOOSE to carry out calculations using Gaussian Elimination and the Crank-
Nicolson method for ion channels. This works well for slower
channels, but if you have particularly fast channel kinetics you may wish to
use <em>elecDt</em> of 10 to 20 us.</p>
</section>
<section id="chemplotdt">
<h3><a class="toc-backref" href="#id92">chemPlotDt</a><a class="headerlink" href="#chemplotdt" title="Permalink to this heading">¶</a></h3>
<p>Type: double</p>
<p>Default: 1 s</p>
<p>Use: Timestep for storing and plotting chemical values.</p>
</section>
<section id="elecplotdt">
<h3><a class="toc-backref" href="#id93">elecPlotDt</a><a class="headerlink" href="#elecplotdt" title="Permalink to this heading">¶</a></h3>
<p>Type: double</p>
<p>Default: 100e-6 s</p>
<p>Use: Timestep for storing and plotting electrical values.</p>
</section>
<section id="funcdt">
<h3><a class="toc-backref" href="#id94">funcDt</a><a class="headerlink" href="#funcdt" title="Permalink to this heading">¶</a></h3>
<p>Type: double</p>
<p>Default: 100e-6 s</p>
<p>Use: Timestep for performing Function calculations for inputs and stimuli,
for electrical models. Only used for electrical models, i.e.,
when <a class="reference internal" href="#id2">turnOffElec</a> is False. Otherwise the system uses a <em>funcDt</em> equal to
the <em>chemDt</em>.</p>
</section>
<section id="cellproto">
<h3><a class="toc-backref" href="#id95">cellProto</a><a class="headerlink" href="#cellproto" title="Permalink to this heading">¶</a></h3>
<p>Type: List of lists</p>
<p>Default: [] (empty list). This generates the Hodgkin-Huxley configuration where
length and diameter are 500 microns, RM = 0.333, RA = 3000, and
CM = 0.01 F/m^2, but no active channels.</p>
<p>Use: This defines which neuronal model specification to use. There are many
options here:</p>
<blockquote>
<div><ol class="arabic">
<li><p>zero args: make standard soma corresponding to the Hodgkin-Huxley
model. length and diameter are both 500 um.</p></li>
<li><p>[name, library_proto_name]: uses library prototype object.</p></li>
<li><p>[fname.suffix, cellname ]: Loads cell from file. The file type
is identified by the suffix, and can be :</p>
<blockquote>
<div><ul class="simple">
<li><p><em>.nml</em>: NeuroML</p></li>
<li><p><em>.xml</em>: NeuroML</p></li>
<li><p><em>.swc</em>: NeuroMorpho.org format for cellular morphology</p></li>
<li><p><em>.p</em>: Genesis format</p></li>
</ul>
</div></blockquote>
</li>
<li><p>[moose&lt;Classname&gt;, cellname]: Makes prototype from MOOSE class.</p></li>
<li><p>[funcname, cellname]: Calls named function with specified
name of cell to be made.</p></li>
<li><p>[path, cellname]: Copies path to library as proto</p></li>
<li><p>[libraryName, cellname]: Renames library entry as prototype.</p></li>
<li><p>[somaProto, name, somaDia=5e-4, somaLen=5e-4]
Creates a soma with optional specified diameter and length. Defaults
as shown.</p></li>
<li><p>[ballAndStick,name, somaDia=10e-6, somaLen=10e-6,
dendDia=4e-6, dendLen=200e-6, numDendSeg=1]
Creates a ball-and-stick with required type and name arguments.
The remaining arguments are optional. Defaults as shown.</p></li>
</ol>
</div></blockquote>
</section>
<section id="spineproto">
<h3><a class="toc-backref" href="#id96">spineProto</a><a class="headerlink" href="#spineproto" title="Permalink to this heading">¶</a></h3>
<p id="spine-prototype">Type: List of lists</p>
<p>Default: [] (empty list). This does not define any spines.</p>
<p>Use: Each list entry should be a list containing two strings: <em>source</em> and
<em>destination</em>. The <em>source</em> defines how to build the prototype. The
<em>destination</em> specifies its name.
If the requested <em>destination</em> is an object that already exists in the library,
the system doesn't do anything.</p>
<p>The <em>source</em> can be any of:</p>
<blockquote>
<div><ul>
<li><p>functionName(): Call specified Python function, with the <em>destination</em>
as the argument. The function is expected to build a prototype of the
requested name on '/library'. The following utility functions are
built-in:</p>
<blockquote>
<div><ul>
<li><p>makePassiveSpine(): Makes a 2-compartment spine with the following
parameters:</p>
<blockquote>
<div><ul class="simple">
<li><p>shaft name: shaft</p></li>
<li><p>shaft length = 1 micron</p></li>
<li><p>shaft diameter = 0.2 micron</p></li>
<li><p>head name: head</p></li>
<li><p>head length = 0.5 micron</p></li>
<li><p>head diameter = 0.5 micron</p></li>
<li><p>RM = 1.0</p></li>
<li><p>RA = 1.0</p></li>
<li><p>CM = 0.01</p></li>
</ul>
</div></blockquote>
</li>
<li><p>makeExcSpine(): Same as above but adds in glutamate and NMDA
receptors and a calcium pool. The calcium pool has a pumping tau of
13.333 ms, and is present in the volume of the spine head.
Both receptors have conductances in the form of dual-exponential
alpha functions, with a separate opening and closing tau.
The glutamate receptor has the following parameters:</p>
<blockquote>
<div><ul class="simple">
<li><p>name: glu</p></li>
<li><p>opening tau: 2 ms</p></li>
<li><p>closing tau: 9 ms</p></li>
<li><p>Gbar, ie, conductance per unit area: 200 Siemens/m^2</p></li>
</ul>
</div></blockquote>
<p>The NMDA receptor has the following parameters:</p>
<blockquote>
<div><ul class="simple">
<li><p>name: NMDA</p></li>
<li><p>opening tau: 20 ms</p></li>
<li><p>closing tau: 20 ms</p></li>
<li><p>Gbar, ie, conductance per unit area: 80 Siemens/m^2</p></li>
</ul>
</div></blockquote>
</li>
<li><p>makeActiveSpine(): Same as above, but also adds in a voltage-gated
calcium channel with <em>Gbar = 10 Siemens/m^2</em> into the spine head.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Path of existing object in memory, such as <em>/library/source</em>. In this
case rdesigneur renames the object to <em>/library/destination</em>.</p></li>
<li><p>A filename, with any of the suffices:</p>
<blockquote>
<div><ul class="simple">
<li><p><em>.nml</em>: NeuroML</p></li>
<li><p><em>.xml</em>: NeuroML</p></li>
<li><p><em>.swc</em>: NeuroMorpho.org format for cellular morphology</p></li>
<li><p><em>.p</em>: Genesis format</p></li>
</ul>
</div></blockquote>
</li>
<li><p>moose::SymCompartment: Make a SymCompartment for the spine. Deprecated.</p></li>
<li><p>moose::Compartment: Make a Compartment for the spine. Deprecated.</p></li>
</ul>
</div></blockquote>
</section>
<section id="chanproto">
<h3><a class="toc-backref" href="#id97">chanProto</a><a class="headerlink" href="#chanproto" title="Permalink to this heading">¶</a></h3>
<p>Type: List of lists</p>
<p>Default: [] (empty list). The empty list does not define any channels.</p>
<p>Use: Each list entry must have a string for the <em>source</em>. It can optionally
have a second string for the <em>destination</em>, which is the name to give to the
<em>source</em> channel when it is constructed on <em>/library</em>.</p>
<p>The following options are available for specifying the <em>source</em> for
making channel prototypes:</p>
<blockquote>
<div><ul>
<li><p>Filepath. This is relative to the working directory. The following
file types are known:</p>
<blockquote>
<div><ul class="simple">
<li><p>xml: ChannelML, which is a subset of NeuroML</p></li>
<li><p>nml: ChannelML, which is a subset of NeuroML</p></li>
</ul>
</div></blockquote>
<p>Channels in thse formats are available from <a class="reference external" href="http://www.opensourcebrain.org/">Open Source Brain</a>,</p>
</li>
<li><p>Predefined channel prototypes, available as functions within
rdesigneur. This is indicated by the use of braces after the name.
The following prototypes are currently available:</p>
<blockquote>
<div><ul class="simple">
<li><p>make_HH_Na(): Make the classical Hodgkin-Huxley Na channel, with
kinetics scaled to SI units.</p></li>
<li><p>make_HH_K(): Classical HH delayed rectifier K channel.</p></li>
<li><p>make_Na(): Hippocampal pyramidal Na channel from Traub 1991.</p></li>
<li><p>make_K_DR(): Hippocampal pyramidal K delayed rectifier channel
from Traub 1991.</p></li>
<li><p>make_K_A(): Hippocampal pyramidal A-type K channel from Traub
1991.</p></li>
<li><p>make_Ca_conc(): A calcium pool with tau 13.333 ms. This is
required for the calcium dynamics of several channels.</p></li>
<li><p>make_Ca(): Voltage-gated Calcium channel, based on Traub 1991. It
requires the Ca_conc.</p></li>
<li><p>make_K_AHP: Voltage and calcium-gated afterhyperpolarization-
activated K channel, from Traub 1991. Note that this channel
requires the presence of the Ca_conc.</p></li>
<li><p>make_K_C: Voltage and calcium-dependent K channel from Traub 1991.
This channel requires the presence of the Ca_conc.</p></li>
<li><p>make_glu(): Glutamate receptor in the form of dual-exponential
alpha functions, with a separate opening (2ms) and closing (9ms)
tau. Reversal potential = 0 mV.</p></li>
<li><p>make_GABA(): GABA receptor in the form of dual-exponential
alpha functions, with a separate opening (4ms) and closing (9ms)
tau. Reversal potential = -65 mV.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<blockquote>
<div><ul>
<li><p>User-defined channel definition functions.
These can be from external Python files, using the
full path to the file name minus the suffix. The specific function
within it is then specified. For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chanProto</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;/home/user/models/channelProtos.make_K_AHP()&#39;</span><span class="p">,</span> <span class="s1">&#39;K_AHP&#39;</span><span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</div></blockquote>
</section>
<section id="chemproto">
<h3><a class="toc-backref" href="#id98">chemProto</a><a class="headerlink" href="#chemproto" title="Permalink to this heading">¶</a></h3>
<p>Type: List of lists</p>
<p>Default: [] (empty list). The empty list does not define any chemical systems.</p>
<p>Use: Each list entry must have a string for the <em>source</em>. It can optionally
have a second string for the <em>destination</em>, which is the name to give to the
<em>source</em> chemical system when it is constructed on <em>/library</em>.</p>
<p>The following options are available for specifying the <em>source</em> for
making channel prototypes:</p>
<blockquote>
<div><ul>
<li><p>Filepath. This is relative to the working directory. The following
file types are known:</p>
<blockquote>
<div><ul class="simple">
<li><p>xml: SBML</p></li>
<li><p>sbml: SBML</p></li>
<li><p>.g: GENESIS Kinetikit (kkit.g) format.</p></li>
</ul>
</div></blockquote>
<p>Channels in thse formats are available from the <a class="reference external" href="https://doqcs.ncbs.res.in/">DOQCS</a> database,
and from the <a class="reference external" href="https://www.ebi.ac.uk/biomodels-main/">BioModels</a> database,</p>
</li>
<li><p>Predefined functions. At present only one such function is available,
<strong>makeChemOscillator()</strong></p></li>
<li><dl>
<dt>User-defined functions.</dt><dd><p>These can be from external Python files, using the
full path to the file name minus the suffix. The specific function
within it is then specified. For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chemProto</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;/home/user/models/chemProtos.make_Osc()&#39;</span><span class="p">,</span> <span class="s1">&#39;osc&#39;</span><span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p>Pool objects. These are created on the fly using the form</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chemProto</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;moose:Pool&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</section>
<section id="passivedistrib">
<h3><a class="toc-backref" href="#id99">passiveDistrib</a><a class="headerlink" href="#passivedistrib" title="Permalink to this heading">¶</a></h3>
<p>Type: List of lists</p>
<p>Default: [] (empty list). Does nothing.</p>
<p>Use; This is for adjusting the passive properties of the neuron. Each list
entry is a list of strings, of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">path</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="p">[</span><span class="n">field</span><span class="p">,</span> <span class="n">expr</span><span class="p">]</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>Here the <em>path</em> is a MOOSE wildcard path, which defines one or more objects.
Briefly, the '#' character specifies any string, and the double '##' specifies
any string at any level in the tree. For example, to specify any compartment
with the string 'dend' you would use <em>'#dend#'</em> and to specify any object
anywhere in the tree you would use <em>'##'</em>.</p>
<p>The <em>field</em> can be any one of the following:</p>
<blockquote>
<div><ul class="simple">
<li><p>RM: Membrane resistivity, in ohms.m^2</p></li>
<li><p>RA: Axial resistivity, in ohms.m</p></li>
<li><p>CM: Membrane specific capacitance, in Farads/m^2</p></li>
<li><p>Rm: Absolute membrane resistance of that segment, in ohms.</p></li>
<li><p>Ra: Absolute axial resistance of that segment, in ohms.</p></li>
<li><p>Cm: Absolute membrane capacitance of that segment, in Farads.</p></li>
<li><p>Em: Membrane resting potential, in Volts.</p></li>
<li><p>initVm: Initial value to set the membrane potential, in Volts.</p></li>
</ul>
</div></blockquote>
<p>The <em>expr</em> is an expression string that is evaluated to give the desired value
for the field. This can be as simple as the value itself, but can be a much
more interesting function of geometrical properties of the cell. The geometry
arguments available to the <em>expr</em> include:</p>
<blockquote>
<div><ul class="simple">
<li><p>p: Path length in metres from the soma, measured along the dendrite.</p></li>
<li><p>g: Geometrical distance from the soma.</p></li>
<li><p>L: Number of electronic length constants from the soma</p></li>
<li><p>len: length of the segment of dendrite</p></li>
<li><p>dia: diameter of the segment of dendrite</p></li>
<li><p>maxP: Maximum path length of any dendrite in the cell.</p></li>
<li><p>maxG: Maximum geometrical distance of any dendrite from soma</p></li>
<li><p>maxL: Maximum electrotonic distance of any dendrite from the soma</p></li>
</ul>
</div></blockquote>
<p>Putting these together, here is an example of using the passiveDistrib:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">passiveDistrib</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span> <span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;RM&#39;</span><span class="p">,</span> <span class="s1">&#39;1.0&#39;</span><span class="p">,</span> <span class="s1">&#39;CM&#39;</span><span class="p">,</span> <span class="s1">&#39;0.02&#39;</span> <span class="p">],</span>
    <span class="p">[</span> <span class="s1">&#39;#dend#&#39;</span><span class="p">,</span> <span class="s1">&#39;RM&#39;</span><span class="p">,</span> <span class="s1">&#39;1.5 + 0.5*(p&gt;200e-6)&#39;</span><span class="p">,</span> <span class="s1">&#39;CM&#39;</span><span class="p">,</span> <span class="s1">&#39;0.01&#39;</span> <span class="p">],</span>
<span class="p">]</span>
</pre></div>
</div>
<p>This means set the soma <em>RM</em> to 1.0, and <em>CM</em> to 0.02, leaving the <em>RA</em> as the
default. The scaled value for <em>Rm</em>, <em>Ra</em>, and <em>Cm</em> are computed by scaling
these terms according to the soma dimensions.
For all dendrite compartments, set the <em>RM</em> to 1.5 provided it is closer than
200 microns dendritic path length from the soma, and set the <em>RM</em> to 2.0 for
all dendritic compartments further than this.
Finally, for all dendrite compartments, set <em>CM</em> to 0.01. Note that again
the absolute <em>Rm</em> and <em>Cm</em> will be scaled according to the local compartment
dimensions.</p>
</section>
<section id="spinedistrib">
<h3><a class="toc-backref" href="#id100">spineDistrib</a><a class="headerlink" href="#spinedistrib" title="Permalink to this heading">¶</a></h3>
<p>Type: List of lists</p>
<p>Default: [] (empty list). Does nothing.</p>
<p>Use: This is for inserting dendritic spines onto the neuron.
Each entry is a list of strings, of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">proto</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="p">[</span><span class="n">spacing</span><span class="p">,</span> <span class="n">minSpacing</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">sizeDistrib</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">angleDistrib</span><span class="p">]]</span>
</pre></div>
</div>
<p>Of these, the <em>name</em> and the <em>path</em> are required entries, and the remainder
can be provided in pairs. The defaults for these entries are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;spine&#39;</span><span class="p">,</span> <span class="s1">&#39;#dend#,#apical#&#39;</span><span class="p">,</span> <span class="s1">&#39;10e-6&#39;</span><span class="p">,</span> <span class="s1">&#39;1e-6&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;6.2832&#39;</span> <span class="p">]</span>
</pre></div>
</div>
<p>The interpretation of the arguments is as follows:</p>
<blockquote>
<div><ul class="simple">
<li><p>name: This is the name of the <a class="reference internal" href="#spine-prototype">spine prototype</a>.</p></li>
<li><p>path: The wildcard path of compartments on which to insert the spines.
In the example above, <em>'#dend#,#apical#'</em> means all compartments with
the strings <em>dend</em> or <em>apical</em> in their names.</p></li>
<li><p>spacing: The mean spacing between spines. At present the spines are placed
with a Poisson distribution. This is a math expression with the same
terms as used for the passive distribution, so that the spine spacing
can be a function of spine position along the dendritic tree. The form
of this expression is shown again below.</p></li>
<li><p>minSpacing: The minimum spacing, and the increment along which the
Poisson samples are taken to decide if a spine should be added.
In case <em>minSpacing</em> is negative, the system places spines with uniform
<em>spacing</em> along the dendritic segment. If
<code class="docutils literal notranslate"><span class="pre">segment</span> <span class="pre">length</span> <span class="pre">&lt;</span> <span class="pre">0.5</span> <span class="pre">*</span> <span class="pre">spacing</span></code>
then the system falls back onto Poisson samples so that finely
subdivided dendrites don't miss out on spines altogether.</p></li>
<li><p>size: Scale factor for size from the prototype spine. All dimension of
the spine are scaled by this number: shaft length, shaft diameter,
head length and head diameter. This is a math expression, as shown below.</p></li>
<li><p>sizeDistrib: The range of distribution of sizes. This is a linear
distribution centered around the defined size.</p></li>
<li><p>angle: The initial angle of the first spine on each dendrite compartment,
in radians. This is a math expression, as shown below.</p></li>
<li><p>angleDistrib: The range of of angles around this initial angle.
The angle will be chosen from a linear distribution centered around the
centre angle, +/- angleDistrib.</p></li>
</ul>
</div></blockquote>
<p>The expression used for spacing, size, and angle is of the form of an
an expression string that is evaluated to give the desired value
for the field. This can be as simple as the value itself, but can be a much
more interesting function of geometrical properties of the cell. The geometry
arguments available to the <em>expr</em> include:</p>
<blockquote>
<div><ul class="simple">
<li><p>p: Path length in metres from the soma, measured along the dendrite.</p></li>
<li><p>g: Geometrical distance from the soma.</p></li>
<li><p>L: Number of electronic length constants from the soma</p></li>
<li><p>len: length of the segment of dendrite</p></li>
<li><p>dia: diameter of the segment of dendrite</p></li>
<li><p>maxP: Maximum path length of any dendrite in the cell.</p></li>
<li><p>maxG: Maximum geometrical distance of any dendrite from soma</p></li>
<li><p>maxL: Maximum electrotonic distance of any dendrite from the soma</p></li>
</ul>
</div></blockquote>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;spine&#39;</span><span class="p">,</span> <span class="s1">&#39;#dend#&#39;</span><span class="p">,</span> <span class="s1">&#39;1e-6 + (dia&lt;2e-6)*10&#39;</span><span class="p">,</span> <span class="s1">&#39;1e-7&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="s1">&#39;6.28*p/maxP&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>proto</strong>: The prototype spine by the name of <em>spine</em> is used.</p>
<p><strong>path</strong>: All compartments with the string <em>dend</em> in their name are used.</p>
<p><strong>Spacing</strong>: The spines are only placed on branches smaller than 2 microns
(otherwise the spine spacing is 10 metres). On these small branches the
spacing is, on average, 1 micron.</p>
<p><strong>Size</strong>: The size is anything from 50% to 150% of the prototype spine size.</p>
<p><strong>Angle</strong>: The angle is proportional to the distance from the soma, such that
the spines make a complete spiral (2pi) around the dendrite over its length.</p>
</section>
<section id="chandistrib">
<h3><a class="toc-backref" href="#id101">chanDistrib</a><a class="headerlink" href="#chandistrib" title="Permalink to this heading">¶</a></h3>
<p>Type: List of lists</p>
<p>Default: [] (empty list). Does nothing.</p>
<p>Use: This is for inserting ion channels onto the neuron.
Each entry is a list of strings, of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">proto</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="p">[</span><span class="n">field</span><span class="p">,</span> <span class="n">expr</span><span class="p">]</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>The entries here are of the form:</p>
<blockquote>
<div><ul class="simple">
<li><p>proto: Specifies the name of the prototype channel to insert</p></li>
<li><p>path: Wildcard path of compartments in which to insert the channel</p></li>
<li><p>field: Field to assign to channel, almost always <strong>Gbar</strong>, to set its
channel density.</p></li>
<li><p>expr: Expression evaluated to obtain value to assign to field. This is a
mathematical expression of various geometrical properties of the cell,
as listed below.</p></li>
</ul>
</div></blockquote>
<p id="usual-function">The <em>expr</em> can be as simple as the value itself, but can be a much
more interesting function of geometrical properties of the cell. The geometry
arguments available to the <em>expr</em> include:</p>
<blockquote>
<div><ul class="simple">
<li><p>p: Path length in metres from the soma, measured along the dendrite.</p></li>
<li><p>g: Geometrical distance from the soma.</p></li>
<li><p>L: Number of electronic length constants from the soma</p></li>
<li><p>len: length of the segment of dendrite</p></li>
<li><p>dia: diameter of the segment of dendrite</p></li>
<li><p>maxP: Maximum path length of any dendrite in the cell.</p></li>
<li><p>maxG: Maximum geometrical distance of any dendrite from soma</p></li>
<li><p>maxL: Maximum electrotonic distance of any dendrite from the soma</p></li>
</ul>
</div></blockquote>
<p>A typical channel distribution entry is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;kdr&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;Gbar&quot;</span><span class="p">,</span> <span class="s2">&quot;p &lt; 50e-6 ? 500 : 100&quot;</span> <span class="p">]</span>
</pre></div>
</div>
<p>Here the <em>kdr</em> channel is inserted throughout the cell, and its conductance
is at 500 Siemens/m^2 for all regions closer than 50 microns, and 100 S/m^2
for the rest of the cell. Basically there is lots of the channel on and
near the soma.</p>
</section>
<section id="chemdistrib">
<h3><a class="toc-backref" href="#id102">chemDistrib</a><a class="headerlink" href="#chemdistrib" title="Permalink to this heading">¶</a></h3>
<p>Type: List of lists</p>
<p>Default: [] (empty list). Does nothing.</p>
<p>Use: This is for inserting a chemical system into the neuron
Each entry is a list of strings, of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">proto</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="p">]</span>
</pre></div>
</div>
<p>The entries here are of the form:</p>
<blockquote>
<div><ul class="simple">
<li><p>proto: Specifies the name of the prototype chemical system to insert</p></li>
<li><p>path: Wildcard path of compartments in which to insert the channel</p></li>
<li><p>'install': Default string.</p></li>
<li><p>expr: Expression evaluated to decide whether to install the chemical
system. This is the <a class="reference internal" href="#usual-function">usual function</a> of geometrical properties of the
cell. It is usually '1', to tell the system to install throughout the
<em>path</em>.</p></li>
</ul>
</div></blockquote>
<p>The chemical distribution is handled specially for assignment to the neuronal
morphology. This is because a given chemical system will have reactions
between dendrite, ER, spines and PSD, as well as diffusion between these
zones. Thus, though it would be convenient,  we cannot simply define separate
chemical systems for each cellular compartment. Instead we use one of two
conventions for doing the assignment.</p>
<ol class="arabic">
<li><p>Volume based. If the model format does not permit explicit naming of the
chemical compartments in the model, then the assignment is inferred from
the volume of each compartment. This limitation applies for the legacy
Genesis/kkit <strong>.g</strong> format. It may also apply to SBML models that do not
assign suitable names for their chemical compartments. In this case
the largest chemical compartment is
assigned to the dendrite, the next (if present) to the spine head, and the
smallest (if present) to the spine PSD.</p>
<p>This is modified in one of two ways by the flags <a class="reference internal" href="#addsomachemcompt">addSomaChemCompt</a> and
<a class="reference internal" href="#addendochemcompt">addEndoChemCompt</a>.</p>
<p><em>addSomaChemCompt</em>  instructs rdesigneur to use the largest compartment for
the soma. The remaining compartments follow in the usual order.</p>
<p><em>addEndoChemCompt</em> instructs rdesigneur to insert an EndoCompartment in
each neuronal compartment. The volume order is now dend, dend_endo,
spine-head, spine-head-endo and so on.</p>
</li>
<li><p>Name based. This works for recent SBML models, which can assign a compartment
name to each of the chemical compartments. Here the expectation is that the
names are one of <em>soma</em>, <em>soma_endo</em>, <em>dend</em>, <em>dend_endo</em>, <em>spine</em>,
<em>spine_endo</em>, <em>psd</em>, <em>psd_endo</em>.
Note that the last one, though permitted, doesn't make much biological
sense.</p></li>
</ol>
</section>
<section id="adaptorlist">
<h3><a class="toc-backref" href="#id103">adaptorList</a><a class="headerlink" href="#adaptorlist" title="Permalink to this heading">¶</a></h3>
<p>Type: List of lists</p>
<p>Default: [] (empty list). Does nothing.</p>
<p>Use: This is for implementing an adaptor between chemical and electrical, or
chemical and structural quantities. Adaptors handle the conversion between
distinct concepts in chemical and electrical models. For example, Calcium
concentration as computed electrically in the Ca_conc objects, can map to the
calcium concentration of the ion as a molecule, where it can react, diffuse,
and undergo other calcium dynamics. Another common use is to map the
concentration of the molecular state of an ion channel, to its conductance.
The adaptor applies the conversion equation <strong>y = mx + c</strong> where <strong>y</strong> is the
target value, <strong>x</strong> is the source value, <strong>m</strong> is the slope of the conversion,
and <strong>c</strong> is the offset.</p>
<p>Adaptors automatically average over multiple inputs if the mapping requires.
Typically electrical segments each contain many chemical voxels, so the
adaptor averages all the source chemical quantities to apply to the
corresponding electrical quantity. Similarly, each chemical timestep is
typically much longer than the electrical timestep, so the adaptor averages
the electrical quantity over the entire duration of the chemical timestep.</p>
<p>Each entry is a list of strings, of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">source</span><span class="p">,</span> <span class="n">source_field</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">dest_field</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">scaling</span><span class="p">]</span>
</pre></div>
</div>
<p>The entries here are:</p>
<blockquote>
<div><ul class="simple">
<li><p>source: Specifies the path of the objects whose quantities need to be
converted. In the case of chemical quantities, the path starts with the
compartment name, one of <em>dend</em>, <em>spine</em>, or <em>psd</em>. So the molecule
Ca in the dendrite would be identified as <em>dend/Ca</em>.</p></li>
<li><p>source_field: The field on the source object whose value is to be used.</p></li>
<li><p>dest: Path of destination object, whose quantities will be assigned.
As above, chemical quantities are prefixed by their compartment name.</p></li>
<li><p>dest_field: Field to be assigned on the destination object.</p></li>
<li><p>offset: Double. In the conversion, what is the value of the dest_field
when the source value is zero?. In other words, the quantity <strong>c</strong> in
the conversion equation <strong>y = mx + c</strong></p></li>
<li><p>scaling: Double. The slope <strong>m</strong>.</p></li>
</ul>
</div></blockquote>
</section>
<section id="stimlist">
<h3><a class="toc-backref" href="#id104">stimList</a><a class="headerlink" href="#stimlist" title="Permalink to this heading">¶</a></h3>
<p>Type: List of lists</p>
<p>Default: [] (empty list). Does nothing.</p>
<p>Use: Each entry is a list of strings, as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">path</span><span class="p">,</span> <span class="n">geometry_expr</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">dest_field</span><span class="p">,</span> <span class="n">time_expr</span><span class="p">]</span>
</pre></div>
</div>
<dl class="simple">
<dt>The entries here are:</dt><dd><ul class="simple">
<li><p>path: The usual MOOSE wildcard path to identify electrical compartments
over which the stimulus will extend. Note that the stimulus may be to
a chemical entity, but the spatial location is specified in terms of
the electrical compartments in which the chemical system is embedded.</p></li>
<li><p>geometry_expr. This is the <a class="reference internal" href="#usual-function">usual function</a> of geometrical properties
of the cell. If it is non-zero, then the stimulus will apply.
There is a special case for synaptic inputs in which the <em>geometry_expr</em>
is repaced with the synaptic weight, recorded as a string.</p></li>
<li><p>dest. This is the destination object for the stimulus.</p></li>
<li><p>dest_field. This is the field on the destination object to be assigned.
There is a special case for synaptic inputs, where the field can be
<strong>periodicsyn</strong> or <strong>randsyn</strong>, representing periodic and random
synaptic input respectively.</p></li>
<li><p>time_expr: This is the time expression of the value of the stimulus.
Unlike the <em>geometry_expr</em>, the <em>time_expr</em> can take the predefined
variable <strong>t</strong> which is the current simulation time. The <em>time_expr</em> does
not have access to the geometry arguments.</p></li>
</ul>
</dd>
</dl>
<p>Example 1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;head#&#39;</span><span class="p">,</span> <span class="s1">&#39;0.5&#39;</span><span class="p">,</span><span class="s1">&#39;glu&#39;</span><span class="p">,</span> <span class="s1">&#39;periodicsyn&#39;</span><span class="p">,</span> <span class="s1">&#39;1 + 40*(t&gt;10 &amp;&amp; t&lt;11)&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>This acts on all glutamate receptors on the spine <em>heads</em>. It delivers
periodic synaptic input with weight 0.5 at a basal rate of 1 Hz, rising
by 40Hz in the interval between 10 and 11 seconds.</p>
<p>Example 2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;inject&#39;</span><span class="p">,</span> <span class="s1">&#39;(1+cos(t/10))*(t&gt;31.4 &amp;&amp; t&lt;94)* 0.5e-9&#39;</span> <span class="p">]</span>
</pre></div>
</div>
<p>This acts to deliver a current injection on the soma. It delivers cosine
input of angular frequency 1/10 radians/s, between times 31.4 and 94 seconds,
with a peak amplitude of 0.5 nA.</p>
<p>Rdesigneur also supports keyword-based argument lists for the stimList.
Here each entry is an rstim function as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rd</span><span class="o">.</span><span class="n">rstim</span><span class="p">(</span> <span class="n">elecpath</span><span class="p">,</span> <span class="n">geom_expr</span><span class="p">,</span> <span class="n">relpath</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">expr</span> <span class="p">)</span>
</pre></div>
</div>
<p>The default values of the arguments are</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rd</span><span class="o">.</span><span class="n">rstim</span><span class="p">(</span><span class="n">elecpath</span><span class="o">=</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="n">geom_expr</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">relpath</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">&#39;inject&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Example 3: To get the same outcome as example 2, one could use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rd</span><span class="o">.</span><span class="n">rstim</span><span class="p">(</span> <span class="n">expr</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">&gt;</span><span class="mf">31.4</span> <span class="o">&amp;&amp;</span> <span class="n">t</span><span class="o">&lt;</span><span class="mi">94</span><span class="p">)</span><span class="o">*</span> <span class="mf">0.5e-9</span><span class="s1">&#39; )</span>
</pre></div>
</div>
<p>because most of the arguments are the same as the defaults.</p>
</section>
<section id="plotlist">
<h3><a class="toc-backref" href="#id105">plotList</a><a class="headerlink" href="#plotlist" title="Permalink to this heading">¶</a></h3>
<p>Type: List of lists</p>
<p>Default: [] (empty list). Does nothing.</p>
<p>Use: This displays a line plot of cellular activity.
Each entry is a list as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">path</span><span class="p">,</span> <span class="n">geom_expr</span><span class="p">,</span> <span class="n">relpath</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
    <span class="p">[</span><span class="n">mode</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span><span class="n">saveFile</span><span class="p">,</span> <span class="n">saveResolution</span><span class="p">,</span> <span class="n">showFlag</span> <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<dl>
<dt>The entries here are:</dt><dd><ul>
<li><p>path: string. The usual MOOSE wildcard path to identify electrical
compartments
over which the plots will be sampled. Note that the stimulus may be to
a chemical entity, but the spatial location is specified in terms of
the electrical compartments in which the chemical system is embedded.</p></li>
<li><p>geom_expr: string. This is the <a class="reference internal" href="#usual-function">usual function</a> of geometrical
properties of the cell. If it is non-zero, then the stimulus will apply.
There is a special case for synaptic inputs in which the <em>geometry_expr</em>
is repaced with the synaptic weight, recorded as a string.</p></li>
<li><p>replath: string. Relative path to object whose value is being monitored.</p></li>
<li><p>field: string. The field to monitor on the source object.</p></li>
<li><p>title: Title string for the generated plot.</p></li>
<li><p>mode: Optional. String to decide what kind of plot to make. Options are:</p>
<blockquote>
<div><ul class="simple">
<li><p><em>'time'</em>: Default. Plot time-series</p></li>
<li><p><em>'wave'</em>: Generate wave-plot with compartment/voxel number as x axis,
value as y axis, and run through a series of frames for different
time-points durign simulation.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>ymin: Double. Optional. Minimum value for y axis. Default = 0.</p></li>
<li><p>ymax: Double. Optional. Maximum value for y axis. Default = 0.
If ymin==ymax then the plot autoscales.</p></li>
<li><p>saveFile: string. Optional. File in which to save plot contents.
Default = &quot;&quot;, to
indicate that the file is not saved. Currently it can save in <em>csv</em> and
<em>xml</em> formats. <em>nsdf</em> will be implemented soon.</p></li>
<li><p>show: Bool. Optional. Flag to decide if the plot should be displayed.
Default=True.</p></li>
</ul>
</dd>
</dl>
<p>Rdesigneur also supports keyword-based argument lists for the plotList, having
the same entries as above. Here are two plotList entries with identical
outcomes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="s1">&#39;Soma membrane potential&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="n">rd</span><span class="o">.</span><span class="n">rplot</span><span class="p">(</span> <span class="n">field</span><span class="o">=</span><span class="s1">&#39;Vm&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span> <span class="s1">&#39;Soma membrane potential&#39;</span><span class="p">)],</span>
</pre></div>
</div>
</section>
<section id="mooglist">
<h3><a class="toc-backref" href="#id106">moogList</a><a class="headerlink" href="#mooglist" title="Permalink to this heading">¶</a></h3>
<p>Type: List of lists</p>
<p>Default: [] (empty list). Does nothing.</p>
<p>Use: This displays a 3-D plot of cellular activity.
Each entry is a list as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">path</span><span class="p">,</span> <span class="n">geom_expr</span><span class="p">,</span> <span class="n">relpath</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="p">[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]]</span>
</pre></div>
</div>
<dl class="simple">
<dt>The entries here are:</dt><dd><ul class="simple">
<li><p>path: string. The usual MOOSE wildcard path to identify electrical
compartments
over which the display will be sampled. Note that the stimulus may be to
a chemical entity, but the spatial location is specified in terms of
the electrical compartments in which the chemical system is embedded.</p></li>
<li><p>geom_expr: string. This is the <a class="reference internal" href="#usual-function">usual function</a> of geometrical
properties of the cell. If it is non-zero, then the stimulus will apply.
There is a special case for synaptic inputs in which the <em>geometry_expr</em>
is repaced with the synaptic weight, recorded as a string.</p></li>
<li><p>replath: string. Relative path to object whose value is being monitored.</p></li>
<li><p>field: string. The field to monitor on the source object.</p></li>
<li><p>title: Title string for the generated display.</p></li>
<li><p>ymin: Double. Minimum value for y axis. Default = 0.</p></li>
<li><p>ymax: Double. Maximum value for y axis. Default = 0.
If ymin==ymax then the plot autoscales.</p></li>
<li><p>show: Bool. Flag to decide if it should be displayed. Default=True.</p></li>
</ul>
</dd>
</dl>
<p>Rdesigneur also supports keyword-based argument lists for the moogList, having
the same entries as above. Here are two moogList entries with identical
outcomes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;soma&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;dend/a&#39;</span><span class="p">,</span> <span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="s1">&#39;a Conc&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">600</span> <span class="p">],</span>
<span class="p">[</span><span class="n">rd</span><span class="o">.</span><span class="n">rmoog</span><span class="p">(</span><span class="n">relpath</span><span class="o">=</span><span class="s1">&#39;dend/a&#39;</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">&#39;conc&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;a Conc&#39;</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">600</span><span class="p">)]</span>
</pre></div>
</div>
<p>To run and display moogli, one replaces the <em>moose.start()</em> and the
<em>rdes.display()</em> functions with the line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rdes</span><span class="o">.</span><span class="n">displayMoogli</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">runtime</span><span class="p">,</span> <span class="n">rotation</span><span class="p">,</span> <span class="n">fullscreen</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">azim</span><span class="p">,</span> <span class="n">elev</span><span class="p">)</span>
</pre></div>
</div>
<p>in which the first two arguments are required and the rest are optional and
can be assigned by keywords.</p>
<p>The arguments are as follows:</p>
<blockquote>
<div><ul class="simple">
<li><p>dt: double. Time interval between frames on the moogli display</p></li>
<li><p>runtime: double. Simulation runtime.</p></li>
<li><p>rotation: double. How much to rotate the display per frame.
Defaults to pi/500.</p></li>
<li><p>fullscreen: bool. Flag to do display on the full screen.
Defaults to False.</p></li>
<li><p>azim: double. Azimuth setting. Defaults to 0.0</p></li>
<li><p>elev: double. Elevation setting. Defaults to 0.0</p></li>
</ul>
</div></blockquote>
<p>The <a class="reference internal" href="#moogli-primer">moogli primer</a> explains how to use the 3-D display.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index_rd.html" class="btn btn-neutral float-left" title="Rdesignuer" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="multi_rdes.html" class="btn btn-neutral float-right" title="Rdesigneur Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Upinder Bhalla, Niraj Dudani, Subhasis Ray, Aditya Gilra,Harsha Rani, Aviral Goel, Dilawar Singh,Malav Shah, Dhruva Gowda Storz.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>