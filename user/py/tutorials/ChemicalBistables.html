<!DOCTYPE html>
<html class="writer-html5" lang="English" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chemical Bistables &mdash; MOOSE Jhangri (4.1.0 rc) documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Chemical Oscillators" href="ChemicalOscillators.html" />
    <link rel="prev" title="Teaching Tutorials" href="index_tut.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> MOOSE
            <img src="../../../_static/moose_logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                4.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../beginner.html">Beginner Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../intermediate.html">Intermediate Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../introduction/index_introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cookbook/index_ckbk.html">Cook Book</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rdesigneur/index_rd.html">Rdesignuer</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index_tut.html">Teaching Tutorials</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Chemical Bistables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#simple-bistables">Simple Bistables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scale-volumes">Scale Volumes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#strong-bistable-system">Strong Bistable System</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mapk-feedback-model">MAPK Feedback Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#propogation-of-a-bistable-system">Propogation of a Bistable System</a></li>
<li class="toctree-l4"><a class="reference internal" href="#steady-state-finder">Steady-state Finder</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dose-response-under-construction">Dose Response (Under construction)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ChemicalOscillators.html">Chemical Oscillators</a></li>
<li class="toctree-l3"><a class="reference internal" href="Squid.html">Squid giant axon</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../advanced.html">Advanced Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">MOOSE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../beginner.html">Beginner Guide</a> &raquo;</li>
          <li><a href="index_tut.html">Teaching Tutorials</a> &raquo;</li>
      <li>Chemical Bistables</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/user/py/tutorials/ChemicalBistables.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="chemical-bistables">
<h1>Chemical Bistables<a class="headerlink" href="#chemical-bistables" title="Permalink to this heading">¶</a></h1>
<p>A <a class="reference external" href="https://en.wikipedia.org/wiki/Bistability">bistable system</a> is a dynamic system that has two stable equilibrium states. The following examples can be used to teach and demonstrate different aspects of bistable systems or to learn how to model them using moose. Each example contains a short description, the model's code, and the output with default settings.</p>
<p>Each example can be found as a python file within the main moose folder under</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">/</span><span class="n">moose</span><span class="o">/</span><span class="n">moose</span><span class="o">-</span><span class="n">examples</span><span class="o">/</span><span class="n">tutorials</span><span class="o">/</span><span class="n">ChemicalBistables</span>
</pre></div>
</div>
<p>In order to run the example, run the script</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">filename</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>in command line, where <code class="docutils literal notranslate"><span class="pre">filename.py</span></code> is the name of the python file you would like to run. The filenames of each example are written in <strong>bold</strong> at the beginning of their respective sections, and the files themselves can be found in the aformentioned directory.</p>
<p>In chemical bistable models that use solvers, there are optional arguments that allow you to specify which solver you would like to use.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">filename</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="n">gsl</span> <span class="o">|</span> <span class="n">gssa</span> <span class="o">|</span> <span class="n">ee</span><span class="p">]</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p>gsl: This is the Runge-Kutta-Fehlberg implementation from the GNU Scientific Library (GSL). It is a fifth order variable timestep explicit method. Works well for most reaction systems except if they have very stiff reactions.</p></li>
<li><p>gssl: Optimized Gillespie stochastic systems algorithm, custom implementation. This uses variable timesteps internally. Note that it slows down with increasing numbers of molecules in each pool. It also slows down, but not so badly, if the number of reactions goes up.</p></li>
<li><p>Exponential Euler:This methods computes the solution of partial and ordinary differential equations.</p></li>
</ul>
</div></blockquote>
<p>All the following examples can be run with either of the three solvers, each of which has different advantages and disadvantages and each of which might produce a slightly different outcome.</p>
<p>Simply running the file without the optional argument will by default use the <code class="docutils literal notranslate"><span class="pre">gsl</span></code> solver. These <code class="docutils literal notranslate"><span class="pre">gsl</span></code> outputs are the ones shown below.</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<section id="simple-bistables">
<h2>Simple Bistables<a class="headerlink" href="#simple-bistables" title="Permalink to this heading">¶</a></h2>
<p>Filename: <strong>simpleBis.py</strong></p>
<p>This example shows the key property of a chemical bistable system: it
has two stable states. Here we start out with the system settling rather
quickly to the first stable state, where molecule A is high (blue) and
the complementary molecule B (green) is low. At t = 100s, we deliver a
perturbation, which is to move 90% of the A molecules into B. This
triggers a state flip, which settles into a distinct stable state where
there is more of B than of A. At t = 200s we reverse the flip by moving
99% of B molecules back to A.</p>
<p>If we run the simulation with the gssa option python simpleBis.py gssa</p>
<p>we see exactly the same sequence of events, except now the switch is
noisy. The calculations are now run with the Gillespie Stochastic
Systems Algorithm (gssa) which incorporates probabilistic reaction
events. The switch still switches but one can see that it might flip
spontaneously once in a while.</p>
<p>Things to do:</p>
<p>1. Open a copy of the script file in an editor, and around
line 124 and 129 you will see how the state flip is implemented while
maintaining mass conservation. What happens if you flip over fewer
molecules? What is the threshold for a successful flip? Why are these
thresholds different for the different states?</p>
<ol class="arabic simple" start="2">
<li><p>Try different volumes in line 31, and rerun using the gssa. Will you
see more or less noise if you increase the volume to 1e-20 m^3?</p></li>
</ol>
<p><strong>Code:</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById('hiddencodeblock10'))">Show/Hide code</a><br /><div id="hiddencodeblock10" style="display: none"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1">#########################################################################</span>
<span class="linenos">  2</span><span class="c1">## This program is part of &#39;MOOSE&#39;, the</span>
<span class="linenos">  3</span><span class="c1">## Messaging Object Oriented Simulation Environment.</span>
<span class="linenos">  4</span><span class="c1">##           Copyright (C) 2013 Upinder S. Bhalla. and NCBS</span>
<span class="linenos">  5</span><span class="c1">## It is made available under the terms of the</span>
<span class="linenos">  6</span><span class="c1">## GNU Lesser General Public License version 2.1</span>
<span class="linenos">  7</span><span class="c1">## See the file COPYING.LIB for the full notice.</span>
<span class="linenos">  8</span><span class="c1">#########################################################################</span>
<span class="linenos">  9</span>
<span class="linenos"> 10</span><span class="c1"># This example illustrates how to set up a kinetic solver and kinetic model</span>
<span class="linenos"> 11</span><span class="c1"># using the scripting interface. Normally this would be done using the</span>
<span class="linenos"> 12</span><span class="c1"># Shell::doLoadModel command, and normally would be coordinated by the</span>
<span class="linenos"> 13</span><span class="c1"># SimManager as the base of the entire model.</span>
<span class="linenos"> 14</span><span class="c1"># This example creates a bistable model having two enzymes and a reaction.</span>
<span class="linenos"> 15</span><span class="c1"># One of the enzymes is autocatalytic.</span>
<span class="linenos"> 16</span><span class="c1"># The model is set up to run using deterministic integration.</span>
<span class="linenos"> 17</span><span class="c1"># If you pass in the argument &#39;gssa&#39; it will run with the stochastic</span>
<span class="linenos"> 18</span><span class="c1"># solver instead</span>
<span class="linenos"> 19</span><span class="c1"># You may also find it interesting to change the volume.</span>
<span class="linenos"> 20</span>
<span class="linenos"> 21</span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="linenos"> 22</span><span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="linenos"> 23</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<span class="linenos"> 24</span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="linenos"> 25</span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="linenos"> 26</span>
<span class="linenos"> 27</span><span class="k">def</span><span class="w"> </span><span class="nf">makeModel</span><span class="p">():</span>
<span class="linenos"> 28</span>                <span class="c1"># create container for model</span>
<span class="linenos"> 29</span>                <span class="n">model</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Neutral</span><span class="p">(</span> <span class="s1">&#39;model&#39;</span> <span class="p">)</span>
<span class="linenos"> 30</span>                <span class="n">compartment</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">CubeMesh</span><span class="p">(</span> <span class="s1">&#39;/model/compartment&#39;</span> <span class="p">)</span>
<span class="linenos"> 31</span>                <span class="n">compartment</span><span class="o">.</span><span class="n">volume</span> <span class="o">=</span> <span class="mf">1e-21</span> <span class="c1"># m^3</span>
<span class="linenos"> 32</span>                <span class="c1"># the mesh is created automatically by the compartment</span>
<span class="linenos"> 33</span>                <span class="n">mesh</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/mesh&#39;</span> <span class="p">)</span>
<span class="linenos"> 34</span>
<span class="linenos"> 35</span>                <span class="c1"># create molecules and reactions</span>
<span class="linenos"> 36</span>                <span class="n">a</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/a&#39;</span> <span class="p">)</span>
<span class="linenos"> 37</span>                <span class="n">b</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/b&#39;</span> <span class="p">)</span>
<span class="linenos"> 38</span>                <span class="n">c</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/c&#39;</span> <span class="p">)</span>
<span class="linenos"> 39</span>                <span class="n">enz1</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Enz</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/b/enz1&#39;</span> <span class="p">)</span>
<span class="linenos"> 40</span>                <span class="n">enz2</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Enz</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/c/enz2&#39;</span> <span class="p">)</span>
<span class="linenos"> 41</span>                <span class="n">cplx1</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/b/enz1/cplx&#39;</span> <span class="p">)</span>
<span class="linenos"> 42</span>                <span class="n">cplx2</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/c/enz2/cplx&#39;</span> <span class="p">)</span>
<span class="linenos"> 43</span>                <span class="n">reac</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Reac</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 44</span>
<span class="linenos"> 45</span>                <span class="c1"># connect them up for reactions</span>
<span class="linenos"> 46</span>                <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz1</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 47</span>                <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz1</span><span class="p">,</span> <span class="s1">&#39;prd&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 48</span>                <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz1</span><span class="p">,</span> <span class="s1">&#39;enz&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 49</span>                <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz1</span><span class="p">,</span> <span class="s1">&#39;cplx&#39;</span><span class="p">,</span> <span class="n">cplx1</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>                <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz2</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 52</span>                <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz2</span><span class="p">,</span> <span class="s1">&#39;prd&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 53</span>                <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz2</span><span class="p">,</span> <span class="s1">&#39;enz&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 54</span>                <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz2</span><span class="p">,</span> <span class="s1">&#39;cplx&#39;</span><span class="p">,</span> <span class="n">cplx2</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 55</span>
<span class="linenos"> 56</span>                <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">reac</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 57</span>                <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">reac</span><span class="p">,</span> <span class="s1">&#39;prd&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 58</span>
<span class="linenos"> 59</span>                <span class="c1"># connect them up to the compartment for volumes</span>
<span class="linenos"> 60</span>                <span class="c1">#for x in ( a, b, c, cplx1, cplx2 ):</span>
<span class="linenos"> 61</span>                <span class="c1">#                        moose.connect( x, &#39;mesh&#39;, mesh, &#39;mesh&#39; )</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>                <span class="c1"># Assign parameters</span>
<span class="linenos"> 64</span>                <span class="n">a</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos"> 65</span>                <span class="n">b</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 66</span>                <span class="n">c</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="linenos"> 67</span>                <span class="n">enz1</span><span class="o">.</span><span class="n">kcat</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="linenos"> 68</span>                <span class="n">enz1</span><span class="o">.</span><span class="n">Km</span> <span class="o">=</span> <span class="mi">4</span>
<span class="linenos"> 69</span>                <span class="n">enz2</span><span class="o">.</span><span class="n">kcat</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="linenos"> 70</span>                <span class="n">enz2</span><span class="o">.</span><span class="n">Km</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="linenos"> 71</span>                <span class="n">reac</span><span class="o">.</span><span class="n">Kf</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="linenos"> 72</span>                <span class="n">reac</span><span class="o">.</span><span class="n">Kb</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="linenos"> 73</span>
<span class="linenos"> 74</span>                <span class="c1"># Create the output tables</span>
<span class="linenos"> 75</span>                <span class="n">graphs</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Neutral</span><span class="p">(</span> <span class="s1">&#39;/model/graphs&#39;</span> <span class="p">)</span>
<span class="linenos"> 76</span>                <span class="n">outputA</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Table</span> <span class="p">(</span> <span class="s1">&#39;/model/graphs/concA&#39;</span> <span class="p">)</span>
<span class="linenos"> 77</span>                <span class="n">outputB</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Table</span> <span class="p">(</span> <span class="s1">&#39;/model/graphs/concB&#39;</span> <span class="p">)</span>
<span class="linenos"> 78</span>
<span class="linenos"> 79</span>                <span class="c1"># connect up the tables</span>
<span class="linenos"> 80</span>                <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">outputA</span><span class="p">,</span> <span class="s1">&#39;requestOut&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;getConc&#39;</span> <span class="p">);</span>
<span class="linenos"> 81</span>                <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">outputB</span><span class="p">,</span> <span class="s1">&#39;requestOut&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;getConc&#39;</span> <span class="p">);</span>
<span class="linenos"> 82</span>
<span class="linenos"> 83</span>                <span class="c1"># Schedule the whole lot</span>
<span class="linenos"> 84</span>                <span class="n">moose</span><span class="o">.</span><span class="n">setClock</span><span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.01</span> <span class="p">)</span> <span class="c1"># for the computational objects</span>
<span class="linenos"> 85</span>                <span class="n">moose</span><span class="o">.</span><span class="n">setClock</span><span class="p">(</span> <span class="mi">8</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">)</span> <span class="c1"># for the plots</span>
<span class="linenos"> 86</span>                <span class="c1"># The wildcard uses # for single level, and ## for recursive.</span>
<span class="linenos"> 87</span>                <span class="n">moose</span><span class="o">.</span><span class="n">useClock</span><span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;/model/compartment/##&#39;</span><span class="p">,</span> <span class="s1">&#39;process&#39;</span> <span class="p">)</span>
<span class="linenos"> 88</span>                <span class="n">moose</span><span class="o">.</span><span class="n">useClock</span><span class="p">(</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;/model/graphs/#&#39;</span><span class="p">,</span> <span class="s1">&#39;process&#39;</span> <span class="p">)</span>
<span class="linenos"> 89</span>
<span class="linenos"> 90</span><span class="k">def</span><span class="w"> </span><span class="nf">displayPlots</span><span class="p">():</span>
<span class="linenos"> 91</span>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">moose</span><span class="o">.</span><span class="n">wildcardFind</span><span class="p">(</span> <span class="s1">&#39;/model/graphs/conc#&#39;</span> <span class="p">):</span>
<span class="linenos"> 92</span>                                <span class="n">t</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span> <span class="c1">#sec</span>
<span class="linenos"> 93</span>                                <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">vector</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
<span class="linenos"> 94</span>                <span class="n">pylab</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="linenos"> 95</span>                <span class="n">pylab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="linenos"> 96</span>
<span class="linenos"> 97</span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="linenos"> 98</span>                <span class="n">solver</span> <span class="o">=</span> <span class="s2">&quot;gsl&quot;</span>
<span class="linenos"> 99</span>                <span class="n">makeModel</span><span class="p">()</span>
<span class="linenos">100</span>                <span class="k">if</span> <span class="p">(</span> <span class="nb">len</span> <span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">):</span>
<span class="linenos">101</span>                    <span class="n">solver</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos">102</span>                <span class="n">stoich</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Stoich</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/stoich&#39;</span> <span class="p">)</span>
<span class="linenos">103</span>                <span class="n">stoich</span><span class="o">.</span><span class="n">compartment</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/compartment&#39;</span> <span class="p">)</span>
<span class="linenos">104</span>                <span class="k">if</span> <span class="p">(</span> <span class="n">solver</span> <span class="o">==</span> <span class="s1">&#39;gssa&#39;</span> <span class="p">):</span>
<span class="linenos">105</span>                    <span class="n">gsolve</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Gsolve</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/ksolve&#39;</span> <span class="p">)</span>
<span class="linenos">106</span>                    <span class="n">stoich</span><span class="o">.</span><span class="n">ksolve</span> <span class="o">=</span> <span class="n">gsolve</span>
<span class="linenos">107</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">108</span>                    <span class="n">ksolve</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Ksolve</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/ksolve&#39;</span> <span class="p">)</span>
<span class="linenos">109</span>                    <span class="n">stoich</span><span class="o">.</span><span class="n">ksolve</span> <span class="o">=</span> <span class="n">ksolve</span>
<span class="linenos">110</span>                <span class="n">stoich</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/model/compartment/##&quot;</span>
<span class="linenos">111</span>                <span class="c1">#solver.method = &quot;rk5&quot;</span>
<span class="linenos">112</span>                <span class="c1">#mesh = moose.element( &quot;/model/compartment/mesh&quot; )</span>
<span class="linenos">113</span>                <span class="c1">#moose.connect( mesh, &quot;remesh&quot;, solver, &quot;remesh&quot; )</span>
<span class="linenos">114</span>                <span class="n">moose</span><span class="o">.</span><span class="n">setClock</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">)</span> <span class="c1"># clock for the solver</span>
<span class="linenos">115</span>                <span class="n">moose</span><span class="o">.</span><span class="n">useClock</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;/model/compartment/ksolve&#39;</span><span class="p">,</span> <span class="s1">&#39;process&#39;</span> <span class="p">)</span>
<span class="linenos">116</span>
<span class="linenos">117</span>                <span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="linenos">118</span>                <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mf">100.0</span> <span class="p">)</span> <span class="c1"># Run the model for 100 seconds.</span>
<span class="linenos">119</span>
<span class="linenos">120</span>                <span class="n">a</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/a&#39;</span> <span class="p">)</span>
<span class="linenos">121</span>                <span class="n">b</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/b&#39;</span> <span class="p">)</span>
<span class="linenos">122</span>
<span class="linenos">123</span>                <span class="c1"># move most molecules over to b</span>
<span class="linenos">124</span>                <span class="n">b</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">conc</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">conc</span> <span class="o">*</span> <span class="mf">0.9</span>
<span class="linenos">125</span>                <span class="n">a</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">conc</span> <span class="o">*</span> <span class="mf">0.1</span>
<span class="linenos">126</span>                <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mf">100.0</span> <span class="p">)</span> <span class="c1"># Run the model for 100 seconds.</span>
<span class="linenos">127</span>
<span class="linenos">128</span>                <span class="c1"># move most molecules back to a</span>
<span class="linenos">129</span>                <span class="n">a</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">conc</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">conc</span> <span class="o">*</span> <span class="mf">0.99</span>
<span class="linenos">130</span>                <span class="n">b</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">conc</span> <span class="o">*</span> <span class="mf">0.01</span>
<span class="linenos">131</span>                <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mf">100.0</span> <span class="p">)</span> <span class="c1"># Run the model for 100 seconds.</span>
<span class="linenos">132</span>
<span class="linenos">133</span>                <span class="c1"># Iterate through all plots, dump their contents to data.plot.</span>
<span class="linenos">134</span>                <span class="n">displayPlots</span><span class="p">()</span>
<span class="linenos">135</span>
<span class="linenos">136</span>                <span class="n">quit</span><span class="p">()</span>
<span class="linenos">137</span>
<span class="linenos">138</span><span class="c1"># Run the &#39;main&#39; if this script is executed standalone.</span>
<span class="linenos">139</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">140</span>        <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div><div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Output:</strong></p>
<img alt="../../../_images/simpleB.png" src="../../../_images/simpleB.png" />
</section>
<section id="scale-volumes">
<h2>Scale Volumes<a class="headerlink" href="#scale-volumes" title="Permalink to this heading">¶</a></h2>
<p>File name: <strong>scaleVolumes.py</strong></p>
<p>This script runs exactly the same model as in simpleBis.py, but it
automatically scales the volumes from 1e-19 down to smaller values.</p>
<p>Note how the simulation successively becomes noisier, until at very
small volumes there are spontaneous state transitions.</p>
<p><strong>Code:</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById('hiddencodeblock11'))">Show/Hide code</a><br /><div id="hiddencodeblock11" style="display: none"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1">#########################################################################</span>
<span class="linenos">  2</span><span class="c1">## This program is part of &#39;MOOSE&#39;, the</span>
<span class="linenos">  3</span><span class="c1">## Messaging Object Oriented Simulation Environment.</span>
<span class="linenos">  4</span><span class="c1">##           Copyright (C) 2013 Upinder S. Bhalla. and NCBS</span>
<span class="linenos">  5</span><span class="c1">## It is made available under the terms of the</span>
<span class="linenos">  6</span><span class="c1">## GNU Lesser General Public License version 2.1</span>
<span class="linenos">  7</span><span class="c1">## See the file COPYING.LIB for the full notice.</span>
<span class="linenos">  8</span><span class="c1">#########################################################################</span>
<span class="linenos">  9</span>
<span class="linenos"> 10</span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="linenos"> 11</span><span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="linenos"> 12</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<span class="linenos"> 13</span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="linenos"> 14</span>
<span class="linenos"> 15</span><span class="k">def</span><span class="w"> </span><span class="nf">makeModel</span><span class="p">():</span>
<span class="linenos"> 16</span>            <span class="c1"># create container for model</span>
<span class="linenos"> 17</span>            <span class="n">model</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Neutral</span><span class="p">(</span> <span class="s1">&#39;model&#39;</span> <span class="p">)</span>
<span class="linenos"> 18</span>            <span class="n">compartment</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">CubeMesh</span><span class="p">(</span> <span class="s1">&#39;/model/compartment&#39;</span> <span class="p">)</span>
<span class="linenos"> 19</span>            <span class="n">compartment</span><span class="o">.</span><span class="n">volume</span> <span class="o">=</span> <span class="mf">1e-20</span>
<span class="linenos"> 20</span>            <span class="c1"># the mesh is created automatically by the compartment</span>
<span class="linenos"> 21</span>            <span class="n">mesh</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/mesh&#39;</span> <span class="p">)</span>
<span class="linenos"> 22</span>
<span class="linenos"> 23</span>            <span class="c1"># create molecules and reactions</span>
<span class="linenos"> 24</span>            <span class="n">a</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/a&#39;</span> <span class="p">)</span>
<span class="linenos"> 25</span>            <span class="n">b</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/b&#39;</span> <span class="p">)</span>
<span class="linenos"> 26</span>            <span class="n">c</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/c&#39;</span> <span class="p">)</span>
<span class="linenos"> 27</span>            <span class="n">enz1</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Enz</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/b/enz1&#39;</span> <span class="p">)</span>
<span class="linenos"> 28</span>            <span class="n">enz2</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Enz</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/c/enz2&#39;</span> <span class="p">)</span>
<span class="linenos"> 29</span>            <span class="n">cplx1</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/b/enz1/cplx&#39;</span> <span class="p">)</span>
<span class="linenos"> 30</span>            <span class="n">cplx2</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/c/enz2/cplx&#39;</span> <span class="p">)</span>
<span class="linenos"> 31</span>            <span class="n">reac</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Reac</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span>            <span class="c1"># connect them up for reactions</span>
<span class="linenos"> 34</span>            <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz1</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 35</span>            <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz1</span><span class="p">,</span> <span class="s1">&#39;prd&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 36</span>            <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz1</span><span class="p">,</span> <span class="s1">&#39;enz&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 37</span>            <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz1</span><span class="p">,</span> <span class="s1">&#39;cplx&#39;</span><span class="p">,</span> <span class="n">cplx1</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 38</span>
<span class="linenos"> 39</span>            <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz2</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 40</span>            <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz2</span><span class="p">,</span> <span class="s1">&#39;prd&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 41</span>            <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz2</span><span class="p">,</span> <span class="s1">&#39;enz&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 42</span>            <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz2</span><span class="p">,</span> <span class="s1">&#39;cplx&#39;</span><span class="p">,</span> <span class="n">cplx2</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span>            <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">reac</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 45</span>            <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">reac</span><span class="p">,</span> <span class="s1">&#39;prd&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos"> 46</span>
<span class="linenos"> 47</span>            <span class="c1"># connect them up to the compartment for volumes</span>
<span class="linenos"> 48</span>            <span class="c1">#for x in ( a, b, c, cplx1, cplx2 ):</span>
<span class="linenos"> 49</span>            <span class="c1">#                       moose.connect( x, &#39;mesh&#39;, mesh, &#39;mesh&#39; )</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>            <span class="c1"># Assign parameters</span>
<span class="linenos"> 52</span>            <span class="n">a</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos"> 53</span>            <span class="n">b</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 54</span>            <span class="n">c</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="linenos"> 55</span>            <span class="n">enz1</span><span class="o">.</span><span class="n">kcat</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="linenos"> 56</span>            <span class="n">enz1</span><span class="o">.</span><span class="n">Km</span> <span class="o">=</span> <span class="mi">4</span>
<span class="linenos"> 57</span>            <span class="n">enz2</span><span class="o">.</span><span class="n">kcat</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="linenos"> 58</span>            <span class="n">enz2</span><span class="o">.</span><span class="n">Km</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="linenos"> 59</span>            <span class="n">reac</span><span class="o">.</span><span class="n">Kf</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="linenos"> 60</span>            <span class="n">reac</span><span class="o">.</span><span class="n">Kb</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="linenos"> 61</span>
<span class="linenos"> 62</span>            <span class="c1"># Create the output tables</span>
<span class="linenos"> 63</span>            <span class="n">graphs</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Neutral</span><span class="p">(</span> <span class="s1">&#39;/model/graphs&#39;</span> <span class="p">)</span>
<span class="linenos"> 64</span>            <span class="n">outputA</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Table</span> <span class="p">(</span> <span class="s1">&#39;/model/graphs/concA&#39;</span> <span class="p">)</span>
<span class="linenos"> 65</span>            <span class="n">outputB</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Table</span> <span class="p">(</span> <span class="s1">&#39;/model/graphs/concB&#39;</span> <span class="p">)</span>
<span class="linenos"> 66</span>
<span class="linenos"> 67</span>            <span class="c1"># connect up the tables</span>
<span class="linenos"> 68</span>            <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">outputA</span><span class="p">,</span> <span class="s1">&#39;requestOut&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;getConc&#39;</span> <span class="p">);</span>
<span class="linenos"> 69</span>            <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">outputB</span><span class="p">,</span> <span class="s1">&#39;requestOut&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;getConc&#39;</span> <span class="p">);</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span>            <span class="c1"># Schedule the whole lot</span>
<span class="linenos"> 72</span>            <span class="n">moose</span><span class="o">.</span><span class="n">setClock</span><span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.01</span> <span class="p">)</span> <span class="c1"># for the computational objects</span>
<span class="linenos"> 73</span>            <span class="n">moose</span><span class="o">.</span><span class="n">setClock</span><span class="p">(</span> <span class="mi">8</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">)</span> <span class="c1"># for the plots</span>
<span class="linenos"> 74</span>            <span class="c1"># The wildcard uses # for single level, and ## for recursive.</span>
<span class="linenos"> 75</span>            <span class="n">moose</span><span class="o">.</span><span class="n">useClock</span><span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;/model/compartment/##&#39;</span><span class="p">,</span> <span class="s1">&#39;process&#39;</span> <span class="p">)</span>
<span class="linenos"> 76</span>            <span class="n">moose</span><span class="o">.</span><span class="n">useClock</span><span class="p">(</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;/model/graphs/#&#39;</span><span class="p">,</span> <span class="s1">&#39;process&#39;</span> <span class="p">)</span>
<span class="linenos"> 77</span>
<span class="linenos"> 78</span><span class="k">def</span><span class="w"> </span><span class="nf">displayPlots</span><span class="p">():</span>
<span class="linenos"> 79</span>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">moose</span><span class="o">.</span><span class="n">wildcardFind</span><span class="p">(</span> <span class="s1">&#39;/model/graphs/conc#&#39;</span> <span class="p">):</span>
<span class="linenos"> 80</span>                            <span class="n">t</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span> <span class="c1">#sec</span>
<span class="linenos"> 81</span>                            <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">vector</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
<span class="linenos"> 82</span>
<span class="linenos"> 83</span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="linenos"> 84</span>
<span class="linenos"> 85</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 86</span><span class="sd">    This example illustrates how to run a model at different volumes.</span>
<span class="linenos"> 87</span><span class="sd">    The key line is just to set the volume of the compartment::</span>
<span class="linenos"> 88</span>
<span class="linenos"> 89</span><span class="sd">        compt.volume = vol</span>
<span class="linenos"> 90</span>
<span class="linenos"> 91</span><span class="sd">    If everything</span>
<span class="linenos"> 92</span><span class="sd">    else is set up correctly, then this change propagates through to all</span>
<span class="linenos"> 93</span><span class="sd">    reactions molecules.</span>
<span class="linenos"> 94</span>
<span class="linenos"> 95</span><span class="sd">    For a deterministic reaction one would not see any change in output</span>
<span class="linenos"> 96</span><span class="sd">    concentrations.</span>
<span class="linenos"> 97</span><span class="sd">    For a stochastic reaction illustrated here, one sees the level of</span>
<span class="linenos"> 98</span><span class="sd">    &#39;noise&#39;</span>
<span class="linenos"> 99</span><span class="sd">    changing, even though the concentrations are similar up to a point.</span>
<span class="linenos">100</span><span class="sd">    This example creates a bistable model having two enzymes and a reaction.</span>
<span class="linenos">101</span><span class="sd">    One of the enzymes is autocatalytic.</span>
<span class="linenos">102</span><span class="sd">    This model is set up within the script rather than using an external</span>
<span class="linenos">103</span><span class="sd">    file.</span>
<span class="linenos">104</span><span class="sd">    The model is set up to run using the GSSA (Gillespie Stocahstic systems</span>
<span class="linenos">105</span><span class="sd">    algorithim) method in MOOSE.</span>
<span class="linenos">106</span>
<span class="linenos">107</span><span class="sd">    To run the example, run the script</span>
<span class="linenos">108</span>
<span class="linenos">109</span><span class="sd">        ``python scaleVolumes.py``</span>
<span class="linenos">110</span>
<span class="linenos">111</span><span class="sd">    and close the plots every cycle to see the outcome of stochastic</span>
<span class="linenos">112</span><span class="sd">    calculations at ever smaller volumes, keeping concentrations the same.</span>
<span class="linenos">113</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">114</span>    <span class="n">makeModel</span><span class="p">()</span>
<span class="linenos">115</span>    <span class="n">moose</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span> <span class="mi">11111</span> <span class="p">)</span>
<span class="linenos">116</span>    <span class="n">gsolve</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Gsolve</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/gsolve&#39;</span> <span class="p">)</span>
<span class="linenos">117</span>    <span class="n">stoich</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Stoich</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/stoich&#39;</span> <span class="p">)</span>
<span class="linenos">118</span>    <span class="n">compt</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/compartment&#39;</span> <span class="p">);</span>
<span class="linenos">119</span>    <span class="n">stoich</span><span class="o">.</span><span class="n">compartment</span> <span class="o">=</span> <span class="n">compt</span>
<span class="linenos">120</span>    <span class="n">stoich</span><span class="o">.</span><span class="n">ksolve</span> <span class="o">=</span> <span class="n">gsolve</span>
<span class="linenos">121</span>    <span class="n">stoich</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/model/compartment/##&quot;</span>
<span class="linenos">122</span>    <span class="n">moose</span><span class="o">.</span><span class="n">setClock</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">)</span> <span class="c1"># clock for the solver</span>
<span class="linenos">123</span>    <span class="n">moose</span><span class="o">.</span><span class="n">useClock</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;/model/compartment/gsolve&#39;</span><span class="p">,</span> <span class="s1">&#39;process&#39;</span> <span class="p">)</span>
<span class="linenos">124</span>    <span class="n">a</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/a&#39;</span> <span class="p">)</span>
<span class="linenos">125</span>
<span class="linenos">126</span>    <span class="k">for</span> <span class="n">vol</span> <span class="ow">in</span> <span class="p">(</span> <span class="mf">1e-19</span><span class="p">,</span> <span class="mf">1e-20</span><span class="p">,</span> <span class="mf">1e-21</span><span class="p">,</span> <span class="mf">3e-22</span><span class="p">,</span> <span class="mf">1e-22</span><span class="p">,</span> <span class="mf">3e-23</span><span class="p">,</span> <span class="mf">1e-23</span> <span class="p">):</span>
<span class="linenos">127</span>        <span class="c1"># Set the volume</span>
<span class="linenos">128</span>        <span class="n">compt</span><span class="o">.</span><span class="n">volume</span> <span class="o">=</span> <span class="n">vol</span>
<span class="linenos">129</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;vol = </span><span class="si">{}</span><span class="s1">, a.concInit = </span><span class="si">{}</span><span class="s1">, a.nInit = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">vol</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">concInit</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">nInit</span><span class="p">))</span>
<span class="linenos">130</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Close graph to go to next plot</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">131</span>
<span class="linenos">132</span>        <span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="linenos">133</span>        <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mf">100.0</span> <span class="p">)</span> <span class="c1"># Run the model for 100 seconds.</span>
<span class="linenos">134</span>
<span class="linenos">135</span>        <span class="n">a</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/a&#39;</span> <span class="p">)</span>
<span class="linenos">136</span>        <span class="n">b</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/b&#39;</span> <span class="p">)</span>
<span class="linenos">137</span>
<span class="linenos">138</span>        <span class="c1"># move most molecules over to b</span>
<span class="linenos">139</span>        <span class="n">b</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">conc</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">conc</span> <span class="o">*</span> <span class="mf">0.9</span>
<span class="linenos">140</span>        <span class="n">a</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">conc</span> <span class="o">*</span> <span class="mf">0.1</span>
<span class="linenos">141</span>        <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mf">100.0</span> <span class="p">)</span> <span class="c1"># Run the model for 100 seconds.</span>
<span class="linenos">142</span>
<span class="linenos">143</span>        <span class="c1"># move most molecules back to a</span>
<span class="linenos">144</span>        <span class="n">a</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">conc</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">conc</span> <span class="o">*</span> <span class="mf">0.99</span>
<span class="linenos">145</span>        <span class="n">b</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">conc</span> <span class="o">*</span> <span class="mf">0.01</span>
<span class="linenos">146</span>        <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mf">100.0</span> <span class="p">)</span> <span class="c1"># Run the model for 100 seconds.</span>
<span class="linenos">147</span>
<span class="linenos">148</span>        <span class="c1"># Iterate through all plots, dump their contents to data.plot.</span>
<span class="linenos">149</span>        <span class="n">displayPlots</span><span class="p">()</span>
<span class="linenos">150</span>        <span class="n">pylab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="linenos">151</span>
<span class="linenos">152</span>    <span class="n">quit</span><span class="p">()</span>
<span class="linenos">153</span>
<span class="linenos">154</span><span class="c1"># Run the &#39;main&#39; if this script is executed standalone.</span>
<span class="linenos">155</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">156</span>    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div><div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vol</span> <span class="o">=</span> <span class="mf">1e-19</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">nInit</span> <span class="o">=</span> <span class="mf">60221.415</span>
</pre></div>
</div>
<img alt="../../../_images/sV1.png" src="../../../_images/sV1.png" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vol</span> <span class="o">=</span> <span class="mf">1e-20</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">nInit</span> <span class="o">=</span> <span class="mf">6022.1415</span>
</pre></div>
</div>
<img alt="../../../_images/sV2.png" src="../../../_images/sV2.png" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vol</span> <span class="o">=</span> <span class="mf">1e-21</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">nInit</span> <span class="o">=</span> <span class="mf">602.21415</span>
</pre></div>
</div>
<img alt="../../../_images/sV3.png" src="../../../_images/sV3.png" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vol</span> <span class="o">=</span> <span class="mf">3e-22</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">nInit</span> <span class="o">=</span> <span class="mf">180.664245</span>
</pre></div>
</div>
<img alt="../../../_images/sV4.png" src="../../../_images/sV4.png" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vol</span> <span class="o">=</span> <span class="mf">1e-22</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">nInit</span> <span class="o">=</span> <span class="mf">60.221415</span>
</pre></div>
</div>
<img alt="../../../_images/sV5.png" src="../../../_images/sV5.png" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vol</span> <span class="o">=</span> <span class="mf">3e-23</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">nInit</span> <span class="o">=</span> <span class="mf">18.0664245</span>
</pre></div>
</div>
<img alt="../../../_images/sV6.png" src="../../../_images/sV6.png" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vol</span> <span class="o">=</span> <span class="mf">1e-23</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">nInit</span> <span class="o">=</span> <span class="mf">6.0221415</span>
</pre></div>
</div>
<img alt="../../../_images/sV7.png" src="../../../_images/sV7.png" />
</section>
<section id="strong-bistable-system">
<h2>Strong Bistable System<a class="headerlink" href="#strong-bistable-system" title="Permalink to this heading">¶</a></h2>
<p>File name: <strong>strongBis.py</strong></p>
<p>This example illustrates a particularly strong, that is, parametrically
robust bistable system. The model topology is symmetric between
molecules <strong>b</strong> and <strong>c</strong>. We have both positive feedback of molecules
<strong>b</strong> and <strong>c</strong> onto themselves, and also inhibition of <strong>b</strong> by <strong>c</strong>
and vice versa.</p>
<img alt="../../../_images/strongBis.png" src="../../../_images/strongBis.png" />
<p>Open the python file to see what is happening. The simulation starts at
a symmetric point and the model settles at precisely the balance point
where <strong>a</strong>, <strong>b</strong>, and <strong>c</strong> are at the same concentration. At t= 100
we apply a small molecular 'tap' to push it over to a state where <strong>c</strong>
is larger. This is stable. At t = 210 we apply a moderate push to show
that it is now very stably in this state, and the system rebounds to its
original levels. At t = 320 we apply a strong push to take it over to a
state where <strong>b</strong> is larger. At t = 430 we give it a strong push to take
it back to the <strong>c</strong> dominant state.</p>
<p><strong>Code:</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById('hiddencodeblock12'))">Show/Hide code</a><br /><div id="hiddencodeblock12" style="display: none"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">#########################################################################</span>
<span class="linenos"> 2</span><span class="c1">## This program is part of &#39;MOOSE&#39;, the</span>
<span class="linenos"> 3</span><span class="c1">## Messaging Object Oriented Simulation Environment.</span>
<span class="linenos"> 4</span><span class="c1">##           Copyright (C) 2014 Upinder S. Bhalla. and NCBS</span>
<span class="linenos"> 5</span><span class="c1">## It is made available under the terms of the</span>
<span class="linenos"> 6</span><span class="c1">## GNU Lesser General Public License version 2.1</span>
<span class="linenos"> 7</span><span class="c1">## See the file COPYING.LIB for the full notice.</span>
<span class="linenos"> 8</span><span class="c1">#########################################################################</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="linenos">11</span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="linenos">12</span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.image</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpimg</span>
<span class="linenos">13</span><span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="linenos">14</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<span class="linenos">15</span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="linenos">18</span>
<span class="linenos">19</span>        <span class="n">solver</span> <span class="o">=</span> <span class="s2">&quot;gsl&quot;</span>  <span class="c1"># Pick any of gsl, gssa, ee..</span>
<span class="linenos">20</span>        <span class="c1">#solver = &quot;gssa&quot;  # Pick any of gsl, gssa, ee..</span>
<span class="linenos">21</span>        <span class="c1">#moose.seed( 1234 ) # Needed if stochastic.</span>
<span class="linenos">22</span>        <span class="n">mfile</span> <span class="o">=</span> <span class="s1">&#39;../../genesis/M1719.g&#39;</span>
<span class="linenos">23</span>        <span class="n">runtime</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="linenos">24</span>        <span class="k">if</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="p">):</span>
<span class="linenos">25</span>                <span class="n">solver</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos">26</span>        <span class="n">modelId</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">loadModel</span><span class="p">(</span> <span class="n">mfile</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">solver</span> <span class="p">)</span>
<span class="linenos">27</span>        <span class="c1"># Increase volume so that the stochastic solver gssa</span>
<span class="linenos">28</span>        <span class="c1"># gives an interesting output</span>
<span class="linenos">29</span>        <span class="n">compt</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics&#39;</span> <span class="p">)</span>
<span class="linenos">30</span>        <span class="n">compt</span><span class="o">.</span><span class="n">volume</span> <span class="o">=</span> <span class="mf">0.2e-19</span>
<span class="linenos">31</span>        <span class="n">r</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics/equil&#39;</span> <span class="p">)</span>
<span class="linenos">32</span>
<span class="linenos">33</span>        <span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="linenos">34</span>        <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="n">runtime</span> <span class="p">)</span>
<span class="linenos">35</span>        <span class="n">r</span><span class="o">.</span><span class="n">Kf</span> <span class="o">*=</span> <span class="mf">1.1</span> <span class="c1"># small tap to break symmetry</span>
<span class="linenos">36</span>        <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="n">runtime</span><span class="o">/</span><span class="mi">10</span> <span class="p">)</span>
<span class="linenos">37</span>        <span class="n">r</span><span class="o">.</span><span class="n">Kf</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">Kb</span>
<span class="linenos">38</span>        <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="n">runtime</span> <span class="p">)</span>
<span class="linenos">39</span>
<span class="linenos">40</span>        <span class="n">r</span><span class="o">.</span><span class="n">Kb</span> <span class="o">*=</span> <span class="mf">2.0</span> <span class="c1"># Moderate push does not tip it back.</span>
<span class="linenos">41</span>        <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="n">runtime</span><span class="o">/</span><span class="mi">10</span> <span class="p">)</span>
<span class="linenos">42</span>        <span class="n">r</span><span class="o">.</span><span class="n">Kb</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">Kf</span>
<span class="linenos">43</span>        <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="n">runtime</span> <span class="p">)</span>
<span class="linenos">44</span>
<span class="linenos">45</span>        <span class="n">r</span><span class="o">.</span><span class="n">Kb</span> <span class="o">*=</span> <span class="mf">5.0</span> <span class="c1"># Strong push does tip it over</span>
<span class="linenos">46</span>        <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="n">runtime</span><span class="o">/</span><span class="mi">10</span> <span class="p">)</span>
<span class="linenos">47</span>        <span class="n">r</span><span class="o">.</span><span class="n">Kb</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">Kf</span>
<span class="linenos">48</span>        <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="n">runtime</span> <span class="p">)</span>
<span class="linenos">49</span>        <span class="n">r</span><span class="o">.</span><span class="n">Kf</span> <span class="o">*=</span> <span class="mf">5.0</span> <span class="c1"># Strong push tips it back.</span>
<span class="linenos">50</span>        <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="n">runtime</span><span class="o">/</span><span class="mi">10</span> <span class="p">)</span>
<span class="linenos">51</span>        <span class="n">r</span><span class="o">.</span><span class="n">Kf</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">Kb</span>
<span class="linenos">52</span>        <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="n">runtime</span> <span class="p">)</span>
<span class="linenos">53</span>
<span class="linenos">54</span>
<span class="linenos">55</span>        <span class="c1"># Display all plots.</span>
<span class="linenos">56</span>        <span class="n">img</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span> <span class="s1">&#39;strongBis.png&#39;</span> <span class="p">)</span>
<span class="linenos">57</span>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span> <span class="p">)</span> <span class="p">)</span>
<span class="linenos">58</span>        <span class="n">png</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span> <span class="mi">211</span> <span class="p">)</span>
<span class="linenos">59</span>        <span class="n">imgplot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span> <span class="n">img</span> <span class="p">)</span>
<span class="linenos">60</span>        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span> <span class="mi">212</span> <span class="p">)</span>
<span class="linenos">61</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">wildcardFind</span><span class="p">(</span> <span class="s1">&#39;/model/#graphs/conc#/#&#39;</span> <span class="p">)</span>
<span class="linenos">62</span>        <span class="n">dt</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/clock&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">tickDt</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span>
<span class="linenos">63</span>        <span class="n">t</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
<span class="linenos">64</span>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
<span class="linenos">65</span>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
<span class="linenos">66</span>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
<span class="linenos">67</span>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span> <span class="s1">&#39;Conc (mM)&#39;</span> <span class="p">)</span>
<span class="linenos">68</span>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span> <span class="s1">&#39;Time (seconds)&#39;</span> <span class="p">)</span>
<span class="linenos">69</span>        <span class="n">pylab</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="linenos">70</span>        <span class="n">pylab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="linenos">71</span>
<span class="linenos">72</span><span class="c1"># Run the &#39;main&#39; if this script is executed standalone.</span>
<span class="linenos">73</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">74</span>        <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div><div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Output:</strong></p>
<img alt="../../../_images/strongB.png" src="../../../_images/strongB.png" />
</section>
<section id="mapk-feedback-model">
<h2>MAPK Feedback Model<a class="headerlink" href="#mapk-feedback-model" title="Permalink to this heading">¶</a></h2>
<p>File name: <strong>mapkFB.py</strong></p>
<p>This example illustrates loading, and running a kinetic model for a much
more complex bistable positive feedback system, defined in kkit format.
This is based on Bhalla, Ram and Iyengar, Science 2002.</p>
<p>The core of this model is a positive feedback loop comprising of the
MAPK cascade, PLA2, and PKC. It receives PDGF and Ca2+ as inputs.</p>
<img alt="../../../_images/mapkFB.png" src="../../../_images/mapkFB.png" />
<p>This model is quite a large one and due to some stiffness in its
equations, it takes about 30 seconds to execute. Note that this is still
200 times faster than the events it models.</p>
<p>The simulation illustrated here shows how the model starts out in a
state of low activity. It is induced to 'turn on' when a a PDGF stimulus
is given for 400 seconds, starting at t = 500s. After it has settled to
the new 'on' state, the model is made to 'turn off' by setting the
system calcium levels to zero. This inhibition starts at t = 2900 and
goes on for 500 s.</p>
<p>Note that this is a somewhat unphysiological manipulation! Following
this the model settles back to the same 'off' state it was in
originally.</p>
<p><strong>Code:</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById('hiddencodeblock13'))">Show/Hide code</a><br /><div id="hiddencodeblock13" style="display: none"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">#########################################################################</span>
<span class="linenos"> 2</span><span class="c1">## This program is part of &#39;MOOSE&#39;, the</span>
<span class="linenos"> 3</span><span class="c1">## Messaging Object Oriented Simulation Environment.</span>
<span class="linenos"> 4</span><span class="c1">##           Copyright (C) 2014 Upinder S. Bhalla. and NCBS</span>
<span class="linenos"> 5</span><span class="c1">## It is made available under the terms of the</span>
<span class="linenos"> 6</span><span class="c1">## GNU Lesser General Public License version 2.1</span>
<span class="linenos"> 7</span><span class="c1">## See the file COPYING.LIB for the full notice.</span>
<span class="linenos"> 8</span><span class="c1">#########################################################################</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="linenos">11</span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="linenos">12</span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.image</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpimg</span>
<span class="linenos">13</span><span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="linenos">14</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<span class="linenos">15</span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="linenos">16</span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="n">scriptDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span> <span class="vm">__file__</span> <span class="p">)</span> <span class="p">)</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="linenos">21</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">22</span><span class="sd">This example illustrates loading, and running a kinetic model</span>
<span class="linenos">23</span><span class="sd">for a bistable positive feedback system, defined in kkit format.</span>
<span class="linenos">24</span><span class="sd">This is based on Bhalla, Ram and Iyengar, Science 2002.</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="sd">The core of this model is a positive feedback loop comprising of</span>
<span class="linenos">27</span><span class="sd">the MAPK cascade, PLA2, and PKC. It receives PDGF and Ca2+ as</span>
<span class="linenos">28</span><span class="sd">inputs.</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="sd">This model is quite a large one and due to some stiffness in its</span>
<span class="linenos">31</span><span class="sd">equations, it runs somewhat slowly.</span>
<span class="linenos">32</span>
<span class="linenos">33</span><span class="sd">The simulation illustrated here shows how the model starts out in</span>
<span class="linenos">34</span><span class="sd">a state of low activity. It is induced to &#39;turn on&#39; when a</span>
<span class="linenos">35</span><span class="sd">a PDGF stimulus is given for 400 seconds.</span>
<span class="linenos">36</span><span class="sd">After it has settled to the new &#39;on&#39; state, model is made to</span>
<span class="linenos">37</span><span class="sd">&#39;turn off&#39;</span>
<span class="linenos">38</span><span class="sd">by setting the system calcium levels to zero for a while. This</span>
<span class="linenos">39</span><span class="sd">is a somewhat unphysiological manipulation!</span>
<span class="linenos">40</span>
<span class="linenos">41</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">42</span>
<span class="linenos">43</span>    <span class="n">solver</span> <span class="o">=</span> <span class="s2">&quot;gsl&quot;</span>  <span class="c1"># Pick any of gsl, gssa, ee..</span>
<span class="linenos">44</span>    <span class="c1">#solver = &quot;gssa&quot;  # Pick any of gsl, gssa, ee..</span>
<span class="linenos">45</span>    <span class="n">mfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">scriptDir</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;genesis&#39;</span> <span class="p">,</span> <span class="s1">&#39;acc35.g&#39;</span> <span class="p">)</span>
<span class="linenos">46</span>    <span class="n">runtime</span> <span class="o">=</span> <span class="mf">2000.0</span>
<span class="linenos">47</span>    <span class="k">if</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">):</span>
<span class="linenos">48</span>        <span class="n">solver</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos">49</span>    <span class="n">modelId</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">loadModel</span><span class="p">(</span> <span class="n">mfile</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">solver</span> <span class="p">)</span>
<span class="linenos">50</span>    <span class="c1"># Increase volume so that the stochastic solver gssa</span>
<span class="linenos">51</span>    <span class="c1"># gives an interesting output</span>
<span class="linenos">52</span>    <span class="n">compt</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics&#39;</span> <span class="p">)</span>
<span class="linenos">53</span>    <span class="n">compt</span><span class="o">.</span><span class="n">volume</span> <span class="o">=</span> <span class="mf">5e-19</span>
<span class="linenos">54</span>
<span class="linenos">55</span>    <span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="linenos">56</span>    <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mi">500</span> <span class="p">)</span>
<span class="linenos">57</span>    <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics/PDGFR/PDGF&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="linenos">58</span>    <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mi">400</span> <span class="p">)</span>
<span class="linenos">59</span>    <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics/PDGFR/PDGF&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos">60</span>    <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mi">2000</span> <span class="p">)</span>
<span class="linenos">61</span>    <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics/Ca&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos">62</span>    <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mi">500</span> <span class="p">)</span>
<span class="linenos">63</span>    <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics/Ca&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mf">0.00008</span>
<span class="linenos">64</span>    <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mi">2000</span> <span class="p">)</span>
<span class="linenos">65</span>
<span class="linenos">66</span>    <span class="c1"># Display all plots.</span>
<span class="linenos">67</span>    <span class="n">img</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span> <span class="s1">&#39;mapkFB.png&#39;</span> <span class="p">)</span>
<span class="linenos">68</span>    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span> <span class="p">)</span> <span class="p">)</span>
<span class="linenos">69</span>    <span class="n">png</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span> <span class="mi">211</span> <span class="p">)</span>
<span class="linenos">70</span>    <span class="n">imgplot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span> <span class="n">img</span> <span class="p">)</span>
<span class="linenos">71</span>    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span> <span class="mi">212</span> <span class="p">)</span>
<span class="linenos">72</span>    <span class="n">x</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">wildcardFind</span><span class="p">(</span> <span class="s1">&#39;/model/#graphs/conc#/#&#39;</span> <span class="p">)</span>
<span class="linenos">73</span>    <span class="n">t</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span>
<span class="linenos">74</span>    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
<span class="linenos">75</span>    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="p">,</span> <span class="s1">&#39;c-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
<span class="linenos">76</span>    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
<span class="linenos">77</span>    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span><span class="p">,</span> <span class="s1">&#39;m-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
<span class="linenos">78</span>    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span> <span class="s1">&#39;Conc (mM)&#39;</span> <span class="p">)</span>
<span class="linenos">79</span>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span> <span class="s1">&#39;Time (seconds)&#39;</span> <span class="p">)</span>
<span class="linenos">80</span>    <span class="n">pylab</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="linenos">81</span>    <span class="n">pylab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="linenos">82</span>
<span class="linenos">83</span><span class="c1"># Run the &#39;main&#39; if this script is executed standalone.</span>
<span class="linenos">84</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">85</span>        <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div><div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Output:</strong></p>
<img alt="../../../_images/mapkFB2.png" src="../../../_images/mapkFB2.png" />
</section>
<section id="propogation-of-a-bistable-system">
<h2>Propogation of a Bistable System<a class="headerlink" href="#propogation-of-a-bistable-system" title="Permalink to this heading">¶</a></h2>
<p>File name: <strong>propagationBis.py</strong></p>
<p>All the above models have been well-mixed, that is point or non-spatial
models. Bistables do interesting things when they are dispersed in
space. This is illustrated in this example. Here we have a tapering
cylinder, that is a pseudo 1-dimensional reaction-diffusion system.
Every point in this cylinder has the bistable system from the strongBis
example.</p>
<img alt="../../../_images/propBis.png" src="../../../_images/propBis.png" />
<p>The example has two stages. First it starts out with the model in the
unstable transition point, and introduces a small symmetry-breaking
perturbation at one end. This rapidly propagates through the entire
length model, leaving molecule <strong>b</strong> at a higher value than <strong>c</strong>.</p>
<p>At t = 100 we carry out a different manipulation. We flip the
concentrations of molecules b and c for the left half of the model, and
then just let it run. Now we have opposing bistable states on either
half. In the middle, the two systems battle it out. Molecule <strong>c</strong> from
the left side diffuses over to the right, and tries to inhibit <strong>b</strong>,
and vice versa. However we have a small asymmetry due to the tapering of
the cylinder. As there is a slightly larger volume on the left, the
transition point gradually advances to the right, as molecule <strong>b</strong>
yields to the slightly larger amounts of molecule <strong>c</strong>.</p>
<p><strong>Code:</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById('hiddencodeblock14'))">Show/Hide code</a><br /><div id="hiddencodeblock14" style="display: none"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1">#########################################################################</span>
<span class="linenos">  2</span><span class="c1">## This program is part of &#39;MOOSE&#39;, the</span>
<span class="linenos">  3</span><span class="c1">## Messaging Object Oriented Simulation Environment.</span>
<span class="linenos">  4</span><span class="c1">##           Copyright (C) 2014 Upinder S. Bhalla. and NCBS</span>
<span class="linenos">  5</span><span class="c1">## It is made available under the terms of the</span>
<span class="linenos">  6</span><span class="c1">## GNU Lesser General Public License version 2.1</span>
<span class="linenos">  7</span><span class="c1">## See the file COPYING.LIB for the full notice.</span>
<span class="linenos">  8</span><span class="c1">#########################################################################</span>
<span class="linenos">  9</span>
<span class="linenos"> 10</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 11</span><span class="sd">This example illustrates propagation of state flips in a</span>
<span class="linenos"> 12</span><span class="sd">linear 1-dimensional reaction-diffusion system. It uses a</span>
<span class="linenos"> 13</span><span class="sd">bistable system loaded in from a kkit definition file, and</span>
<span class="linenos"> 14</span><span class="sd">places this in a tapering cylinder for pseudo 1-dimentionsional</span>
<span class="linenos"> 15</span><span class="sd">diffusion.</span>
<span class="linenos"> 16</span>
<span class="linenos"> 17</span><span class="sd">This example illustrates a number of features of reaction-diffusion</span>
<span class="linenos"> 18</span><span class="sd">calculations.</span>
<span class="linenos"> 19</span>
<span class="linenos"> 20</span><span class="sd">First, it shows how to set up such systems. Key steps are to create</span>
<span class="linenos"> 21</span><span class="sd">the compartment and define its voxelization, then create the Ksolve,</span>
<span class="linenos"> 22</span><span class="sd">Dsolve, and Stoich. Then we assign stoich.compartment, ksolve and</span>
<span class="linenos"> 23</span><span class="sd">dsolve in that order. Finally we assign the path of the Stoich.</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span><span class="sd">For running the model, we start by introducing</span>
<span class="linenos"> 26</span><span class="sd">a small symmetry-breaking increment of concInit</span>
<span class="linenos"> 27</span><span class="sd">of the molecule **b** in the last compartment on the cylinder. The model</span>
<span class="linenos"> 28</span><span class="sd">starts out with molecules at equal concentrations, so that the system would</span>
<span class="linenos"> 29</span><span class="sd">settle to the unstable fixed point. This symmetry breaking leads</span>
<span class="linenos"> 30</span><span class="sd">to the last compartment moving towards the state with an</span>
<span class="linenos"> 31</span><span class="sd">increased concentration of **b**,</span>
<span class="linenos"> 32</span><span class="sd">and this effect propagates to all other compartments.</span>
<span class="linenos"> 33</span>
<span class="linenos"> 34</span><span class="sd">Once the model has settled to the state where **b** is high throughout,</span>
<span class="linenos"> 35</span><span class="sd">we simply exchange the concentrations of **b** with **c** in the left</span>
<span class="linenos"> 36</span><span class="sd">half of the cylinder. This introduces a brief transient at the junction,</span>
<span class="linenos"> 37</span><span class="sd">which soon settles to a smooth crossover.</span>
<span class="linenos"> 38</span>
<span class="linenos"> 39</span><span class="sd">Finally, as we run the simulation, the tapering geometry comes into play.</span>
<span class="linenos"> 40</span><span class="sd">Since the left hand side has a larger diameter than the right, the</span>
<span class="linenos"> 41</span><span class="sd">state on the left gradually wins over and the transition point slowly</span>
<span class="linenos"> 42</span><span class="sd">moves to the right.</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 45</span>
<span class="linenos"> 46</span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="linenos"> 47</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<span class="linenos"> 48</span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="linenos"> 49</span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.image</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpimg</span>
<span class="linenos"> 50</span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="linenos"> 51</span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="linenos"> 52</span>
<span class="linenos"> 53</span><span class="k">def</span><span class="w"> </span><span class="nf">makeModel</span><span class="p">():</span>
<span class="linenos"> 54</span>                <span class="c1"># create container for model</span>
<span class="linenos"> 55</span>                <span class="n">r0</span> <span class="o">=</span> <span class="mf">1e-6</span>        <span class="c1"># m</span>
<span class="linenos"> 56</span>                <span class="n">r1</span> <span class="o">=</span> <span class="mf">0.5e-6</span>        <span class="c1"># m. Note taper.</span>
<span class="linenos"> 57</span>                <span class="n">num</span> <span class="o">=</span> <span class="mi">200</span>
<span class="linenos"> 58</span>                <span class="n">diffLength</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="c1"># m</span>
<span class="linenos"> 59</span>                <span class="n">comptLength</span> <span class="o">=</span> <span class="n">num</span> <span class="o">*</span> <span class="n">diffLength</span>        <span class="c1"># m</span>
<span class="linenos"> 60</span>                <span class="n">diffConst</span> <span class="o">=</span> <span class="mf">20e-12</span> <span class="c1"># m^2/sec</span>
<span class="linenos"> 61</span>                <span class="n">concA</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># millimolar</span>
<span class="linenos"> 62</span>                <span class="n">diffDt</span> <span class="o">=</span> <span class="mf">0.02</span>  <span class="c1"># for the diffusion</span>
<span class="linenos"> 63</span>                <span class="n">chemDt</span> <span class="o">=</span> <span class="mf">0.2</span>   <span class="c1"># for the reaction</span>
<span class="linenos"> 64</span>                <span class="n">mfile</span> <span class="o">=</span> <span class="s1">&#39;../../genesis/M1719.g&#39;</span>
<span class="linenos"> 65</span>
<span class="linenos"> 66</span>                <span class="n">model</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Neutral</span><span class="p">(</span> <span class="s1">&#39;model&#39;</span> <span class="p">)</span>
<span class="linenos"> 67</span>                <span class="n">compartment</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">CylMesh</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics&#39;</span> <span class="p">)</span>
<span class="linenos"> 68</span>
<span class="linenos"> 69</span>                <span class="c1"># load in model</span>
<span class="linenos"> 70</span>                <span class="n">modelId</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">loadModel</span><span class="p">(</span> <span class="n">mfile</span><span class="p">,</span> <span class="s1">&#39;/model&#39;</span><span class="p">,</span> <span class="s1">&#39;ee&#39;</span> <span class="p">)</span>
<span class="linenos"> 71</span>                <span class="n">a</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics/a&#39;</span> <span class="p">)</span>
<span class="linenos"> 72</span>                <span class="n">b</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics/b&#39;</span> <span class="p">)</span>
<span class="linenos"> 73</span>                <span class="n">c</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics/c&#39;</span> <span class="p">)</span>
<span class="linenos"> 74</span>
<span class="linenos"> 75</span>                <span class="n">ac</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">concInit</span>
<span class="linenos"> 76</span>                <span class="n">bc</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">concInit</span>
<span class="linenos"> 77</span>                <span class="n">cc</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">concInit</span>
<span class="linenos"> 78</span>
<span class="linenos"> 79</span>                <span class="n">compartment</span><span class="o">.</span><span class="n">r0</span> <span class="o">=</span> <span class="n">r0</span>
<span class="linenos"> 80</span>                <span class="n">compartment</span><span class="o">.</span><span class="n">r1</span> <span class="o">=</span> <span class="n">r1</span>
<span class="linenos"> 81</span>                <span class="n">compartment</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 82</span>                <span class="n">compartment</span><span class="o">.</span><span class="n">x1</span> <span class="o">=</span> <span class="n">comptLength</span>
<span class="linenos"> 83</span>                <span class="n">compartment</span><span class="o">.</span><span class="n">diffLength</span> <span class="o">=</span> <span class="n">diffLength</span>
<span class="linenos"> 84</span>                <span class="k">assert</span><span class="p">(</span> <span class="n">compartment</span><span class="o">.</span><span class="n">numDiffCompts</span> <span class="o">==</span> <span class="n">num</span> <span class="p">)</span>
<span class="linenos"> 85</span>
<span class="linenos"> 86</span>                <span class="c1"># Assign parameters</span>
<span class="linenos"> 87</span>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">moose</span><span class="o">.</span><span class="n">wildcardFind</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics/##[ISA=PoolBase]&#39;</span> <span class="p">):</span>
<span class="linenos"> 88</span>                    <span class="c1">#print &#39;pools: &#39;, x, x.name</span>
<span class="linenos"> 89</span>                    <span class="n">x</span><span class="o">.</span><span class="n">diffConst</span> <span class="o">=</span> <span class="n">diffConst</span>
<span class="linenos"> 90</span>
<span class="linenos"> 91</span>                <span class="c1"># Make solvers</span>
<span class="linenos"> 92</span>                <span class="n">ksolve</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Ksolve</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics/ksolve&#39;</span> <span class="p">)</span>
<span class="linenos"> 93</span>                <span class="n">dsolve</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Dsolve</span><span class="p">(</span> <span class="s1">&#39;/model/dsolve&#39;</span> <span class="p">)</span>
<span class="linenos"> 94</span>                <span class="c1"># Set up clocks.</span>
<span class="linenos"> 95</span>                <span class="n">moose</span><span class="o">.</span><span class="n">setClock</span><span class="p">(</span> <span class="mi">10</span><span class="p">,</span> <span class="n">diffDt</span> <span class="p">)</span>
<span class="linenos"> 96</span>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">17</span> <span class="p">):</span>
<span class="linenos"> 97</span>                    <span class="n">moose</span><span class="o">.</span><span class="n">setClock</span><span class="p">(</span> <span class="n">i</span><span class="p">,</span> <span class="n">chemDt</span> <span class="p">)</span>
<span class="linenos"> 98</span>
<span class="linenos"> 99</span>                <span class="n">stoich</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Stoich</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics/stoich&#39;</span> <span class="p">)</span>
<span class="linenos">100</span>                <span class="n">stoich</span><span class="o">.</span><span class="n">compartment</span> <span class="o">=</span> <span class="n">compartment</span>
<span class="linenos">101</span>                <span class="n">stoich</span><span class="o">.</span><span class="n">ksolve</span> <span class="o">=</span> <span class="n">ksolve</span>
<span class="linenos">102</span>                <span class="n">stoich</span><span class="o">.</span><span class="n">dsolve</span> <span class="o">=</span> <span class="n">dsolve</span>
<span class="linenos">103</span>                <span class="n">stoich</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/model/kinetics/##&quot;</span>
<span class="linenos">104</span>                <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;dsolve.numPools, num = &#39;</span><span class="p">,</span> <span class="n">dsolve</span><span class="o">.</span><span class="n">numPools</span><span class="p">,</span> <span class="n">num</span><span class="p">))</span>
<span class="linenos">105</span>                <span class="n">b</span><span class="o">.</span><span class="n">vec</span><span class="p">[</span><span class="n">num</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">concInit</span> <span class="o">*=</span> <span class="mf">1.01</span> <span class="c1"># Break symmetry.</span>
<span class="linenos">106</span>
<span class="linenos">107</span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="linenos">108</span>                <span class="n">runtime</span> <span class="o">=</span> <span class="mi">100</span>
<span class="linenos">109</span>                <span class="n">displayInterval</span> <span class="o">=</span> <span class="mi">2</span>
<span class="linenos">110</span>                <span class="n">makeModel</span><span class="p">()</span>
<span class="linenos">111</span>                <span class="n">dsolve</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/dsolve&#39;</span> <span class="p">)</span>
<span class="linenos">112</span>                <span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="linenos">113</span>                <span class="c1">#moose.start( runtime ) # Run the model for 10 seconds.</span>
<span class="linenos">114</span>
<span class="linenos">115</span>                <span class="n">a</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics/a&#39;</span> <span class="p">)</span>
<span class="linenos">116</span>                <span class="n">b</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics/b&#39;</span> <span class="p">)</span>
<span class="linenos">117</span>                <span class="n">c</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics/c&#39;</span> <span class="p">)</span>
<span class="linenos">118</span>
<span class="linenos">119</span>                <span class="n">img</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span> <span class="s1">&#39;propBis.png&#39;</span> <span class="p">)</span>
<span class="linenos">120</span>                <span class="c1">#imgplot = plt.imshow( img )</span>
<span class="linenos">121</span>                <span class="c1">#plt.show()</span>
<span class="linenos">122</span>
<span class="linenos">123</span>                <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
<span class="linenos">124</span>                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="p">)</span>
<span class="linenos">125</span>                <span class="n">png</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="linenos">126</span>                <span class="n">imgplot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span> <span class="n">img</span> <span class="p">)</span>
<span class="linenos">127</span>                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="linenos">128</span>                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.001</span> <span class="p">)</span>
<span class="linenos">129</span>                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span> <span class="s1">&#39;Conc (mM)&#39;</span> <span class="p">)</span>
<span class="linenos">130</span>                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span> <span class="s1">&#39;Position along cylinder (microns)&#39;</span> <span class="p">)</span>
<span class="linenos">131</span>                <span class="n">pos</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">conc</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
<span class="linenos">132</span>                <span class="n">line1</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">pos</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">conc</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;a&#39;</span> <span class="p">)</span>
<span class="linenos">133</span>                <span class="n">line2</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">pos</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">conc</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;b&#39;</span> <span class="p">)</span>
<span class="linenos">134</span>                <span class="n">line3</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">pos</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">conc</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;c&#39;</span> <span class="p">)</span>
<span class="linenos">135</span>                <span class="n">timeLabel</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.0009</span><span class="p">,</span> <span class="s1">&#39;time = 0&#39;</span><span class="p">)</span>
<span class="linenos">136</span>                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="linenos">137</span>                <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="linenos">138</span>
<span class="linenos">139</span>                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">displayInterval</span><span class="p">,</span> <span class="n">runtime</span><span class="p">,</span> <span class="n">displayInterval</span> <span class="p">):</span>
<span class="linenos">140</span>                    <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="n">displayInterval</span> <span class="p">)</span>
<span class="linenos">141</span>                    <span class="n">line1</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span> <span class="n">a</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">conc</span> <span class="p">)</span>
<span class="linenos">142</span>                    <span class="n">line2</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span> <span class="n">b</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">conc</span> <span class="p">)</span>
<span class="linenos">143</span>                    <span class="n">line3</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span> <span class="n">c</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">conc</span> <span class="p">)</span>
<span class="linenos">144</span>                    <span class="n">timeLabel</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span> <span class="s2">&quot;time = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">t</span> <span class="p">)</span>
<span class="linenos">145</span>                    <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="linenos">146</span>
<span class="linenos">147</span>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Swapping concs of b and c in half the cylinder&#39;</span><span class="p">)</span>
<span class="linenos">148</span>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">b</span><span class="o">.</span><span class="n">numData</span><span class="o">/</span><span class="mi">2</span> <span class="p">):</span>
<span class="linenos">149</span>                    <span class="n">temp</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">conc</span>
<span class="linenos">150</span>                    <span class="n">b</span><span class="o">.</span><span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">conc</span>
<span class="linenos">151</span>                    <span class="n">c</span><span class="o">.</span><span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">temp</span>
<span class="linenos">152</span>
<span class="linenos">153</span>                <span class="n">newruntime</span> <span class="o">=</span> <span class="mi">200</span>
<span class="linenos">154</span>                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">displayInterval</span><span class="p">,</span> <span class="n">newruntime</span><span class="p">,</span> <span class="n">displayInterval</span> <span class="p">):</span>
<span class="linenos">155</span>                    <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="n">displayInterval</span> <span class="p">)</span>
<span class="linenos">156</span>                    <span class="n">line1</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span> <span class="n">a</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">conc</span> <span class="p">)</span>
<span class="linenos">157</span>                    <span class="n">line2</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span> <span class="n">b</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">conc</span> <span class="p">)</span>
<span class="linenos">158</span>                    <span class="n">line3</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span> <span class="n">c</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">conc</span> <span class="p">)</span>
<span class="linenos">159</span>                    <span class="n">timeLabel</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span> <span class="s2">&quot;time = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">runtime</span><span class="p">)</span> <span class="p">)</span>
<span class="linenos">160</span>                    <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="linenos">161</span>
<span class="linenos">162</span>                <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Hit &#39;enter&#39; to exit&quot;</span> <span class="p">)</span>
<span class="linenos">163</span>                <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">164</span>
<span class="linenos">165</span>
<span class="linenos">166</span>
<span class="linenos">167</span><span class="c1"># Run the &#39;main&#39; if this script is executed standalone.</span>
<span class="linenos">168</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">169</span>        <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div><div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Output:</strong></p>
<img alt="../../../_images/propBis.gif" src="../../../_images/propBis.gif" />
</section>
<section id="steady-state-finder">
<h2>Steady-state Finder<a class="headerlink" href="#steady-state-finder" title="Permalink to this heading">¶</a></h2>
<p>File name: <strong>findSteadyState</strong></p>
<p>This is an example of how to use an internal MOOSE solver to find steady
states of a system very rapidly. The method starts from a random
position in state space that obeys mass conservation. It then finds the
nearest steady state and reports it. If it does this enough times it
should find all the steady states.</p>
<p>We illustrate this process for 50 attempts to find the steady states. It
does find all of them. Each time it plots and prints the values, though
the plotting is not necessary.</p>
<p>The printout shows the concentrations of all molecules in the first 5
columns. Then it prints the type of solution, and the numbers of
negative and positive eigenvalues. In all cases the calculations are
successful, though it takes different numbers of iterations to arrive at
the steady state. In some models it would be necessary to put a cap on
the number of iterations, if the system is not able to find a steady
state.</p>
<p>In this example we run the bistable model using the ODE solver right at
the end, and manually enforce transitions to show where the target
steady states are.</p>
<p>For more information on the algorithm used, look in the comments within
the main method of the code below.</p>
<p><strong>Code:</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById('hiddencodeblock15'))">Show/Hide code</a><br /><div id="hiddencodeblock15" style="display: none"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1">#########################################################################</span>
<span class="linenos">  2</span><span class="c1">## This program is part of &#39;MOOSE&#39;, the</span>
<span class="linenos">  3</span><span class="c1">## Messaging Object Oriented Simulation Environment.</span>
<span class="linenos">  4</span><span class="c1">##           Copyright (C) 2013 Upinder S. Bhalla. and NCBS</span>
<span class="linenos">  5</span><span class="c1">## It is made available under the terms of the</span>
<span class="linenos">  6</span><span class="c1">## GNU Lesser General Public License version 2.1</span>
<span class="linenos">  7</span><span class="c1">## See the file COPYING.LIB for the full notice.</span>
<span class="linenos">  8</span><span class="c1">#########################################################################</span>
<span class="linenos">  9</span>
<span class="linenos"> 10</span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<span class="linenos"> 11</span>
<span class="linenos"> 12</span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="linenos"> 13</span><span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="linenos"> 14</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<span class="linenos"> 15</span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="linenos"> 16</span>
<span class="linenos"> 17</span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="linenos"> 18</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 19</span><span class="sd">    This example sets up the kinetic solver and steady-state finder, on</span>
<span class="linenos"> 20</span><span class="sd">    a bistable model of a chemical system. The model is set up within the</span>
<span class="linenos"> 21</span><span class="sd">    script.</span>
<span class="linenos"> 22</span><span class="sd">    The algorithm calls the steady-state finder 50 times with different</span>
<span class="linenos"> 23</span><span class="sd">    (randomized) initial conditions, as follows:</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span><span class="sd">    * Set up the random initial condition that fits the conservation laws</span>
<span class="linenos"> 26</span><span class="sd">    * Run for 2 seconds. This should not be mathematically necessary, but</span>
<span class="linenos"> 27</span><span class="sd">      for obscure numerical reasons it makes it much more likely that the</span>
<span class="linenos"> 28</span><span class="sd">      steady state solver will succeed in finding a state.</span>
<span class="linenos"> 29</span><span class="sd">    * Find the fixed point</span>
<span class="linenos"> 30</span><span class="sd">    * Print out the fixed point vector and various diagnostics.</span>
<span class="linenos"> 31</span><span class="sd">    * Run for 10 seconds. This is completely unnecessary, and is done here</span>
<span class="linenos"> 32</span><span class="sd">      just so that the resultant graph will show what kind of state has</span>
<span class="linenos"> 33</span><span class="sd">      been  found.</span>
<span class="linenos"> 34</span>
<span class="linenos"> 35</span><span class="sd">    After it does all this, the program runs for 100 more seconds on the</span>
<span class="linenos"> 36</span><span class="sd">    last found fixed point (which turns out to be a saddle node), then</span>
<span class="linenos"> 37</span><span class="sd">    is hard-switched in the script to the first attractor basin from which</span>
<span class="linenos"> 38</span><span class="sd">    it runs for another 100 seconds till it settles there, and then</span>
<span class="linenos"> 39</span><span class="sd">    is hard-switched yet again to the second attractor and runs for 400</span>
<span class="linenos"> 40</span><span class="sd">    seconds.</span>
<span class="linenos"> 41</span>
<span class="linenos"> 42</span><span class="sd">    Looking at the output you will see many features of note:</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span><span class="sd">    * the first attractor (stable point) and the saddle point (unstable</span>
<span class="linenos"> 45</span><span class="sd">      fixed point) are both found quite often. But the second</span>
<span class="linenos"> 46</span><span class="sd">      attractor is found just once.</span>
<span class="linenos"> 47</span><span class="sd">      It has a very small basin of attraction.</span>
<span class="linenos"> 48</span><span class="sd">    * The values found for each of the fixed points match well with the</span>
<span class="linenos"> 49</span><span class="sd">      values found by running the system to steady-state at the end.</span>
<span class="linenos"> 50</span><span class="sd">    * There are a large number of failures to find a fixed point. These are</span>
<span class="linenos"> 51</span><span class="sd">      found and reported in the diagnostics. They show up on the plot</span>
<span class="linenos"> 52</span><span class="sd">      as cases where the 10-second runs are not flat.</span>
<span class="linenos"> 53</span>
<span class="linenos"> 54</span><span class="sd">    If you wanted to find fixed points in a production model, you would</span>
<span class="linenos"> 55</span><span class="sd">    not need to do the 10-second runs, and you would need to eliminate the</span>
<span class="linenos"> 56</span><span class="sd">    cases where the state-finder failed. Then you could identify the good</span>
<span class="linenos"> 57</span><span class="sd">    points and keep track of how many of each were found.</span>
<span class="linenos"> 58</span>
<span class="linenos"> 59</span><span class="sd">    There is no way to guarantee that all fixed points have been found</span>
<span class="linenos"> 60</span><span class="sd">    using this algorithm! If there are points in an obscure corner of state</span>
<span class="linenos"> 61</span><span class="sd">    space (as for the singleton second attractor convergence in this</span>
<span class="linenos"> 62</span><span class="sd">    example) you may have to iterate very many times to find them.</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span><span class="sd">    You may wish to sample concentration space logarithmically rather than</span>
<span class="linenos"> 65</span><span class="sd">    linearly.</span>
<span class="linenos"> 66</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 67</span>    <span class="n">compartment</span> <span class="o">=</span> <span class="n">makeModel</span><span class="p">()</span>
<span class="linenos"> 68</span>    <span class="n">ksolve</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Ksolve</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/ksolve&#39;</span> <span class="p">)</span>
<span class="linenos"> 69</span>    <span class="n">stoich</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Stoich</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/stoich&#39;</span> <span class="p">)</span>
<span class="linenos"> 70</span>    <span class="n">stoich</span><span class="o">.</span><span class="n">compartment</span> <span class="o">=</span> <span class="n">compartment</span>
<span class="linenos"> 71</span>    <span class="n">stoich</span><span class="o">.</span><span class="n">ksolve</span> <span class="o">=</span> <span class="n">ksolve</span>
<span class="linenos"> 72</span>    <span class="n">stoich</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/model/compartment/##&quot;</span>
<span class="linenos"> 73</span>    <span class="n">state</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">SteadyState</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/state&#39;</span> <span class="p">)</span>
<span class="linenos"> 74</span>
<span class="linenos"> 75</span>    <span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="linenos"> 76</span>    <span class="n">state</span><span class="o">.</span><span class="n">stoich</span> <span class="o">=</span> <span class="n">stoich</span>
<span class="linenos"> 77</span>    <span class="n">state</span><span class="o">.</span><span class="n">showMatrices</span><span class="p">()</span>
<span class="linenos"> 78</span>    <span class="n">state</span><span class="o">.</span><span class="n">convergenceCriterion</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="linenos"> 79</span>    <span class="n">moose</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span> <span class="mi">111</span> <span class="p">)</span> <span class="c1"># Used when generating the samples in state space</span>
<span class="linenos"> 80</span>
<span class="linenos"> 81</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">50</span> <span class="p">):</span>
<span class="linenos"> 82</span>        <span class="n">getState</span><span class="p">(</span> <span class="n">ksolve</span><span class="p">,</span> <span class="n">state</span> <span class="p">)</span>
<span class="linenos"> 83</span>
<span class="linenos"> 84</span>    <span class="c1"># Now display the states of the system at more length to compare.</span>
<span class="linenos"> 85</span>    <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mf">100.0</span> <span class="p">)</span> <span class="c1"># Run the model for 100 seconds.</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>    <span class="n">a</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/a&#39;</span> <span class="p">)</span>
<span class="linenos"> 88</span>    <span class="n">b</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/b&#39;</span> <span class="p">)</span>
<span class="linenos"> 89</span>
<span class="linenos"> 90</span>    <span class="c1"># move most molecules over to b</span>
<span class="linenos"> 91</span>    <span class="n">b</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">conc</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">conc</span> <span class="o">*</span> <span class="mf">0.9</span>
<span class="linenos"> 92</span>    <span class="n">a</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">conc</span> <span class="o">*</span> <span class="mf">0.1</span>
<span class="linenos"> 93</span>    <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mf">100.0</span> <span class="p">)</span> <span class="c1"># Run the model for 100 seconds.</span>
<span class="linenos"> 94</span>
<span class="linenos"> 95</span>    <span class="c1"># move most molecules back to a</span>
<span class="linenos"> 96</span>    <span class="n">a</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">conc</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">conc</span> <span class="o">*</span> <span class="mf">0.99</span>
<span class="linenos"> 97</span>    <span class="n">b</span><span class="o">.</span><span class="n">conc</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">conc</span> <span class="o">*</span> <span class="mf">0.01</span>
<span class="linenos"> 98</span>    <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mf">400.0</span> <span class="p">)</span> <span class="c1"># Run the model for 200 seconds.</span>
<span class="linenos"> 99</span>
<span class="linenos">100</span>    <span class="c1"># Iterate through all plots, dump their contents to data.plot.</span>
<span class="linenos">101</span>    <span class="n">displayPlots</span><span class="p">()</span>
<span class="linenos">102</span>
<span class="linenos">103</span>    <span class="n">quit</span><span class="p">()</span>
<span class="linenos">104</span>
<span class="linenos">105</span><span class="k">def</span><span class="w"> </span><span class="nf">makeModel</span><span class="p">():</span>
<span class="linenos">106</span><span class="w">    </span><span class="sd">&quot;&quot;&quot; This function creates a bistable reaction system using explicit</span>
<span class="linenos">107</span><span class="sd">    MOOSE calls rather than load from a file</span>
<span class="linenos">108</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">109</span>    <span class="c1"># create container for model</span>
<span class="linenos">110</span>    <span class="n">model</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Neutral</span><span class="p">(</span> <span class="s1">&#39;model&#39;</span> <span class="p">)</span>
<span class="linenos">111</span>    <span class="n">compartment</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">CubeMesh</span><span class="p">(</span> <span class="s1">&#39;/model/compartment&#39;</span> <span class="p">)</span>
<span class="linenos">112</span>    <span class="n">compartment</span><span class="o">.</span><span class="n">volume</span> <span class="o">=</span> <span class="mf">1e-15</span>
<span class="linenos">113</span>    <span class="c1"># the mesh is created automatically by the compartment</span>
<span class="linenos">114</span>    <span class="n">mesh</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/mesh&#39;</span> <span class="p">)</span>
<span class="linenos">115</span>
<span class="linenos">116</span>    <span class="c1"># create molecules and reactions</span>
<span class="linenos">117</span>    <span class="n">a</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/a&#39;</span> <span class="p">)</span>
<span class="linenos">118</span>    <span class="n">b</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/b&#39;</span> <span class="p">)</span>
<span class="linenos">119</span>    <span class="n">c</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/c&#39;</span> <span class="p">)</span>
<span class="linenos">120</span>    <span class="n">enz1</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Enz</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/b/enz1&#39;</span> <span class="p">)</span>
<span class="linenos">121</span>    <span class="n">enz2</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Enz</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/c/enz2&#39;</span> <span class="p">)</span>
<span class="linenos">122</span>    <span class="n">cplx1</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/b/enz1/cplx&#39;</span> <span class="p">)</span>
<span class="linenos">123</span>    <span class="n">cplx2</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/c/enz2/cplx&#39;</span> <span class="p">)</span>
<span class="linenos">124</span>    <span class="n">reac</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Reac</span><span class="p">(</span> <span class="s1">&#39;/model/compartment/reac&#39;</span> <span class="p">)</span>
<span class="linenos">125</span>
<span class="linenos">126</span>    <span class="c1"># connect them up for reactions</span>
<span class="linenos">127</span>    <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz1</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos">128</span>    <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz1</span><span class="p">,</span> <span class="s1">&#39;prd&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos">129</span>    <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz1</span><span class="p">,</span> <span class="s1">&#39;enz&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos">130</span>    <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz1</span><span class="p">,</span> <span class="s1">&#39;cplx&#39;</span><span class="p">,</span> <span class="n">cplx1</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos">131</span>
<span class="linenos">132</span>    <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz2</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos">133</span>    <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz2</span><span class="p">,</span> <span class="s1">&#39;prd&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos">134</span>    <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz2</span><span class="p">,</span> <span class="s1">&#39;enz&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos">135</span>    <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">enz2</span><span class="p">,</span> <span class="s1">&#39;cplx&#39;</span><span class="p">,</span> <span class="n">cplx2</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos">136</span>
<span class="linenos">137</span>    <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">reac</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos">138</span>    <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">reac</span><span class="p">,</span> <span class="s1">&#39;prd&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;reac&#39;</span> <span class="p">)</span>
<span class="linenos">139</span>
<span class="linenos">140</span>    <span class="c1"># Assign parameters</span>
<span class="linenos">141</span>    <span class="n">a</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos">142</span>    <span class="n">b</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">143</span>    <span class="n">c</span><span class="o">.</span><span class="n">concInit</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="linenos">144</span>    <span class="n">enz1</span><span class="o">.</span><span class="n">kcat</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="linenos">145</span>    <span class="n">enz1</span><span class="o">.</span><span class="n">Km</span> <span class="o">=</span> <span class="mi">4</span>
<span class="linenos">146</span>    <span class="n">enz2</span><span class="o">.</span><span class="n">kcat</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="linenos">147</span>    <span class="n">enz2</span><span class="o">.</span><span class="n">Km</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="linenos">148</span>    <span class="n">reac</span><span class="o">.</span><span class="n">Kf</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="linenos">149</span>    <span class="n">reac</span><span class="o">.</span><span class="n">Kb</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="linenos">150</span>
<span class="linenos">151</span>    <span class="c1"># Create the output tables</span>
<span class="linenos">152</span>    <span class="n">graphs</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Neutral</span><span class="p">(</span> <span class="s1">&#39;/model/graphs&#39;</span> <span class="p">)</span>
<span class="linenos">153</span>    <span class="n">outputA</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Table2</span> <span class="p">(</span> <span class="s1">&#39;/model/graphs/concA&#39;</span> <span class="p">)</span>
<span class="linenos">154</span>    <span class="n">outputB</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Table2</span> <span class="p">(</span> <span class="s1">&#39;/model/graphs/concB&#39;</span> <span class="p">)</span>
<span class="linenos">155</span>    <span class="n">outputC</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Table2</span> <span class="p">(</span> <span class="s1">&#39;/model/graphs/concC&#39;</span> <span class="p">)</span>
<span class="linenos">156</span>    <span class="n">outputCplx1</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Table2</span> <span class="p">(</span> <span class="s1">&#39;/model/graphs/concCplx1&#39;</span> <span class="p">)</span>
<span class="linenos">157</span>    <span class="n">outputCplx2</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Table2</span> <span class="p">(</span> <span class="s1">&#39;/model/graphs/concCplx2&#39;</span> <span class="p">)</span>
<span class="linenos">158</span>
<span class="linenos">159</span>    <span class="c1"># connect up the tables</span>
<span class="linenos">160</span>    <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">outputA</span><span class="p">,</span> <span class="s1">&#39;requestOut&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;getConc&#39;</span> <span class="p">);</span>
<span class="linenos">161</span>    <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">outputB</span><span class="p">,</span> <span class="s1">&#39;requestOut&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;getConc&#39;</span> <span class="p">);</span>
<span class="linenos">162</span>    <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">outputC</span><span class="p">,</span> <span class="s1">&#39;requestOut&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="s1">&#39;getConc&#39;</span> <span class="p">);</span>
<span class="linenos">163</span>    <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">outputCplx1</span><span class="p">,</span> <span class="s1">&#39;requestOut&#39;</span><span class="p">,</span> <span class="n">cplx1</span><span class="p">,</span> <span class="s1">&#39;getConc&#39;</span> <span class="p">);</span>
<span class="linenos">164</span>    <span class="n">moose</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">outputCplx2</span><span class="p">,</span> <span class="s1">&#39;requestOut&#39;</span><span class="p">,</span> <span class="n">cplx2</span><span class="p">,</span> <span class="s1">&#39;getConc&#39;</span> <span class="p">);</span>
<span class="linenos">165</span>
<span class="linenos">166</span>    <span class="k">return</span> <span class="n">compartment</span>
<span class="linenos">167</span>
<span class="linenos">168</span><span class="k">def</span><span class="w"> </span><span class="nf">displayPlots</span><span class="p">():</span>
<span class="linenos">169</span>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">moose</span><span class="o">.</span><span class="n">wildcardFind</span><span class="p">(</span> <span class="s1">&#39;/model/graphs/conc#&#39;</span> <span class="p">):</span>
<span class="linenos">170</span>            <span class="n">t</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span> <span class="c1">#sec</span>
<span class="linenos">171</span>            <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">vector</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
<span class="linenos">172</span>    <span class="n">pylab</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="linenos">173</span>    <span class="n">pylab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="linenos">174</span>
<span class="linenos">175</span><span class="k">def</span><span class="w"> </span><span class="nf">getState</span><span class="p">(</span> <span class="n">ksolve</span><span class="p">,</span> <span class="n">state</span> <span class="p">):</span>
<span class="linenos">176</span><span class="w">    </span><span class="sd">&quot;&quot;&quot; This function finds a steady state starting from a random</span>
<span class="linenos">177</span><span class="sd">    initial condition that is consistent with the stoichiometry rules</span>
<span class="linenos">178</span><span class="sd">    and the original model concentrations.</span>
<span class="linenos">179</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">180</span>    <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span> <span class="mf">1e-15</span> <span class="o">*</span> <span class="mf">6.022e23</span> <span class="p">)</span>
<span class="linenos">181</span>    <span class="n">state</span><span class="o">.</span><span class="n">randomInit</span><span class="p">()</span> <span class="c1"># Randomize init conditions, subject to stoichiometry</span>
<span class="linenos">182</span>    <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mf">2.0</span> <span class="p">)</span> <span class="c1"># Run the model for 2 seconds.</span>
<span class="linenos">183</span>    <span class="n">state</span><span class="o">.</span><span class="n">settle</span><span class="p">()</span> <span class="c1"># This function finds the steady states.</span>
<span class="linenos">184</span>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ksolve</span><span class="o">.</span><span class="n">nVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<span class="linenos">185</span>        <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="n">scale</span> <span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="linenos">186</span>
<span class="linenos">187</span>    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Type=</span><span class="si">{}</span><span class="s2"> NegEig=</span><span class="si">{}</span><span class="s2"> PosEig=</span><span class="si">{}</span><span class="s2"> status=</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> Iter=</span><span class="si">{:2d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">state</span><span class="o">.</span><span class="n">stateType</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">nNegEigenvalues</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">nPosEigenvalues</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">solutionStatus</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">nIter</span><span class="p">))</span>
<span class="linenos">188</span>    <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mf">10.0</span> <span class="p">)</span> <span class="c1"># Run model for 10 seconds, just for display</span>
<span class="linenos">189</span>
<span class="linenos">190</span>
<span class="linenos">191</span><span class="c1"># Run the &#39;main&#39; if this script is executed standalone.</span>
<span class="linenos">192</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">193</span>    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div><div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.92</span> <span class="mf">0.05</span> <span class="mf">0.00</span> <span class="mf">0.01</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">2</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">2</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">1</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">16</span>
<span class="mf">0.92</span> <span class="mf">0.05</span> <span class="mf">0.00</span> <span class="mf">0.01</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">2</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">2</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">1</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">29</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">10</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">26</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">27</span>
<span class="mf">0.92</span> <span class="mf">0.05</span> <span class="mf">0.00</span> <span class="mf">0.01</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">2</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">2</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">1</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">30</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">12</span>
<span class="mf">0.92</span> <span class="mf">0.05</span> <span class="mf">0.00</span> <span class="mf">0.01</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">2</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">2</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">1</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">29</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">12</span>
<span class="mf">0.92</span> <span class="mf">0.05</span> <span class="mf">0.00</span> <span class="mf">0.01</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">2</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">2</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">1</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">41</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">29</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">18</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">27</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">14</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">12</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">19</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span> <span class="mi">6</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">14</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">23</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">25</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">16</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span> <span class="mi">5</span>
<span class="mf">0.92</span> <span class="mf">0.05</span> <span class="mf">0.00</span> <span class="mf">0.01</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">2</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">2</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">1</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">43</span>
<span class="mf">0.92</span> <span class="mf">0.05</span> <span class="mf">0.00</span> <span class="mf">0.01</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">2</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">2</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">1</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span> <span class="mi">9</span>
<span class="mf">0.92</span> <span class="mf">0.05</span> <span class="mf">0.00</span> <span class="mf">0.01</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">2</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">2</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">1</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">43</span>
<span class="mf">0.92</span> <span class="mf">0.05</span> <span class="mf">0.00</span> <span class="mf">0.01</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">2</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">2</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">1</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">29</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">27</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span> <span class="mi">9</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">12</span>
<span class="mf">0.92</span> <span class="mf">0.05</span> <span class="mf">0.00</span> <span class="mf">0.01</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">2</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">2</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">1</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">24</span>
<span class="mf">0.92</span> <span class="mf">0.05</span> <span class="mf">0.00</span> <span class="mf">0.01</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">2</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">2</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">1</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">26</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">14</span>
<span class="mf">0.92</span> <span class="mf">0.05</span> <span class="mf">0.00</span> <span class="mf">0.01</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">2</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">2</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">1</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">14</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">10</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">13</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">26</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">21</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">26</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">24</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">24</span>
<span class="mf">0.92</span> <span class="mf">0.05</span> <span class="mf">0.00</span> <span class="mf">0.01</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">2</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">2</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">1</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">18</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">26</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">5</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">4</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">13</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">23</span>
<span class="mf">0.92</span> <span class="mf">0.05</span> <span class="mf">0.00</span> <span class="mf">0.01</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">2</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">2</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">1</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">24</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span> <span class="mi">8</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">18</span>
<span class="mf">0.18</span> <span class="mf">0.75</span> <span class="mf">0.00</span> <span class="mf">0.03</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">1</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">21</span>
<span class="mf">0.99</span> <span class="mf">0.00</span> <span class="mf">0.01</span> <span class="mf">0.00</span> <span class="mf">0.00</span> <span class="n">Type</span><span class="o">=</span><span class="mi">0</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">3</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">0</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">15</span>
<span class="mf">0.92</span> <span class="mf">0.05</span> <span class="mf">0.00</span> <span class="mf">0.01</span> <span class="mf">0.01</span> <span class="n">Type</span><span class="o">=</span><span class="mi">2</span> <span class="n">NegEig</span><span class="o">=</span><span class="mi">2</span> <span class="n">PosEig</span><span class="o">=</span><span class="mi">1</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span> <span class="n">success</span> <span class="n">Iter</span><span class="o">=</span><span class="mi">29</span>
</pre></div>
</div>
<img alt="../../../_images/findS.png" src="../../../_images/findS.png" />
</section>
<section id="dose-response-under-construction">
<h2>Dose Response (Under construction)<a class="headerlink" href="#dose-response-under-construction" title="Permalink to this heading">¶</a></h2>
<p>File name: <strong>doseResponse.py</strong></p>
<p>This example generates a doseResponse plot for a bistable system,
against a control parameter (dose) that takes the system in and out
again from the bistable regime. Like the previous example, it uses the
steady-state solver to find the stable points for each value of the
control parameter. Unfortunately it doesn't work right now. Seems like
the kcat scaling isn't being registered.</p>
<p><strong>Code:</strong></p>
<script type="text/javascript">
    function showhide(element){
        if (!document.getElementById)
            return

        if (element.style.display == "block")
            element.style.display = "none"
        else
            element.style.display = "block"
    };
</script>
<a href="javascript:showhide(document.getElementById('hiddencodeblock16'))">Show/Hide code</a><br /><div id="hiddencodeblock16" style="display: none"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1">## Makes and plots the dose response curve for bistable models</span>
<span class="linenos">  2</span><span class="c1">## Author: Sahil Moza</span>
<span class="linenos">  3</span><span class="c1">## June 26, 2014</span>
<span class="linenos">  4</span>
<span class="linenos">  5</span><span class="kn">import</span><span class="w"> </span><span class="nn">moose</span>
<span class="linenos">  6</span><span class="kn">import</span><span class="w"> </span><span class="nn">pylab</span>
<span class="linenos">  7</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="linenos">  8</span><span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="linenos">  9</span>
<span class="linenos"> 10</span><span class="k">def</span><span class="w"> </span><span class="nf">setupSteadyState</span><span class="p">(</span><span class="n">simdt</span><span class="p">,</span><span class="n">plotDt</span><span class="p">):</span>
<span class="linenos"> 11</span>
<span class="linenos"> 12</span>    <span class="n">ksolve</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Ksolve</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics/ksolve&#39;</span> <span class="p">)</span>
<span class="linenos"> 13</span>    <span class="n">stoich</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">Stoich</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics/stoich&#39;</span> <span class="p">)</span>
<span class="linenos"> 14</span>    <span class="n">stoich</span><span class="o">.</span><span class="n">compartment</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span><span class="s1">&#39;/model/kinetics&#39;</span><span class="p">)</span>
<span class="linenos"> 15</span>
<span class="linenos"> 16</span>    <span class="n">stoich</span><span class="o">.</span><span class="n">ksolve</span> <span class="o">=</span> <span class="n">ksolve</span>
<span class="linenos"> 17</span>    <span class="c1">#ksolve.stoich = stoich</span>
<span class="linenos"> 18</span>    <span class="n">stoich</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/model/kinetics/##&quot;</span>
<span class="linenos"> 19</span>    <span class="n">state</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">SteadyState</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics/state&#39;</span> <span class="p">)</span>
<span class="linenos"> 20</span>
<span class="linenos"> 21</span>    <span class="c1">#### Set clocks here</span>
<span class="linenos"> 22</span>    <span class="c1">#moose.useClock(4, &quot;/model/kinetics/##[]&quot;, &quot;process&quot;)</span>
<span class="linenos"> 23</span>    <span class="c1">#moose.setClock(4, float(simdt))</span>
<span class="linenos"> 24</span>    <span class="c1">#moose.setClock(5, float(simdt))</span>
<span class="linenos"> 25</span>    <span class="c1">#moose.useClock(5, &#39;/model/kinetics/ksolve&#39;, &#39;process&#39; )</span>
<span class="linenos"> 26</span>    <span class="c1">#moose.useClock(8, &#39;/model/graphs/#&#39;, &#39;process&#39; )</span>
<span class="linenos"> 27</span>    <span class="c1">#moose.setClock(8, float(plotDt))</span>
<span class="linenos"> 28</span>
<span class="linenos"> 29</span>    <span class="n">moose</span><span class="o">.</span><span class="n">reinit</span><span class="p">()</span>
<span class="linenos"> 30</span>
<span class="linenos"> 31</span>    <span class="n">state</span><span class="o">.</span><span class="n">stoich</span> <span class="o">=</span> <span class="n">stoich</span>
<span class="linenos"> 32</span>    <span class="n">state</span><span class="o">.</span><span class="n">showMatrices</span><span class="p">()</span>
<span class="linenos"> 33</span>    <span class="n">state</span><span class="o">.</span><span class="n">convergenceCriterion</span> <span class="o">=</span> <span class="mf">1e-8</span>
<span class="linenos"> 34</span>
<span class="linenos"> 35</span>    <span class="k">return</span> <span class="n">ksolve</span><span class="p">,</span> <span class="n">state</span>
<span class="linenos"> 36</span>
<span class="linenos"> 37</span><span class="k">def</span><span class="w"> </span><span class="nf">parseModelName</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
<span class="linenos"> 38</span>    <span class="n">pos1</span><span class="o">=</span><span class="n">fileName</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="linenos"> 39</span>    <span class="n">pos2</span><span class="o">=</span><span class="n">fileName</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="linenos"> 40</span>    <span class="n">directory</span><span class="o">=</span><span class="n">fileName</span><span class="p">[:</span><span class="n">pos1</span><span class="p">]</span>
<span class="linenos"> 41</span>    <span class="n">prefix</span><span class="o">=</span><span class="n">fileName</span><span class="p">[</span><span class="n">pos1</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">pos2</span><span class="p">]</span>
<span class="linenos"> 42</span>    <span class="n">suffix</span><span class="o">=</span><span class="n">fileName</span><span class="p">[</span><span class="n">pos2</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">fileName</span><span class="p">)]</span>
<span class="linenos"> 43</span>    <span class="k">return</span> <span class="n">directory</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span>
<span class="linenos"> 44</span>
<span class="linenos"> 45</span><span class="c1"># Solve for the steady state</span>
<span class="linenos"> 46</span><span class="k">def</span><span class="w"> </span><span class="nf">getState</span><span class="p">(</span> <span class="n">ksolve</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">vol</span><span class="p">):</span>
<span class="linenos"> 47</span>      <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span> <span class="n">vol</span> <span class="o">*</span> <span class="mf">6.022e23</span> <span class="p">)</span>
<span class="linenos"> 48</span>      <span class="n">moose</span><span class="o">.</span><span class="n">reinit</span>
<span class="linenos"> 49</span>      <span class="n">state</span><span class="o">.</span><span class="n">randomInit</span><span class="p">()</span> <span class="c1"># Removing random initial condition to systematically make Dose reponse curves.</span>
<span class="linenos"> 50</span>      <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mf">2.0</span> <span class="p">)</span> <span class="c1"># Run the model for 2 seconds.</span>
<span class="linenos"> 51</span>      <span class="n">state</span><span class="o">.</span><span class="n">settle</span><span class="p">()</span>
<span class="linenos"> 52</span>
<span class="linenos"> 53</span>      <span class="n">vector</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 54</span>      <span class="n">a</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics/a&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">conc</span>
<span class="linenos"> 55</span>      <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ksolve</span><span class="o">.</span><span class="n">nVec</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<span class="linenos"> 56</span>          <span class="n">vector</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">x</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
<span class="linenos"> 57</span>      <span class="n">moose</span><span class="o">.</span><span class="n">start</span><span class="p">(</span> <span class="mf">10.0</span> <span class="p">)</span> <span class="c1"># Run model for 10 seconds, just for display</span>
<span class="linenos"> 58</span>      <span class="n">failedSteadyState</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">vector</span><span class="p">])</span>
<span class="linenos"> 59</span>
<span class="linenos"> 60</span>      <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">failedSteadyState</span><span class="p">):</span>
<span class="linenos"> 61</span>           <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">stateType</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">solutionStatus</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">vector</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="linenos"> 65</span>    <span class="c1"># Setup parameters for simulation and plotting</span>
<span class="linenos"> 66</span>    <span class="n">simdt</span><span class="o">=</span> <span class="mf">1e-2</span>
<span class="linenos"> 67</span>    <span class="n">plotDt</span><span class="o">=</span> <span class="mi">1</span>
<span class="linenos"> 68</span>
<span class="linenos"> 69</span>    <span class="c1"># Factors to change in the dose concentration in log scale</span>
<span class="linenos"> 70</span>    <span class="n">factorExponent</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1">## Base: ten raised to some power.</span>
<span class="linenos"> 71</span>    <span class="n">factorBegin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span>
<span class="linenos"> 72</span>    <span class="n">factorEnd</span> <span class="o">=</span> <span class="mi">21</span>
<span class="linenos"> 73</span>    <span class="n">factorStepsize</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos"> 74</span>    <span class="n">factorScale</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1">## To scale up or down the factors</span>
<span class="linenos"> 75</span>
<span class="linenos"> 76</span>    <span class="c1"># Load Model and set up the steady state solver.</span>
<span class="linenos"> 77</span>    <span class="c1"># model = sys.argv[1] # To load model from a file.</span>
<span class="linenos"> 78</span>    <span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;./19085.cspace&#39;</span>
<span class="linenos"> 79</span>    <span class="n">modelPath</span><span class="p">,</span> <span class="n">modelName</span><span class="p">,</span> <span class="n">modelType</span> <span class="o">=</span> <span class="n">parseModelName</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="linenos"> 80</span>    <span class="n">outputDir</span> <span class="o">=</span> <span class="n">modelPath</span>
<span class="linenos"> 81</span>
<span class="linenos"> 82</span>    <span class="n">modelId</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">loadModel</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;ee&#39;</span><span class="p">)</span>
<span class="linenos"> 83</span>    <span class="n">dosePath</span> <span class="o">=</span> <span class="s1">&#39;/model/kinetics/b/DabX&#39;</span> <span class="c1"># The dose entity</span>
<span class="linenos"> 84</span>
<span class="linenos"> 85</span>    <span class="n">ksolve</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">setupSteadyState</span><span class="p">(</span> <span class="n">simdt</span><span class="p">,</span> <span class="n">plotDt</span><span class="p">)</span>
<span class="linenos"> 86</span>    <span class="n">vol</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span> <span class="s1">&#39;/model/kinetics&#39;</span> <span class="p">)</span><span class="o">.</span><span class="n">volume</span>
<span class="linenos"> 87</span>    <span class="n">iterInit</span> <span class="o">=</span> <span class="mi">100</span>
<span class="linenos"> 88</span>    <span class="n">solutionVector</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 89</span>    <span class="n">factorArr</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 90</span>
<span class="linenos"> 91</span>    <span class="n">enz</span> <span class="o">=</span> <span class="n">moose</span><span class="o">.</span><span class="n">element</span><span class="p">(</span><span class="n">dosePath</span><span class="p">)</span>
<span class="linenos"> 92</span>    <span class="n">init</span> <span class="o">=</span> <span class="n">enz</span><span class="o">.</span><span class="n">kcat</span> <span class="c1"># Dose parameter</span>
<span class="linenos"> 93</span>
<span class="linenos"> 94</span>    <span class="c1"># Change Dose here to .</span>
<span class="linenos"> 95</span>    <span class="k">for</span> <span class="n">factor</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">factorBegin</span><span class="p">,</span> <span class="n">factorEnd</span><span class="p">,</span> <span class="n">factorStepsize</span> <span class="p">):</span>
<span class="linenos"> 96</span>        <span class="n">scale</span> <span class="o">=</span> <span class="n">factorExponent</span> <span class="o">**</span> <span class="p">(</span><span class="n">factor</span><span class="o">/</span><span class="n">factorScale</span><span class="p">)</span>
<span class="linenos"> 97</span>        <span class="n">enz</span><span class="o">.</span><span class="n">kcat</span> <span class="o">=</span> <span class="n">init</span> <span class="o">*</span> <span class="n">scale</span>
<span class="linenos"> 98</span>        <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;scale=</span><span class="si">{:.3f}</span><span class="se">\t</span><span class="s2">kcat=</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">scale</span><span class="p">,</span> <span class="n">enz</span><span class="o">.</span><span class="n">kcat</span><span class="p">)</span> <span class="p">)</span>
<span class="linenos"> 99</span>        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterInit</span><span class="p">):</span>
<span class="linenos">100</span>            <span class="n">stateType</span><span class="p">,</span> <span class="n">solStatus</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">vector</span> <span class="o">=</span> <span class="n">getState</span><span class="p">(</span> <span class="n">ksolve</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">vol</span><span class="p">)</span>
<span class="linenos">101</span>            <span class="k">if</span> <span class="n">solStatus</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">102</span>                <span class="c1">#solutionVector.append(vector[0]/sum(vector))</span>
<span class="linenos">103</span>                <span class="n">solutionVector</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="linenos">104</span>                <span class="n">factorArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
<span class="linenos">105</span>
<span class="linenos">106</span>    <span class="n">joint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">factorArr</span><span class="p">,</span> <span class="n">solutionVector</span><span class="p">])</span>
<span class="linenos">107</span>    <span class="n">joint</span> <span class="o">=</span> <span class="n">joint</span><span class="p">[:,</span><span class="n">joint</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>
<span class="linenos">108</span>
<span class="linenos">109</span>    <span class="c1"># Plot dose response.</span>
<span class="linenos">110</span>    <span class="n">fig0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="linenos">111</span>    <span class="n">pylab</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">joint</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">joint</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;concA&#39;</span><span class="p">)</span>
<span class="linenos">112</span>    <span class="n">pylab</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Dose&#39;</span><span class="p">)</span>
<span class="linenos">113</span>    <span class="n">pylab</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Response&#39;</span><span class="p">)</span>
<span class="linenos">114</span>    <span class="n">pylab</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Dose-Reponse Curve for a bistable system&#39;</span><span class="p">)</span>
<span class="linenos">115</span>
<span class="linenos">116</span>    <span class="n">pylab</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="linenos">117</span>    <span class="c1">#plt.savefig(outputDir + &quot;/&quot; + modelName +&quot;_doseResponse&quot; + &quot;.png&quot;)</span>
<span class="linenos">118</span>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="linenos">119</span>    <span class="c1">#plt.close(fig0)</span>
<span class="linenos">120</span>    <span class="n">quit</span><span class="p">()</span>
<span class="linenos">121</span>
<span class="linenos">122</span>
<span class="linenos">123</span>
<span class="linenos">124</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">125</span>     <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div><div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scale</span><span class="o">=</span><span class="mf">0.010</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.004</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">0.013</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.005</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">0.016</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.006</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">0.020</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.007</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">0.025</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.009</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">0.032</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.011</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">0.040</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.014</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">0.050</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.018</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">0.063</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.023</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">0.079</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.029</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">0.100</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.036</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">0.126</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.045</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">0.158</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.057</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">0.200</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.072</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">0.251</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.091</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">0.316</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.114</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">0.398</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.144</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">0.501</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.181</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">0.631</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.228</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">0.794</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.287</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">1.000</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.361</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">1.259</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.454</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">1.585</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.572</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">1.995</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.720</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">2.512</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">0.907</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">3.162</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">1.142</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">3.981</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">1.437</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">5.012</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">1.809</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">6.310</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">2.278</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">7.943</span> <span class="n">kcat</span><span class="o">=</span><span class="mf">2.868</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">10.000</span>        <span class="n">kcat</span><span class="o">=</span><span class="mf">3.610</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">12.589</span>        <span class="n">kcat</span><span class="o">=</span><span class="mf">4.545</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">15.849</span>        <span class="n">kcat</span><span class="o">=</span><span class="mf">5.722</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">19.953</span>        <span class="n">kcat</span><span class="o">=</span><span class="mf">7.203</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">25.119</span>        <span class="n">kcat</span><span class="o">=</span><span class="mf">9.068</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">31.623</span>        <span class="n">kcat</span><span class="o">=</span><span class="mf">11.416</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">39.811</span>        <span class="n">kcat</span><span class="o">=</span><span class="mf">14.372</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">50.119</span>        <span class="n">kcat</span><span class="o">=</span><span class="mf">18.093</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">63.096</span>        <span class="n">kcat</span><span class="o">=</span><span class="mf">22.778</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">79.433</span>        <span class="n">kcat</span><span class="o">=</span><span class="mf">28.676</span>
<span class="n">scale</span><span class="o">=</span><span class="mf">100.000</span>       <span class="n">kcat</span><span class="o">=</span><span class="mf">36.101</span>
</pre></div>
</div>
<img alt="../../../_images/doseR.png" src="../../../_images/doseR.png" />
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index_tut.html" class="btn btn-neutral float-left" title="Teaching Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ChemicalOscillators.html" class="btn btn-neutral float-right" title="Chemical Oscillators" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Upinder Bhalla, Niraj Dudani, Subhasis Ray, Aditya Gilra,Harsha Rani, Aviral Goel, Dilawar Singh,Malav Shah, Dhruva Gowda Storz.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>